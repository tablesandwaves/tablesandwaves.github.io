(()=>{var Sm=Object.create;var Ra=Object.defineProperty;var Am=Object.getOwnPropertyDescriptor;var Tm=Object.getOwnPropertyNames;var Cm=Object.getPrototypeOf,Nm=Object.prototype.hasOwnProperty;var mt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var km=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Tm(t))!Nm.call(e,n)&&n!==r&&Ra(e,n,{get:()=>t[n],enumerable:!(o=Am(t,n))||o.enumerable});return e};var Xs=(e,t,r)=>(r=e!=null?Sm(Cm(e)):{},km(t||!e||!e.__esModule?Ra(r,"default",{value:e,enumerable:!0}):r,e));var Ia=mt((xy,Mo)=>{function Om(e){if(Array.isArray(e))return e}Mo.exports=Om,Mo.exports.__esModule=!0,Mo.exports.default=Mo.exports});var qa=mt((yy,Fo)=>{function Dm(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var o,n,s,i,a=[],c=!0,l=!1;try{if(s=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;c=!1}else for(;!(c=(o=s.call(r)).done)&&(a.push(o.value),a.length!==t);c=!0);}catch(u){l=!0,n=u}finally{try{if(!c&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw n}}return a}}Fo.exports=Dm,Fo.exports.__esModule=!0,Fo.exports.default=Fo.exports});var Pa=mt((vy,Ro)=>{function Em(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}Ro.exports=Em,Ro.exports.__esModule=!0,Ro.exports.default=Ro.exports});var La=mt((wy,Io)=>{var Va=Pa();function Mm(e,t){if(e){if(typeof e=="string")return Va(e,t);var r={}.toString.call(e).slice(8,-1);return r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set"?Array.from(e):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Va(e,t):void 0}}Io.exports=Mm,Io.exports.__esModule=!0,Io.exports.default=Io.exports});var Ba=mt((by,qo)=>{function Fm(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}qo.exports=Fm,qo.exports.__esModule=!0,qo.exports.default=qo.exports});var Wa=mt((Sy,Po)=>{var Rm=Ia(),Im=qa(),qm=La(),Pm=Ba();function Vm(e,t){return Rm(e)||Im(e,t)||qm(e,t)||Pm()}Po.exports=Vm,Po.exports.__esModule=!0,Po.exports.default=Po.exports});var ja=mt((Ay,Vo)=>{function Lm(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Vo.exports=Lm,Vo.exports.__esModule=!0,Vo.exports.default=Vo.exports});var Ks=mt((Ty,We)=>{function Ys(e){"@babel/helpers - typeof";return We.exports=Ys=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},We.exports.__esModule=!0,We.exports.default=We.exports,Ys(e)}We.exports=Ys,We.exports.__esModule=!0,We.exports.default=We.exports});var za=mt((Cy,Lo)=>{var Ga=Ks().default;function Bm(e,t){if(Ga(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var o=r.call(e,t||"default");if(Ga(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}Lo.exports=Bm,Lo.exports.__esModule=!0,Lo.exports.default=Lo.exports});var Ua=mt((Ny,Bo)=>{var Wm=Ks().default,jm=za();function Gm(e){var t=jm(e,"string");return Wm(t)=="symbol"?t:t+""}Bo.exports=Gm,Bo.exports.__esModule=!0,Bo.exports.default=Bo.exports});var Ha=mt((ky,Wo)=>{var zm=Ua();function $a(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,zm(o.key),o)}}function Um(e,t,r){return t&&$a(e.prototype,t),r&&$a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}Wo.exports=Um,Wo.exports.__esModule=!0,Wo.exports.default=Wo.exports});var Js=mt((Cn,Za)=>{(function(e,t){typeof Cn=="object"&&typeof Za<"u"?t(Cn,Wa(),ja(),Ha()):typeof define=="function"&&define.amd?define(["exports","@babel/runtime/helpers/slicedToArray","@babel/runtime/helpers/classCallCheck","@babel/runtime/helpers/createClass"],t):(e=typeof globalThis<"u"?globalThis:e||self,t(e.automationEvents={},e._slicedToArray,e._classCallCheck,e._createClass))})(Cn,function(e,t,r,o){"use strict";var n=function(k,C,A){return{endTime:C,insertTime:A,type:"exponentialRampToValue",value:k}},s=function(k,C,A){return{endTime:C,insertTime:A,type:"linearRampToValue",value:k}},i=function(k,C){return{startTime:C,type:"setValue",value:k}},a=function(k,C,A){return{duration:A,startTime:C,type:"setValueCurve",values:k}},c=function(k,C,A){var P=A.startTime,R=A.target,E=A.timeConstant;return R+(C-R)*Math.exp((P-k)/E)},l=function(k){return k.type==="exponentialRampToValue"},u=function(k){return k.type==="linearRampToValue"},h=function(k){return l(k)||u(k)},p=function(k){return k.type==="setValue"},m=function(k){return k.type==="setValueCurve"},f=function(k,C,A,P){var R=k[C];return R===void 0?P:h(R)||p(R)?R.value:m(R)?R.values[R.values.length-1]:c(A,f(k,C-1,R.startTime,P),R)},g=function(k,C,A,P,R){return A===void 0?[P.insertTime,R]:h(A)?[A.endTime,A.value]:p(A)?[A.startTime,A.value]:m(A)?[A.startTime+A.duration,A.values[A.values.length-1]]:[A.startTime,f(k,C-1,A.startTime,R)]},_=function(k){return k.type==="cancelAndHold"},y=function(k){return k.type==="cancelScheduledValues"},S=function(k){return _(k)||y(k)?k.cancelTime:l(k)||u(k)?k.endTime:k.startTime},N=function(k,C,A,P){var R=P.endTime,E=P.value;return A===E?E:0<A&&0<E||A<0&&E<0?A*Math.pow(E/A,(k-C)/(R-C)):0},M=function(k,C,A,P){var R=P.endTime,E=P.value;return A+(k-C)/(R-C)*(E-A)},x=function(k,C){var A=Math.floor(C),P=Math.ceil(C);return A===P?k[A]:(1-(C-A))*k[A]+(1-(P-C))*k[P]},w=function(k,C){var A=C.duration,P=C.startTime,R=C.values,E=(k-P)/A*(R.length-1);return x(R,E)},b=function(k){return k.type==="setTarget"},v=function(){function F(k){r(this,F),this._automationEvents=[],this._currenTime=0,this._defaultValue=k}return o(F,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(C){var A=S(C);if(_(C)||y(C)){var P=this._automationEvents.findIndex(function(B){return y(C)&&m(B)?B.startTime+B.duration>=A:S(B)>=A}),R=this._automationEvents[P];if(P!==-1&&(this._automationEvents=this._automationEvents.slice(0,P)),_(C)){var E=this._automationEvents[this._automationEvents.length-1];if(R!==void 0&&h(R)){if(E!==void 0&&b(E))throw new Error("The internal list is malformed.");var $=E===void 0?R.insertTime:m(E)?E.startTime+E.duration:S(E),K=E===void 0?this._defaultValue:m(E)?E.values[E.values.length-1]:E.value,Dt=l(R)?N(A,$,K,R):M(A,$,K,R),Rt=l(R)?n(Dt,A,this._currenTime):s(Dt,A,this._currenTime);this._automationEvents.push(Rt)}if(E!==void 0&&b(E)&&this._automationEvents.push(i(this.getValue(A),A)),E!==void 0&&m(E)&&E.startTime+E.duration>A){var X=A-E.startTime,st=(E.values.length-1)/E.duration,vt=Math.max(2,1+Math.ceil(X*st)),G=X/(vt-1)*st,se=E.values.slice(0,vt);if(G<1)for(var Ht=1;Ht<vt;Ht+=1){var Be=G*Ht%1;se[Ht]=E.values[Ht-1]*(1-Be)+E.values[Ht]*Be}this._automationEvents[this._automationEvents.length-1]=a(se,E.startTime,X)}}}else{var ie=this._automationEvents.findIndex(function(B){return S(B)>A}),Lr=ie===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[ie-1];if(Lr!==void 0&&m(Lr)&&S(Lr)+Lr.duration>A)return!1;var Tn=l(C)?n(C.value,C.endTime,this._currenTime):u(C)?s(C.value,A,this._currenTime):C;if(ie===-1)this._automationEvents.push(Tn);else{if(m(C)&&A+C.duration>S(this._automationEvents[ie]))return!1;this._automationEvents.splice(ie,0,Tn)}}return!0}},{key:"flush",value:function(C){var A=this._automationEvents.findIndex(function(E){return S(E)>C});if(A>1){var P=this._automationEvents.slice(A-1),R=P[0];b(R)&&P.unshift(i(f(this._automationEvents,A-2,R.startTime,this._defaultValue),R.startTime)),this._automationEvents=P}}},{key:"getValue",value:function(C){if(this._automationEvents.length===0)return this._defaultValue;var A=this._automationEvents.findIndex(function(se){return S(se)>C}),P=this._automationEvents[A],R=(A===-1?this._automationEvents.length:A)-1,E=this._automationEvents[R];if(E!==void 0&&b(E)&&(P===void 0||!h(P)||P.insertTime>C))return c(C,f(this._automationEvents,R-1,E.startTime,this._defaultValue),E);if(E!==void 0&&p(E)&&(P===void 0||!h(P)))return E.value;if(E!==void 0&&m(E)&&(P===void 0||!h(P)||E.startTime+E.duration>C))return C<E.startTime+E.duration?w(C,E):E.values[E.values.length-1];if(E!==void 0&&h(E)&&(P===void 0||!h(P)))return E.value;if(P!==void 0&&l(P)){var $=g(this._automationEvents,R,E,P,this._defaultValue),K=t($,2),Dt=K[0],Rt=K[1];return N(C,Dt,Rt,P)}if(P!==void 0&&u(P)){var X=g(this._automationEvents,R,E,P,this._defaultValue),st=t(X,2),vt=st[0],G=st[1];return M(C,vt,G,P)}return this._defaultValue}}])}(),q=function(k){return{cancelTime:k,type:"cancelAndHold"}},I=function(k){return{cancelTime:k,type:"cancelScheduledValues"}},T=function(k,C){return{endTime:C,type:"exponentialRampToValue",value:k}},O=function(k,C){return{endTime:C,type:"linearRampToValue",value:k}},L=function(k,C,A){return{startTime:C,target:k,timeConstant:A,type:"setTarget"}};e.AutomationEventList=v,e.createCancelAndHoldAutomationEvent=q,e.createCancelScheduledValuesAutomationEvent=I,e.createExponentialRampToValueAutomationEvent=T,e.createLinearRampToValueAutomationEvent=O,e.createSetTargetAutomationEvent=L,e.createSetValueAutomationEvent=i,e.createSetValueCurveAutomationEvent=a})});var zf=mt((lot,qr)=>{"use strict";var _a=Object.defineProperty,Sx=Object.getOwnPropertyDescriptor,Ax=Object.getOwnPropertyNames,Tx=Object.prototype.hasOwnProperty,Cx=Math.pow,Ir=(e,t)=>()=>(e&&(t=e(e=0)),t),wn=(e,t)=>{for(var r in t)_a(e,r,{get:t[r],enumerable:!0})},Nx=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ax(t))!Tx.call(e,n)&&n!==r&&_a(e,n,{get:()=>t[n],enumerable:!(o=Sx(t,n))||o.enumerable});return e},bn=e=>Nx(_a({},"__esModule",{value:!0}),e),vn,Df=Ir(()=>{"use strict";vn=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,vn.prototype)}}}),Ef,Of,Mf,da,Ff,kx=Ir(()=>{"use strict";Df(),Ef="A Sequence can only be made new from and Array of Sequence objects that share the same rest symbol and mode",Of="Numbers must be integers",Mf="A self-similar melody can only be produced for an input sequence length that is coprime with the output sequence length",da=(e,t,r)=>r.indexOf(e)===t,Ff=(e,t)=>{if(!Number.isInteger(e)||!Number.isInteger(t))throw new vn(Of);let r=e>t?t:e;for(let o=2;o<=r;o++)if(e%o===0&&t%o===0)return!1;return!0}}),Rf={};wn(Rf,{Rhythm:()=>xa});var xa,If=Ir(()=>{"use strict";ya(),xa=class{constructor(e,t="wrap",r){this.steps=e,this.fillMode=t,this.length=r}applyTo(e){let t=this.steps.filter(s=>s!=0).length,r=Math.ceil(e.steps.length/t),o=new Array(r).fill(this.steps).flat();if(this.length!==void 0){if(this.length>o.length){let s=this.length-o.length;if(this.fillMode=="silence")o.push(...new Array(s).fill(0));else{let i=Math.ceil(s/this.steps.length);o.push(...new Array(i).fill(this.steps).flat())}}o=o.slice(0,this.length)}let n=0;return o.forEach((s,i)=>{s==1?(o[i]=e.steps[n%e.steps.length],n++):o[i]=e.restSymbol}),new fr(o,e.restSymbol,e.melodicMode)}}}),qf={};wn(qf,{Melody:()=>fr,MelodyType:()=>ga});var ga,fr,ya=Ir(()=>{"use strict";Df(),kx(),If(),ga=(e=>(e.MIDI="MIDI",e.Degrees="Scale Degrees",e))(ga||{}),fr=class{constructor(e,t,r){this.steps=e===void 0?new Array:e,this.restSymbol=t===void 0?0:t,this.melodicMode=r??"Scale Degrees"}clone(){return new fr(this.steps,this.restSymbol,this.melodicMode)}static newFrom(e){let t=e.map(n=>n.restSymbol).filter(da),r=e.map(n=>n.melodicMode).filter(da);if(t.length>1||r.length>1)throw new vn(Ef);let o=e.map(n=>n.steps).flat();return new fr(o,e[0].restSymbol,e[0].melodicMode)}selfReplicate(e,t){if(t=t===void 0?2:t,!Ff(e,t))throw new vn(Mf);let r=new Array(e).fill(-1);r[0]=this.steps[0],r[1]=this.steps[1];let o,n,s,i,a=r.findIndex(u=>u==-1),c=2;do{o=r.slice(0,a);for(let u=0;u<o.length;u++){n=o[u];for(let h=1;h<=Math.log2(e);h++)s=Cx(t,h),r[u*s%e]=n}i=this.steps[c%this.steps.length],a=r.findIndex(u=>u==-1),a!=-1&&(r[a]=i),c++}while(a!=-1);let l=this.clone();return l.steps=r,l}counted(){let e=new Array;for(let r=1;r<=this.steps.length;r++){let o=new Array(r).fill(1);o.push(0);let n=this.steps.length*(r+1);new xa(o,"wrap",n).applyTo(this).steps.forEach(s=>e.push(s))}let t=this.clone();return t.steps=e,t}zigZag(){let e=this.steps.length%2==0?this.steps.length/2+1:Math.ceil(this.steps.length/2),t=this.steps.reduce((r,o,n)=>{let s=new Array(e).fill(-1).map((i,a)=>this.steps[(a+n)%this.steps.length]);return r.push(s),r.push(s.slice(1,e).reverse()),r},new Array).flat();return new fr(t)}static infinitySeries(e=[0,1],t=16,r=0){let o=new fr,n=e[0],s=e[1]-n;return o.steps=Array.from(new Array(t),(i,a)=>a+r).map(i=>n+fr.norgardInteger(i)*s),o}static norgardInteger(e){return e.toString(2).split("").map(t=>parseInt(t)).reduce((t,r)=>(r==1?t+=1:t*=-1,t),0)}}}),Pf={};wn(Pf,{MelodicVector:()=>Vf});var Vf,Ox=Ir(()=>{"use strict";ya(),Vf=class{constructor(e){this.steps=e}applyTo(e){let t=Math.ceil(e.steps.length/this.steps.length),r=new Array(t).fill(this.steps).flat().slice(0,e.steps.length),o=e.clone();return o.steps=r.map((n,s)=>e.melodicMode=="Scale Degrees"&&e.steps[s]==0?0:e.steps[s]==e.restSymbol?e.steps[s]:n+e.steps[s]),o}}}),Lf={};wn(Lf,{LindenmayerSystem:()=>Bf});var Bf,Dx=Ir(()=>{"use strict";Bf=class{constructor(e){this.axiom=e,this.string=e,this.productionRules={}}add(e){this.productionRules[e.matchStr]=e.output}rules(){return Object.keys(this.productionRules)}advance(){this.string=this.string.split(" ").map(e=>e in this.productionRules?this.productionRules[e]:e).join(" ")}matrix(){let e=new Array;e.push(new Array);let t=0,r=0,o=[t,r];return this.string.split(" ").forEach((n,s)=>{n=="["?(o=[t,r],t=e.length,e.push(new Array),r-=1):n=="]"?(t=o[0],r=o[1]):(e[t][r]=n,r+=1)}),e}}}),Wf={};wn(Wf,{MarkovChain:()=>jf});var jf,Ex=Ir(()=>{"use strict";jf=class{constructor(e){this.input=e,this.stateTransitionMatrix=this.generateStm()}get(e,t){let r=this.stateTransitionMatrix.get(`${e}:${t}`)||[];return r[Math.floor(Math.random()*r.length)]}generateStm(){return this.input.steps.reduce((e,t,r,o)=>{if(r<o.length-1){let n=r==0?t:o[r-1],s=o[r+1],i=`${n}:${t}`,a=e.get(i)||new Array;a.push(s),e.set(i,a)}return e},new Map)}}}),Gf=(ya(),bn(qf)),Mx=(Ox(),bn(Pf)),Fx=(If(),bn(Rf)),Rx=(Dx(),bn(Lf)),Ix=(Ex(),bn(Wf));qr.exports.MelodyType=Gf.MelodyType;qr.exports.Melody=Gf.Melody;qr.exports.MelodicVector=Mx.MelodicVector;qr.exports.Rhythm=Fx.Rhythm;qr.exports.LindenmayerSystem=Rx.LindenmayerSystem;qr.exports.MarkovChain=Ix.MarkovChain});var Sn=mt((got,Uf)=>{var qx=[{octave:-2,note:"C",note_full:"C-2",midi:0},{octave:-2,note:"C#",note_full:"C#-2",midi:1},{octave:-2,note:"D",note_full:"D-2",midi:2},{octave:-2,note:"D#",note_full:"D#-2",midi:3},{octave:-2,note:"E",note_full:"E-2",midi:4},{octave:-2,note:"F",note_full:"F-2",midi:5},{octave:-2,note:"F#",note_full:"F#-2",midi:6},{octave:-2,note:"G",note_full:"G-2",midi:7},{octave:-2,note:"G#",note_full:"G#-2",midi:8},{octave:-2,note:"A",note_full:"A-2",midi:9},{octave:-2,note:"A#",note_full:"A#-2",midi:10},{octave:-2,note:"B",note_full:"B-2",midi:11},{octave:-1,note:"C",note_full:"C-1",midi:12},{octave:-1,note:"C#",note_full:"C#-1",midi:13},{octave:-1,note:"D",note_full:"D-1",midi:14},{octave:-1,note:"D#",note_full:"D#-1",midi:15},{octave:-1,note:"E",note_full:"E-1",midi:16},{octave:-1,note:"F",note_full:"F-1",midi:17},{octave:-1,note:"F#",note_full:"F#-1",midi:18},{octave:-1,note:"G",note_full:"G-1",midi:19},{octave:-1,note:"G#",note_full:"G#-1",midi:20},{octave:-1,note:"A",note_full:"A-1",midi:21},{octave:-1,note:"A#",note_full:"A#-1",midi:22},{octave:-1,note:"B",note_full:"B-1",midi:23},{octave:0,note:"C",note_full:"C0",midi:24},{octave:0,note:"C#",note_full:"C#0",midi:25},{octave:0,note:"D",note_full:"D0",midi:26},{octave:0,note:"D#",note_full:"D#0",midi:27},{octave:0,note:"E",note_full:"E0",midi:28},{octave:0,note:"F",note_full:"F0",midi:29},{octave:0,note:"F#",note_full:"F#0",midi:30},{octave:0,note:"G",note_full:"G0",midi:31},{octave:0,note:"G#",note_full:"G#0",midi:32},{octave:0,note:"A",note_full:"A0",midi:33},{octave:0,note:"A#",note_full:"A#0",midi:34},{octave:0,note:"B",note_full:"B0",midi:35},{octave:1,note:"C",note_full:"C1",midi:36},{octave:1,note:"C#",note_full:"C#1",midi:37},{octave:1,note:"D",note_full:"D1",midi:38},{octave:1,note:"D#",note_full:"D#1",midi:39},{octave:1,note:"E",note_full:"E1",midi:40},{octave:1,note:"F",note_full:"F1",midi:41},{octave:1,note:"F#",note_full:"F#1",midi:42},{octave:1,note:"G",note_full:"G1",midi:43},{octave:1,note:"G#",note_full:"G#1",midi:44},{octave:1,note:"A",note_full:"A1",midi:45},{octave:1,note:"A#",note_full:"A#1",midi:46},{octave:1,note:"B",note_full:"B1",midi:47},{octave:2,note:"C",note_full:"C2",midi:48},{octave:2,note:"C#",note_full:"C#2",midi:49},{octave:2,note:"D",note_full:"D2",midi:50},{octave:2,note:"D#",note_full:"D#2",midi:51},{octave:2,note:"E",note_full:"E2",midi:52},{octave:2,note:"F",note_full:"F2",midi:53},{octave:2,note:"F#",note_full:"F#2",midi:54},{octave:2,note:"G",note_full:"G2",midi:55},{octave:2,note:"G#",note_full:"G#2",midi:56},{octave:2,note:"A",note_full:"A2",midi:57},{octave:2,note:"A#",note_full:"A#2",midi:58},{octave:2,note:"B",note_full:"B2",midi:59},{octave:3,note:"C",note_full:"C3",midi:60},{octave:3,note:"C#",note_full:"C#3",midi:61},{octave:3,note:"D",note_full:"D3",midi:62},{octave:3,note:"D#",note_full:"D#3",midi:63},{octave:3,note:"E",note_full:"E3",midi:64},{octave:3,note:"F",note_full:"F3",midi:65},{octave:3,note:"F#",note_full:"F#3",midi:66},{octave:3,note:"G",note_full:"G3",midi:67},{octave:3,note:"G#",note_full:"G#3",midi:68},{octave:3,note:"A",note_full:"A3",midi:69},{octave:3,note:"A#",note_full:"A#3",midi:70},{octave:3,note:"B",note_full:"B3",midi:71},{octave:4,note:"C",note_full:"C4",midi:72},{octave:4,note:"C#",note_full:"C#4",midi:73},{octave:4,note:"D",note_full:"D4",midi:74},{octave:4,note:"D#",note_full:"D#4",midi:75},{octave:4,note:"E",note_full:"E4",midi:76},{octave:4,note:"F",note_full:"F4",midi:77},{octave:4,note:"F#",note_full:"F#4",midi:78},{octave:4,note:"G",note_full:"G4",midi:79},{octave:4,note:"G#",note_full:"G#4",midi:80},{octave:4,note:"A",note_full:"A4",midi:81},{octave:4,note:"A#",note_full:"A#4",midi:82},{octave:4,note:"B",note_full:"B4",midi:83},{octave:5,note:"C",note_full:"C5",midi:84},{octave:5,note:"C#",note_full:"C#5",midi:85},{octave:5,note:"D",note_full:"D5",midi:86},{octave:5,note:"D#",note_full:"D#5",midi:87},{octave:5,note:"E",note_full:"E5",midi:88},{octave:5,note:"F",note_full:"F5",midi:89},{octave:5,note:"F#",note_full:"F#5",midi:90},{octave:5,note:"G",note_full:"G5",midi:91},{octave:5,note:"G#",note_full:"G#5",midi:92},{octave:5,note:"A",note_full:"A5",midi:93},{octave:5,note:"A#",note_full:"A#5",midi:94},{octave:5,note:"B",note_full:"B5",midi:95},{octave:6,note:"C",note_full:"C6",midi:96},{octave:6,note:"C#",note_full:"C#6",midi:97},{octave:6,note:"D",note_full:"D6",midi:98},{octave:6,note:"D#",note_full:"D#6",midi:99},{octave:6,note:"E",note_full:"E6",midi:100},{octave:6,note:"F",note_full:"F6",midi:101},{octave:6,note:"F#",note_full:"F#6",midi:102},{octave:6,note:"G",note_full:"G6",midi:103},{octave:6,note:"G#",note_full:"G#6",midi:104},{octave:6,note:"A",note_full:"A6",midi:105},{octave:6,note:"A#",note_full:"A#6",midi:106},{octave:6,note:"B",note_full:"B6",midi:107},{octave:7,note:"C",note_full:"C7",midi:108},{octave:7,note:"C#",note_full:"C#7",midi:109},{octave:7,note:"D",note_full:"D7",midi:110},{octave:7,note:"D#",note_full:"D#7",midi:111},{octave:7,note:"E",note_full:"E7",midi:112},{octave:7,note:"F",note_full:"F7",midi:113},{octave:7,note:"F#",note_full:"F#7",midi:114},{octave:7,note:"G",note_full:"G7",midi:115},{octave:7,note:"G#",note_full:"G#7",midi:116},{octave:7,note:"A",note_full:"A7",midi:117},{octave:7,note:"A#",note_full:"A#7",midi:118},{octave:7,note:"B",note_full:"B7",midi:119},{octave:8,note:"C",note_full:"C8",midi:120},{octave:8,note:"C#",note_full:"C#8",midi:121},{octave:8,note:"D",note_full:"D8",midi:122},{octave:8,note:"D#",note_full:"D#8",midi:123},{octave:8,note:"E",note_full:"E8",midi:124},{octave:8,note:"F",note_full:"F8",midi:125},{octave:8,note:"F#",note_full:"F#8",midi:126},{octave:8,note:"G",note_full:"G8",midi:127}];Uf.exports=qx});var Hf=mt((_ot,$f)=>{var Px=Sn(),va=class e{static width=940;static keyHeight=15;static noteRulerWidth=60;static transportPadding=15;static minNoteSize=15;constructor(t,r,o){this.d3=o,this.pianoRollSvg=this.d3.select(t[0]),this.noteRulerSvg=this.d3.select(t[1]),this.midiSequence=r;let n=this.midiSequence.slice(0).sort().filter(s=>s!==null);this.extent=[n[0],n[n.length-1]],this.activeNotes=[...Array(this.extent[1]+1-this.extent[0]).keys()].map(s=>Px[s+this.extent[0]]).reverse(),this.stepWidth=e.width/this.midiSequence.length,this.stepWidth=e.minNoteSize>this.stepWidth?e.minNoteSize:this.stepWidth,this.pianoRollWidth=this.stepWidth*this.midiSequence.length,this.xScale=this.d3.scaleLinear().domain([0,this.midiSequence.length]).range([0,this.pianoRollWidth]),this.yScale=this.d3.scaleLinear().domain([this.extent[1]+1,this.extent[0]]).range([0,e.keyHeight*this.activeNotes.length])}get sequence(){return this._sequence}set sequence(t){this._sequence=t}setNotes(t){this.keys.selectAll(".sequence-note").data(this.midiSequence.reduce((r,o,n)=>(o!=null&&r.push({step:n,note:o}),r),[])).enter().append("rect").attr("class","sequence-note").attr("width",this.stepWidth).attr("height",e.keyHeight).attr("x",r=>this.xScale(r.step)).attr("y",r=>this.yScale(r.note)-e.keyHeight).attr("fill","#09c").on("click",(r,o)=>t(o.note))}render(){let t=e.width/this.midiSequence.length;t=e.minNoteSize>t?e.minNoteSize:t,this.pianoRollSvg.select("svg .piano-roll").remove(),this.noteRulerSvg.select("svg .note-ruler").remove(),this.noteRulerSvg.attr("height",e.keyHeight*this.activeNotes.length+e.transportPadding),this.noteRulerSvg.attr("width",e.noteRulerWidth),this.pianoRollSvg.attr("height",e.keyHeight*this.activeNotes.length+e.transportPadding),this.pianoRollSvg.attr("width",t*this.midiSequence.length),this.noteRuler=this.noteRulerSvg.append("g").attr("transform",`translate(0, ${e.transportPadding})`).attr("class","note-ruler").attr("width",e.noteRulerWidth).attr("height",e.keyHeight*this.activeNotes.length),this.noteRuler.selectAll(".note-label").data(this.activeNotes).enter().append("text").text(o=>o.note).attr("fill","black").attr("font-size",12).attr("x",e.noteRulerWidth/2).attr("y",(o,n)=>n*e.keyHeight+e.keyHeight-e.keyHeight/3);let r=this.activeNotes.reduce((o,n,s)=>(n.note=="C"&&o.push({octave:n.octave,index:s}),o),[]);this.noteRuler.selectAll(".octave-label").data(r).enter().append("text").text(o=>o.octave).attr("fill","black").attr("font-size",12).attr("x",10).attr("y",o=>o.index*e.keyHeight+e.keyHeight-e.keyHeight/3),this.noteRuler.selectAll(".octave-division").data(r).enter().append("line").attr("class","octave-division").attr("x1",0).attr("y1",o=>o.index*e.keyHeight+e.keyHeight).attr("x2",e.noteRulerWidth).attr("y2",o=>o.index*e.keyHeight+e.keyHeight).attr("stroke","#333"),this.pianoRoll=this.pianoRollSvg.append("g").attr("class","piano-roll"),this.transport=this.pianoRoll.append("g").attr("class","transport").attr("width",this.pianoRollWidth).attr("height",e.transportPadding),this.transport.selectAll(".step").data([...Array(this.midiSequence.length).keys()]).enter().append("rect").attr("class",o=>`step step-${o}`).attr("width",t).attr("height",e.transportPadding).attr("x",o=>this.xScale(o)).attr("y",0).attr("fill","#999").attr("stroke","#bbb"),this.keys=this.pianoRoll.append("g").attr("transform",`translate(0, ${e.transportPadding})`).attr("class","keys").attr("width",this.pianoRollWidth).attr("height",e.keyHeight*this.activeNotes.length).attr("stroke","#aaa"),this.keys.selectAll(".key").data(this.activeNotes).enter().append("rect").attr("class","key").attr("width",this.pianoRollWidth).attr("height",e.keyHeight).attr("x",0).attr("y",(o,n)=>n*e.keyHeight).attr("fill",o=>o.note.charAt(o.note.length-1)=="#"?"#ccc":"#fff"),this.keys.selectAll(".step-division").data(new Array(this.midiSequence.length).fill(0)).enter().append("line").attr("class","step-division").attr("x1",(o,n)=>this.xScale(n)).attr("y1",0).attr("x2",(o,n)=>this.xScale(n)).attr("y2",this.activeNotes.length*e.keyHeight).attr("stroke",(o,n)=>n%4==0?"#333":"#aaa")}};$f.exports=va});var Qf=mt((xot,Zf)=>{var wa=class e{static steps=16;static drumHits=["Transport","Kick","Snare","Hat"];constructor(t,r){this.d3=r,this.wrapper=this.d3.select(t)}render(t){[""].push(...e.drumHits);let o=this.wrapper.append("div").attr("id","drum-labels").selectAll(".drum-label").data(e.drumHits).enter().append("div").attr("class","drum-label").text(s=>s=="Transport"?"":s);this.wrapper.selectAll(".drum-step").data([...Array(e.steps).keys()]).enter().append("div").attr("class","drum-step").attr("id",s=>`drum-step-${s}`).selectAll(".hit").data(s=>e.drumHits.map(i=>({step:s,hit:i}))).enter().append("button").attr("class",s=>s.hit=="Transport"?"transport":"hit").attr("id",s=>`drum-transport-${s.step}`).property("disabled",s=>s.hit=="Transport").on("click",(s,i)=>t(s,i.step,i.hit))}};Zf.exports=wa});var Ws=mt((yot,Xf)=>{var ba=class{constructor(t){this._sequence=t}get sequence(){return this._sequence}set sequence(t){this._sequence=t}shift(t){let r=new Array;for(let o=0;o<this._sequence.length;o++)this._sequence[o]==null?r.push(null):r.push(this._sequence[o]+t[o%t.length]);return r}rhythm(t,r){let o=new Array,n=this.calculateLength(t),s=0;for(let i=0;i<n;i++)t[i%t.length]==0||s>=this._sequence.length&&r=="silence"?o.push(null):(o.push(this._sequence[s%this._sequence.length]),s++);return o}calculateLength(t){let r=t.filter(o=>o!=0).length;if(r==0)return 0;{let o=Math.ceil(this._sequence.length/r);return t.length*o}}};Xf.exports=ba});var Kf=mt((vot,Yf)=>{var Sa=class{constructor(t){this.kick=new t.MembraneSynth;let r=new t.Gate(-50),o=new t.MidSideCompressor,n=new t.Gain;this.kick.chain(r,o,n),n.chain(t.Destination)}hit(t){this.kick.triggerAttackRelease("C1","16n",t)}};Yf.exports=Sa});var tm=mt((wot,Jf)=>{var Aa=class{constructor(t){this.tom=new t.MembraneSynth,this.snare=new t.NoiseSynth({noise:{type:"brown"},envelope:{attack:.005,decay:.1,sustain:.02}});let r=new t.FeedbackDelay({delayTime:"32n",feedback:.25}),o=new t.Gate(-33),n=new t.MidSideCompressor,s=new t.Gain;this.snare.chain(o,n,s),this.tom.chain(o,n,s),s.chain(t.Destination)}hit(t){this.snare.triggerAttackRelease("16n",t),this.tom.triggerAttackRelease("C2","16n",t)}};Jf.exports=Aa});var rm=mt((bot,em)=>{var Ta=class{constructor(t){this.noise=new t.NoiseSynth({noise:{type:"pink"},envelope:{attack:.002,decay:.05,sustain:.03}});let r=new t.FeedbackDelay({delayTime:"32n",feedback:.15}),o=new t.Gate(-25),n=new t.MidSideCompressor,s=new t.Gain(.3);this.noise.chain(o,n,s),s.chain(t.Destination)}hit(t){this.noise.triggerAttackRelease("32n",t)}};em.exports=Ta});var sm=mt((Sot,nm)=>{var om=Sn(),Vx=Ws(),Ca=class{constructor(t,r,o,n){this.size=t??16,this.seed=r??1,this.tonic=o??"C4",this.rhythm=n??[],this.sequence=[],this.midiSequence=[],this.noteSequence=[],this.#t(),this.#e(),this.#r()}#t(){this.sequence=[0,this.seed];let t,r,o=0;for(;this.sequence.length<this.size;)t=this.sequence.slice(o,o+2),r=t[1]-t[0],this.sequence=this.sequence.concat([this.sequence[this.sequence.length-2]+-1*r,this.sequence[this.sequence.length-1]+r]),o+=1}#e(){let t=om.findIndex(r=>r.note_full==this.tonic);this.midiSequence=this.sequence.map(r=>r+t),this.rhythm.length>0&&(this.midiSequence=new Vx(this.midiSequence).rhythm(this.rhythm,"wrap"))}#r(){this.noteSequence=this.midiSequence.map(t=>t==null?"REST":om[t].note_full)}};nm.exports=Ca});var am=mt((Aot,im)=>{var Lx=Sn(),Bx=Ws(),Na=class e{static xvStepLength=31;constructor(t,r){this.noteList=t,this.rhythm=r??[],this.sequence=[],this.midiSequence=[],this.noteSequence=[]}generate(t){t=="xv"&&this.#t()}#t(){this.sequence=new Array(e.xvStepLength).fill(-1),this.sequence[0]=this.noteList[0],this.sequence[1]=this.noteList[1];let t,r,o,n,s=this.sequence.findIndex(a=>a==-1),i=2;do{t=this.sequence.slice(0,s);for(let a=0;a<t.length;a++){r=t[a];for(let c=1;c<=Math.log2(e.xvStepLength);c++)o=2**c,this.sequence[a*o%e.xvStepLength]=r}n=this.noteList[i%this.noteList.length],s=this.sequence.findIndex(a=>a==-1),s!=-1&&(this.sequence[s]=n),i++}while(s!=-1);this.midiSequence=this.rhythm.length==0?this.sequence:new Bx(this.sequence).rhythm(this.rhythm,"wrap"),this.noteSequence=this.midiSequence.map(a=>a==null?"REST":Lx[a].note_full)}};im.exports=Na});var lm=mt((Tot,cm)=>{var js={major:{name:"Major",mode:"Ionian",steps:[0,2,2,1,2,2,2,1]},minor:{name:"Minor",mode:"Aeolian",steps:[0,2,1,2,2,1,2,2]}},Wx=(e,t)=>{let r=Math.ceil(t/js[e].steps.slice(1).length),o=js[e].steps.slice();for(let n=0;n<r-1;n++)o=o.concat(js[e].steps.slice(1));return o.slice(0,t).reduce((n,s)=>n+s,0)};cm.exports={scales:js,degree2HalfSteps:Wx}});var Eo="14.7.77";var Zt=Xs(Js());var Qa=()=>new DOMException("","AbortError");var Xa=e=>(t,r,[o,n,s],i)=>{e(t[n],[r,o,s],a=>a[0]===r&&a[1]===o,i)};var Ya=e=>(t,r,o)=>{let n=[];for(let s=0;s<o.numberOfInputs;s+=1)n.push(new Set);e.set(t,{activeInputs:n,outputs:new Set,passiveInputs:new WeakMap,renderer:r})};var Ka=e=>(t,r)=>{e.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:r})};var Ne=new WeakSet,Nn=new WeakMap,Br=new WeakMap,kn=new WeakMap,jo=new WeakMap,Wr=new WeakMap,On=new WeakMap,Go=new WeakMap,zo=new WeakMap,Uo=new WeakMap;var Ja={construct(){return Ja}},tc=e=>{try{let t=new Proxy(e,Ja);new t}catch{return!1}return!0};var ec=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,ti=(e,t)=>{let r=[],o=e.replace(/^[\s]+/,""),n=o.match(ec);for(;n!==null;){let s=n[1].slice(1,-1),i=n[0].replace(/([\s]+)?;?$/,"").replace(s,new URL(s,t).toString());r.push(i),o=o.slice(n[0].length).replace(/^[\s]+/,""),n=o.match(ec)}return[r.join(";"),o]};var rc=e=>{if(e!==void 0&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},oc=e=>{if(!tc(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(e.prototype===null||typeof e.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},nc=(e,t,r,o,n,s,i,a,c,l,u,h,p)=>{let m=0;return(f,g,_={credentials:"omit"})=>{let y=u.get(f);if(y!==void 0&&y.has(g))return Promise.resolve();let S=l.get(f);if(S!==void 0){let x=S.get(g);if(x!==void 0)return x}let N=s(f),M=N.audioWorklet===void 0?n(g).then(([x,w])=>{let[b,v]=ti(x,w),q=`${b};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${v}
})})(window,'_AWGS')`;return r(q)}).then(()=>{let x=p._AWGS.pop();if(x===void 0)throw new SyntaxError;o(N.currentTime,N.sampleRate,()=>x(class{},void 0,(w,b)=>{if(w.trim()==="")throw t();let v=zo.get(N);if(v!==void 0){if(v.has(w))throw t();oc(b),rc(b.parameterDescriptors),v.set(w,b)}else oc(b),rc(b.parameterDescriptors),zo.set(N,new Map([[w,b]]))},N.sampleRate,void 0,void 0))}):Promise.all([n(g),Promise.resolve(e(h,h))]).then(([[x,w],b])=>{let v=m+1;m=v;let[q,I]=ti(x,w),F=`${q};((AudioWorkletProcessor,registerProcessor)=>{${I}
})(${b?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${b?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${b?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${v}',class extends AudioWorkletProcessor{process(){return !1}})`,k=new Blob([F],{type:"application/javascript; charset=utf-8"}),C=URL.createObjectURL(k);return N.audioWorklet.addModule(C,_).then(()=>{if(a(N))return N;let A=i(N);return A.audioWorklet.addModule(C,_).then(()=>A)}).then(A=>{if(c===null)throw new SyntaxError;try{new c(A,`__sac${v}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(C))});return S===void 0?l.set(f,new Map([[g,M]])):S.set(g,M),M.then(()=>{let x=u.get(f);x===void 0?u.set(f,new Set([g])):x.add(g)}).finally(()=>{let x=l.get(f);x!==void 0&&x.delete(g)}),M}};var Tt=(e,t)=>{let r=e.get(t);if(r===void 0)throw new Error("A value with the given key could not be found.");return r};var Xe=(e,t)=>{let r=Array.from(e).filter(t);if(r.length>1)throw Error("More than one element was found.");if(r.length===0)throw Error("No element was found.");let[o]=r;return e.delete(o),o};var Dn=(e,t,r,o)=>{let n=Tt(e,t),s=Xe(n,i=>i[0]===r&&i[1]===o);return n.size===0&&e.delete(t),s};var ke=e=>Tt(On,e);var _e=e=>{if(Ne.has(e))throw new Error("The AudioNode is already stored.");Ne.add(e),ke(e).forEach(t=>t(!0))};var En=e=>"port"in e;var Oe=e=>{if(!Ne.has(e))throw new Error("The AudioNode is not stored.");Ne.delete(e),ke(e).forEach(t=>t(!1))};var $o=(e,t)=>{!En(e)&&t.every(r=>r.size===0)&&Oe(e)};var sc=(e,t,r,o,n,s,i,a,c,l,u,h,p)=>{let m=new WeakMap;return(f,g,_,y,S)=>{let{activeInputs:N,passiveInputs:M}=s(g),{outputs:x}=s(f),w=a(f),b=v=>{let q=c(g),I=c(f);if(v){let T=Dn(M,f,_,y);e(N,f,T,!1),!S&&!h(f)&&r(I,q,_,y),p(g)&&_e(g)}else{let T=o(N,f,_,y);t(M,y,T,!1),!S&&!h(f)&&n(I,q,_,y);let O=i(g);if(O===0)u(g)&&$o(g,N);else{let L=m.get(g);L!==void 0&&clearTimeout(L),m.set(g,setTimeout(()=>{u(g)&&$o(g,N)},O*1e3))}}};return l(x,[g,_,y],v=>v[0]===g&&v[1]===_&&v[2]===y,!0)?(w.add(b),u(f)?e(N,f,[_,y,b],!0):t(M,y,[f,_,b],!0),!0):!1}};var ic=e=>(t,r,[o,n,s],i)=>{let a=t.get(o);a===void 0?t.set(o,new Set([[n,r,s]])):e(a,[n,r,s],c=>c[0]===n&&c[1]===r,i)};var ac=e=>(t,r)=>{let o=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.connect(o).connect(t.destination);let n=()=>{r.removeEventListener("ended",n),r.disconnect(o),o.disconnect()};r.addEventListener("ended",n)};var cc=e=>(t,r)=>{e(t).add(r)};var $m={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},lc=(e,t,r,o,n,s)=>class extends e{constructor(a,c){let l=n(a),u={...$m,...c},h=o(l,u),p=s(l)?t():null;super(a,!1,h,p),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(a){this._nativeAnalyserNode.fftSize=a}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(a){let c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=a,!(a>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,r()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(a){let c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=a,!(this._nativeAnalyserNode.maxDecibels>a))throw this._nativeAnalyserNode.minDecibels=c,r()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(a){this._nativeAnalyserNode.smoothingTimeConstant=a}getByteFrequencyData(a){this._nativeAnalyserNode.getByteFrequencyData(a)}getByteTimeDomainData(a){this._nativeAnalyserNode.getByteTimeDomainData(a)}getFloatFrequencyData(a){this._nativeAnalyserNode.getFloatFrequencyData(a)}getFloatTimeDomainData(a){this._nativeAnalyserNode.getFloatTimeDomainData(a)}};var et=(e,t)=>e.context===t;var uc=(e,t,r)=>()=>{let o=new WeakMap,n=async(s,i)=>{let a=t(s);if(!et(a,i)){let l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=e(i,l)}return o.set(i,a),await r(s,i,a),a};return{render(s,i){let a=o.get(i);return a!==void 0?Promise.resolve(a):n(s,i)}}};var jr=e=>{try{e.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0};var ce=()=>new DOMException("","IndexSizeError");var Gr=e=>{e.getChannelData=(t=>r=>{try{return t.call(e,r)}catch(o){throw o.code===12?ce():o}})(e.getChannelData)};var Hm={numberOfChannels:1},hc=(e,t,r,o,n,s,i,a)=>{let c=null;return class pc{constructor(u){if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");let{length:h,numberOfChannels:p,sampleRate:m}={...Hm,...u};c===null&&(c=new n(1,1,44100));let f=o!==null&&t(s,s)?new o({length:h,numberOfChannels:p,sampleRate:m}):c.createBuffer(p,h,m);if(f.numberOfChannels===0)throw r();return typeof f.copyFromChannel!="function"?(i(f),Gr(f)):t(jr,()=>jr(f))||a(f),e.add(f),f}static[Symbol.hasInstance](u){return u!==null&&typeof u=="object"&&Object.getPrototypeOf(u)===pc.prototype||e.has(u)}}};var wt=-34028234663852886e22,_t=-wt;var Gt=e=>Ne.has(e);var Zm={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},fc=(e,t,r,o,n,s,i,a)=>class extends e{constructor(l,u){let h=s(l),p={...Zm,...u},m=n(h,p),f=i(h),g=f?t():null;super(l,!1,m,g),this._audioBufferSourceNodeRenderer=g,this._isBufferNullified=!1,this._isBufferSet=p.buffer!==null,this._nativeAudioBufferSourceNode=m,this._onended=null,this._playbackRate=r(this,f,m.playbackRate,_t,wt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(l){if(this._nativeAudioBufferSourceNode.buffer=l,l!==null){if(this._isBufferSet)throw o();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(l){this._nativeAudioBufferSourceNode.loop=l}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(l){this._nativeAudioBufferSourceNode.loopEnd=l}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(l){this._nativeAudioBufferSourceNode.loopStart=l}get onended(){return this._onended}set onended(l){let u=typeof l=="function"?a(this,l):null;this._nativeAudioBufferSourceNode.onended=u;let h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===u?l:h}get playbackRate(){return this._playbackRate}start(l=0,u=0,h){if(this._nativeAudioBufferSourceNode.start(l,u,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[l,u]:[l,u,h]),this.context.state!=="closed"){_e(this);let p=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",p),Gt(this)&&Oe(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",p)}}stop(l=0){this._nativeAudioBufferSourceNode.stop(l),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=l)}};var mc=(e,t,r,o,n)=>()=>{let s=new WeakMap,i=null,a=null,c=async(l,u)=>{let h=r(l),p=et(h,u);if(!p){let m={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=t(u,m),i!==null&&h.start(...i),a!==null&&h.stop(a)}return s.set(u,h),p?await e(u,l.playbackRate,h.playbackRate):await o(u,l.playbackRate,h.playbackRate),await n(l,u,h),h};return{set start(l){i=l},set stop(l){a=l},render(l,u){let h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}};var dc=e=>"playbackRate"in e;var gc=e=>"frequency"in e&&"gain"in e;var _c=e=>"offset"in e;var xc=e=>!("frequency"in e)&&"gain"in e;var yc=e=>"detune"in e&&"frequency"in e&&!("gain"in e);var vc=e=>"pan"in e;var kt=e=>Tt(Nn,e);var Ye=e=>Tt(kn,e);var Mn=(e,t)=>{let{activeInputs:r}=kt(e);r.forEach(n=>n.forEach(([s])=>{t.includes(e)||Mn(s,[...t,e])}));let o=dc(e)?[e.playbackRate]:En(e)?Array.from(e.parameters.values()):gc(e)?[e.Q,e.detune,e.frequency,e.gain]:_c(e)?[e.offset]:xc(e)?[e.gain]:yc(e)?[e.detune,e.frequency]:vc(e)?[e.pan]:[];for(let n of o){let s=Ye(n);s!==void 0&&s.activeInputs.forEach(([i])=>Mn(i,t))}Gt(e)&&Oe(e)};var Ke=e=>{Mn(e.destination,[])};var Fn=e=>e===void 0||typeof e=="number"||typeof e=="string"&&(e==="balanced"||e==="interactive"||e==="playback");var wc=(e,t,r,o,n,s,i,a,c)=>class extends e{constructor(u={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(u)}catch(f){throw f.code===12&&f.message==="sampleRate is not in range"?r():f}if(h===null)throw o();if(!Fn(u.latencyHint))throw new TypeError(`The provided value '${u.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(u.sampleRate!==void 0&&h.sampleRate!==u.sampleRate)throw r();super(h,2);let{latencyHint:p}=u,{sampleRate:m}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:p==="balanced"?512/m:p==="interactive"||p===void 0?256/m:p==="playback"?1024/m:Math.max(2,Math.min(128,Math.round(p*m/128)))*128/m,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";let f=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",f)};h.addEventListener("statechange",f)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Ke(this)}))}createMediaElementSource(u){return new n(this,{mediaElement:u})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(u){return new i(this,{mediaStream:u})}createMediaStreamTrackSource(u){return new a(this,{mediaStreamTrack:u})}resume(){return this._state==="suspended"?new Promise((u,h)=>{let p=()=>{this._nativeAudioContext.removeEventListener("statechange",p),this._nativeAudioContext.state==="running"?u():this.resume().then(u,h)};this._nativeAudioContext.addEventListener("statechange",p)}):this._nativeAudioContext.resume().catch(u=>{throw u===void 0||u.code===15?t():u})}suspend(){return this._nativeAudioContext.suspend().catch(u=>{throw u===void 0?t():u})}};var bc=(e,t,r,o,n,s,i,a)=>class extends e{constructor(l,u){let h=s(l),p=i(h),m=n(h,u,p),f=p?t(a):null;super(l,!1,m,f),this._isNodeOfNativeOfflineAudioContext=p,this._nativeAudioDestinationNode=m}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(l){if(this._isNodeOfNativeOfflineAudioContext)throw o();if(l>this._nativeAudioDestinationNode.maxChannelCount)throw r();this._nativeAudioDestinationNode.channelCount=l}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(l){if(this._isNodeOfNativeOfflineAudioContext)throw o();this._nativeAudioDestinationNode.channelCountMode=l}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}};var Sc=e=>{let t=new WeakMap,r=async(o,n)=>{let s=n.destination;return t.set(n,s),await e(o,n,s),s};return{render(o,n){let s=t.get(n);return s!==void 0?Promise.resolve(s):r(o,n)}}};var Ac=(e,t,r,o,n,s,i,a)=>(c,l)=>{let u=l.listener,h=()=>{let x=new Float32Array(1),w=t(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),b=i(l),v=!1,q=[0,0,-1,0,1,0],I=[0,0,0],T=()=>{if(v)return;v=!0;let k=o(l,256,9,0);k.onaudioprocess=({inputBuffer:C})=>{let A=[s(C,x,0),s(C,x,1),s(C,x,2),s(C,x,3),s(C,x,4),s(C,x,5)];A.some((R,E)=>R!==q[E])&&(u.setOrientation(...A),q=A);let P=[s(C,x,6),s(C,x,7),s(C,x,8)];P.some((R,E)=>R!==I[E])&&(u.setPosition(...P),I=P)},w.connect(k)},O=k=>C=>{C!==q[k]&&(q[k]=C,u.setOrientation(...q))},L=k=>C=>{C!==I[k]&&(I[k]=C,u.setPosition(...I))},F=(k,C,A)=>{let P=r(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:C});P.connect(w,0,k),P.start(),Object.defineProperty(P.offset,"defaultValue",{get(){return C}});let R=e({context:c},b,P.offset,_t,wt);return a(R,"value",E=>()=>E.call(R),E=>$=>{try{E.call(R,$)}catch(K){if(K.code!==9)throw K}T(),b&&A($)}),R.cancelAndHoldAtTime=(E=>b?()=>{throw n()}:(...$)=>{let K=E.apply(R,$);return T(),K})(R.cancelAndHoldAtTime),R.cancelScheduledValues=(E=>b?()=>{throw n()}:(...$)=>{let K=E.apply(R,$);return T(),K})(R.cancelScheduledValues),R.exponentialRampToValueAtTime=(E=>b?()=>{throw n()}:(...$)=>{let K=E.apply(R,$);return T(),K})(R.exponentialRampToValueAtTime),R.linearRampToValueAtTime=(E=>b?()=>{throw n()}:(...$)=>{let K=E.apply(R,$);return T(),K})(R.linearRampToValueAtTime),R.setTargetAtTime=(E=>b?()=>{throw n()}:(...$)=>{let K=E.apply(R,$);return T(),K})(R.setTargetAtTime),R.setValueAtTime=(E=>b?()=>{throw n()}:(...$)=>{let K=E.apply(R,$);return T(),K})(R.setValueAtTime),R.setValueCurveAtTime=(E=>b?()=>{throw n()}:(...$)=>{let K=E.apply(R,$);return T(),K})(R.setValueCurveAtTime),R};return{forwardX:F(0,0,O(0)),forwardY:F(1,0,O(1)),forwardZ:F(2,-1,O(2)),positionX:F(6,0,L(0)),positionY:F(7,0,L(1)),positionZ:F(8,0,L(2)),upX:F(3,0,O(3)),upY:F(4,1,O(4)),upZ:F(5,0,O(5))}},{forwardX:p,forwardY:m,forwardZ:f,positionX:g,positionY:_,positionZ:y,upX:S,upY:N,upZ:M}=u.forwardX===void 0?h():u;return{get forwardX(){return p},get forwardY(){return m},get forwardZ(){return f},get positionX(){return g},get positionY(){return _},get positionZ(){return y},get upX(){return S},get upY(){return N},get upZ(){return M}}};var dr=e=>"context"in e;var Je=e=>dr(e[0]);var xe=(e,t,r,o)=>{for(let n of e)if(r(n)){if(o)return!1;throw Error("The set contains at least one similar element.")}return e.add(t),!0};var ei=(e,t,[r,o],n)=>{xe(e,[t,r,o],s=>s[0]===t&&s[1]===r,n)};var ri=(e,[t,r,o],n)=>{let s=e.get(t);s===void 0?e.set(t,new Set([[r,o]])):xe(s,[r,o],i=>i[0]===r,n)};var le=e=>"inputs"in e;var zr=(e,t,r,o)=>{if(le(t)){let n=t.inputs[o];return e.connect(n,r,0),[n,r,0]}return e.connect(t,r,o),[t,r,o]};var oi=(e,t,r)=>{for(let o of e)if(o[0]===t&&o[1]===r)return e.delete(o),o;return null};var Tc=(e,t,r)=>Xe(e,o=>o[0]===t&&o[1]===r);var ni=(e,t)=>{if(!ke(e).delete(t))throw new Error("Missing the expected event listener.")};var si=(e,t,r)=>{let o=Tt(e,t),n=Xe(o,s=>s[0]===r);return o.size===0&&e.delete(t),n};var Ur=(e,t,r,o)=>{le(t)?e.disconnect(t.inputs[o],r,0):e.disconnect(t,r,o)};var it=e=>Tt(Br,e);var gr=e=>Tt(jo,e);var je=e=>Go.has(e);var $r=e=>!Ne.has(e);var ii=(e,t)=>new Promise(r=>{if(t!==null)r(!0);else{let o=e.createScriptProcessor(256,1,1),n=e.createGain(),s=e.createBuffer(1,2,44100),i=s.getChannelData(0);i[0]=1,i[1]=1;let a=e.createBufferSource();a.buffer=s,a.loop=!0,a.connect(o).connect(e.destination),a.connect(n),a.disconnect(n),o.onaudioprocess=c=>{let l=c.inputBuffer.getChannelData(0);Array.prototype.some.call(l,u=>u===1)?r(!0):r(!1),a.stop(),o.onaudioprocess=null,a.disconnect(o),o.disconnect(e.destination)},a.start()}});var Rn=(e,t)=>{let r=new Map;for(let o of e)for(let n of o){let s=r.get(n);r.set(n,s===void 0?1:s+1)}r.forEach((o,n)=>t(n,o))};var _r=e=>"context"in e;var Cc=e=>{let t=new Map;e.connect=(r=>(o,n=0,s=0)=>{let i=_r(o)?r(o,n,s):r(o,n),a=t.get(o);return a===void 0?t.set(o,[{input:s,output:n}]):a.every(c=>c.input!==s||c.output!==n)&&a.push({input:s,output:n}),i})(e.connect.bind(e)),e.disconnect=(r=>(o,n,s)=>{if(r.apply(e),o===void 0)t.clear();else if(typeof o=="number")for(let[i,a]of t){let c=a.filter(l=>l.output!==o);c.length===0?t.delete(i):t.set(i,c)}else if(t.has(o))if(n===void 0)t.delete(o);else{let i=t.get(o);if(i!==void 0){let a=i.filter(c=>c.output!==n&&(c.input!==s||s===void 0));a.length===0?t.delete(o):t.set(o,a)}}for(let[i,a]of t)a.forEach(c=>{_r(i)?e.connect(i,c.output,c.input):e.connect(i,c.output)})})(e.disconnect)};var Qm=(e,t,r,o)=>{let{activeInputs:n,passiveInputs:s}=Ye(t),{outputs:i}=kt(e),a=ke(e),c=l=>{let u=it(e),h=gr(t);if(l){let p=si(s,e,r);ei(n,e,p,!1),!o&&!je(e)&&u.connect(h,r)}else{let p=Tc(n,e,r);ri(s,p,!1),!o&&!je(e)&&u.disconnect(h,r)}};return xe(i,[t,r],l=>l[0]===t&&l[1]===r,!0)?(a.add(c),Gt(e)?ei(n,e,[r,c],!0):ri(s,[e,r,c],!0),!0):!1},Xm=(e,t,r,o)=>{let{activeInputs:n,passiveInputs:s}=kt(t),i=oi(n[o],e,r);return i===null?[Dn(s,e,r,o)[2],!1]:[i[2],!0]},Ym=(e,t,r)=>{let{activeInputs:o,passiveInputs:n}=Ye(t),s=oi(o,e,r);return s===null?[si(n,e,r)[1],!1]:[s[2],!0]},ai=(e,t,r,o,n)=>{let[s,i]=Xm(e,r,o,n);if(s!==null&&(ni(e,s),i&&!t&&!je(e)&&Ur(it(e),it(r),o,n)),Gt(r)){let{activeInputs:a}=kt(r);$o(r,a)}},ci=(e,t,r,o)=>{let[n,s]=Ym(e,r,o);n!==null&&(ni(e,n),s&&!t&&!je(e)&&it(e).disconnect(gr(r),o))},Km=(e,t)=>{let r=kt(e),o=[];for(let n of r.outputs)Je(n)?ai(e,t,...n):ci(e,t,...n),o.push(n[0]);return r.outputs.clear(),o},Jm=(e,t,r)=>{let o=kt(e),n=[];for(let s of o.outputs)s[1]===r&&(Je(s)?ai(e,t,...s):ci(e,t,...s),n.push(s[0]),o.outputs.delete(s));return n},td=(e,t,r,o,n)=>{let s=kt(e);return Array.from(s.outputs).filter(i=>i[0]===r&&(o===void 0||i[1]===o)&&(n===void 0||i[2]===n)).map(i=>(Je(i)?ai(e,t,...i):ci(e,t,...i),s.outputs.delete(i),i[0]))},Nc=(e,t,r,o,n,s,i,a,c,l,u,h,p,m,f,g)=>class extends l{constructor(y,S,N,M){super(N),this._context=y,this._nativeAudioNode=N;let x=u(y);h(x)&&r(ii,()=>ii(x,g))!==!0&&Cc(N),Br.set(this,N),On.set(this,new Set),y.state!=="closed"&&S&&_e(this),e(this,M,N)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(y){this._nativeAudioNode.channelCount=y}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(y){this._nativeAudioNode.channelCountMode=y}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(y){this._nativeAudioNode.channelInterpretation=y}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(y,S=0,N=0){if(S<0||S>=this._nativeAudioNode.numberOfOutputs)throw n();let M=u(this._context),x=f(M);if(p(y)||m(y))throw s();if(dr(y)){let v=it(y);try{let I=zr(this._nativeAudioNode,v,S,N),T=$r(this);(x||T)&&this._nativeAudioNode.disconnect(...I),this.context.state!=="closed"&&!T&&$r(y)&&_e(y)}catch(I){throw I.code===12?s():I}if(t(this,y,S,N,x)){let I=c([this],y);Rn(I,o(x))}return y}let w=gr(y);if(w.name==="playbackRate"&&w.maxValue===1024)throw i();try{this._nativeAudioNode.connect(w,S),(x||$r(this))&&this._nativeAudioNode.disconnect(w,S)}catch(v){throw v.code===12?s():v}if(Qm(this,y,S,x)){let v=c([this],y);Rn(v,o(x))}}disconnect(y,S,N){let M,x=u(this._context),w=f(x);if(y===void 0)M=Km(this,w);else if(typeof y=="number"){if(y<0||y>=this.numberOfOutputs)throw n();M=Jm(this,w,y)}else{if(S!==void 0&&(S<0||S>=this.numberOfOutputs)||dr(y)&&N!==void 0&&(N<0||N>=y.numberOfInputs))throw n();if(M=td(this,w,y,S,N),M.length===0)throw s()}for(let b of M){let v=c([this],b);Rn(v,a)}}};var kc=Xs(Js()),Oc=(e,t,r,o,n,s,i,a,c,l,u,h,p)=>(m,f,g,_=null,y=null)=>{let S=g.value,N=new kc.AutomationEventList(S),M=f?o(N):null,x={get defaultValue(){return S},get maxValue(){return _===null?g.maxValue:_},get minValue(){return y===null?g.minValue:y},get value(){return g.value},set value(w){g.value=w,x.setValueAtTime(w,m.context.currentTime)},cancelAndHoldAtTime(w){if(typeof g.cancelAndHoldAtTime=="function")M===null&&N.flush(m.context.currentTime),N.add(n(w)),g.cancelAndHoldAtTime(w);else{let b=Array.from(N).pop();M===null&&N.flush(m.context.currentTime),N.add(n(w));let v=Array.from(N).pop();g.cancelScheduledValues(w),b!==v&&v!==void 0&&(v.type==="exponentialRampToValue"?g.exponentialRampToValueAtTime(v.value,v.endTime):v.type==="linearRampToValue"?g.linearRampToValueAtTime(v.value,v.endTime):v.type==="setValue"?g.setValueAtTime(v.value,v.startTime):v.type==="setValueCurve"&&g.setValueCurveAtTime(v.values,v.startTime,v.duration))}return x},cancelScheduledValues(w){return M===null&&N.flush(m.context.currentTime),N.add(s(w)),g.cancelScheduledValues(w),x},exponentialRampToValueAtTime(w,b){if(w===0)throw new RangeError;if(!Number.isFinite(b)||b<0)throw new RangeError;let v=m.context.currentTime;return M===null&&N.flush(v),Array.from(N).length===0&&(N.add(l(S,v)),g.setValueAtTime(S,v)),N.add(i(w,b)),g.exponentialRampToValueAtTime(w,b),x},linearRampToValueAtTime(w,b){let v=m.context.currentTime;return M===null&&N.flush(v),Array.from(N).length===0&&(N.add(l(S,v)),g.setValueAtTime(S,v)),N.add(a(w,b)),g.linearRampToValueAtTime(w,b),x},setTargetAtTime(w,b,v){return M===null&&N.flush(m.context.currentTime),N.add(c(w,b,v)),g.setTargetAtTime(w,b,v),x},setValueAtTime(w,b){return M===null&&N.flush(m.context.currentTime),N.add(l(w,b)),g.setValueAtTime(w,b),x},setValueCurveAtTime(w,b,v){let q=w instanceof Float32Array?w:new Float32Array(w);if(h!==null&&h.name==="webkitAudioContext"){let I=b+v,T=m.context.sampleRate,O=Math.ceil(b*T),L=Math.floor(I*T),F=L-O,k=new Float32Array(F);for(let A=0;A<F;A+=1){let P=(q.length-1)/v*((O+A)/T-b),R=Math.floor(P),E=Math.ceil(P);k[A]=R===E?q[R]:(1-(P-R))*q[R]+(1-(E-P))*q[E]}M===null&&N.flush(m.context.currentTime),N.add(u(k,b,v)),g.setValueCurveAtTime(k,b,v);let C=L/T;C<I&&p(x,k[k.length-1],C),p(x,q[q.length-1],I)}else M===null&&N.flush(m.context.currentTime),N.add(u(q,b,v)),g.setValueCurveAtTime(q,b,v);return x}};return r.set(x,g),t.set(x,m),e(x,M),x};var Dc=e=>({replay(t){for(let r of e)if(r.type==="exponentialRampToValue"){let{endTime:o,value:n}=r;t.exponentialRampToValueAtTime(n,o)}else if(r.type==="linearRampToValue"){let{endTime:o,value:n}=r;t.linearRampToValueAtTime(n,o)}else if(r.type==="setTarget"){let{startTime:o,target:n,timeConstant:s}=r;t.setTargetAtTime(n,o,s)}else if(r.type==="setValue"){let{startTime:o,value:n}=r;t.setValueAtTime(n,o)}else if(r.type==="setValueCurve"){let{duration:o,startTime:n,values:s}=r;t.setValueCurveAtTime(s,n,o)}else throw new Error("Can't apply an unknown automation.")}});var Hr=class{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,r=null){return this._map.forEach((o,n)=>t.call(r,o,n,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}};var ed={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},Ec=(e,t,r,o,n,s,i,a,c,l,u,h,p,m)=>class extends t{constructor(g,_,y){var S;let N=a(g),M=c(N),x=u({...ed,...y});p(x);let w=zo.get(N),b=w?.get(_),v=M||N.state!=="closed"?N:(S=i(N))!==null&&S!==void 0?S:N,q=n(v,M?null:g.baseLatency,l,_,b,x),I=M?o(_,x,b):null;super(g,!0,q,I);let T=[];q.parameters.forEach((L,F)=>{let k=r(this,M,L);T.push([F,k])}),this._nativeAudioWorkletNode=q,this._onprocessorerror=null,this._parameters=new Hr(T),M&&e(N,this);let{activeInputs:O}=s(this);h(q,O)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(g){let _=typeof g=="function"?m(this,g):null;this._nativeAudioWorkletNode.onprocessorerror=_;let y=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=y!==null&&y===_?g:y}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function Zr(e,t,r,o,n){if(typeof e.copyFromChannel=="function")t[r].byteLength===0&&(t[r]=new Float32Array(128)),e.copyFromChannel(t[r],o,n);else{let s=e.getChannelData(o);if(t[r].byteLength===0)t[r]=s.slice(n,n+128);else{let i=new Float32Array(s.buffer,n*Float32Array.BYTES_PER_ELEMENT,128);t[r].set(i)}}}var In=(e,t,r,o,n)=>{typeof e.copyToChannel=="function"?t[r].byteLength!==0&&e.copyToChannel(t[r],o,n):t[r].byteLength!==0&&e.getChannelData(o).set(t[r],n)};var Qr=(e,t)=>{let r=[];for(let o=0;o<e;o+=1){let n=[],s=typeof t=="number"?t:t[o];for(let i=0;i<s;i+=1)n.push(new Float32Array(128));r.push(n)}return r};var Mc=(e,t)=>{let r=Tt(Uo,e),o=it(t);return Tt(r,o)};var rd=async(e,t,r,o,n,s,i)=>{let a=t===null?Math.ceil(e.context.length/128)*128:t.length,c=o.channelCount*o.numberOfInputs,l=n.reduce((_,y)=>_+y,0),u=l===0?null:r.createBuffer(l,a,r.sampleRate);if(s===void 0)throw new Error("Missing the processor constructor.");let h=kt(e),p=await Mc(r,e),m=Qr(o.numberOfInputs,o.channelCount),f=Qr(o.numberOfOutputs,n),g=Array.from(e.parameters.keys()).reduce((_,y)=>({..._,[y]:new Float32Array(128)}),{});for(let _=0;_<a;_+=128){if(o.numberOfInputs>0&&t!==null)for(let y=0;y<o.numberOfInputs;y+=1)for(let S=0;S<o.channelCount;S+=1)Zr(t,m[y],S,S,_);s.parameterDescriptors!==void 0&&t!==null&&s.parameterDescriptors.forEach(({name:y},S)=>{Zr(t,g,y,c+S,_)});for(let y=0;y<o.numberOfInputs;y+=1)for(let S=0;S<n[y];S+=1)f[y][S].byteLength===0&&(f[y][S]=new Float32Array(128));try{let y=m.map((N,M)=>h.activeInputs[M].size===0?[]:N),S=i(_/r.sampleRate,r.sampleRate,()=>p.process(y,f,g));if(u!==null)for(let N=0,M=0;N<o.numberOfOutputs;N+=1){for(let x=0;x<n[N];x+=1)In(u,f[N],x,M+x,_);M+=n[N]}if(!S)break}catch(y){e.dispatchEvent(new ErrorEvent("processorerror",{colno:y.colno,filename:y.filename,lineno:y.lineno,message:y.message}));break}}return u},Fc=(e,t,r,o,n,s,i,a,c,l,u,h,p,m,f,g)=>(_,y,S)=>{let N=new WeakMap,M=null,x=async(w,b)=>{let v=u(w),q=null,I=et(v,b),T=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(h===null){let O=T.reduce((C,A)=>C+A,0),L=n(b,{channelCount:Math.max(1,O),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,O)}),F=[];for(let C=0;C<w.numberOfOutputs;C+=1)F.push(o(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:T[C]}));let k=i(b,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});k.connect=t.bind(null,F),k.disconnect=c.bind(null,F),q=[L,F,k]}else I||(v=new h(b,_));if(N.set(b,q===null?v:q[2]),q!==null){if(M===null){if(S===void 0)throw new Error("Missing the processor constructor.");if(p===null)throw new Error("Missing the native OfflineAudioContext constructor.");let A=w.channelCount*w.numberOfInputs,P=S.parameterDescriptors===void 0?0:S.parameterDescriptors.length,R=A+P;M=rd(w,R===0?null:await(async()=>{let $=new p(R,Math.ceil(w.context.length/128)*128,b.sampleRate),K=[],Dt=[];for(let st=0;st<y.numberOfInputs;st+=1)K.push(i($,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),Dt.push(n($,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));let Rt=await Promise.all(Array.from(w.parameters.values()).map(async st=>{let vt=s($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:st.value});return await m($,st,vt.offset),vt})),X=o($,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,A+P)});for(let st=0;st<y.numberOfInputs;st+=1){K[st].connect(Dt[st]);for(let vt=0;vt<y.channelCount;vt+=1)Dt[st].connect(X,vt,st*y.channelCount+vt)}for(let[st,vt]of Rt.entries())vt.connect(X,0,A+st),vt.start(0);return X.connect($.destination),await Promise.all(K.map(st=>f(w,$,st))),g($)})(),b,y,T,S,l)}let O=await M,L=r(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[F,k,C]=q;O!==null&&(L.buffer=O,L.start(0)),L.connect(F);for(let A=0,P=0;A<w.numberOfOutputs;A+=1){let R=k[A];for(let E=0;E<T[A];E+=1)F.connect(R,P+E,E);P+=T[A]}return C}if(I)for(let[O,L]of w.parameters.entries())await e(b,L,v.parameters.get(O));else for(let[O,L]of w.parameters.entries())await m(b,L,v.parameters.get(O));return await f(w,b,v),v};return{render(w,b){a(b,w);let v=N.get(b);return v!==void 0?Promise.resolve(v):x(w,b)}}};var Rc=(e,t,r,o,n,s,i,a,c,l,u,h,p,m,f,g,_,y,S,N)=>class extends f{constructor(x,w){super(x,w),this._nativeContext=x,this._audioWorklet=e===void 0?void 0:{addModule:(b,v)=>e(this,b,v)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new n(this)}createBuffer(x,w,b){return new r({length:w,numberOfChannels:x,sampleRate:b})}createBufferSource(){return new o(this)}createChannelMerger(x=6){return new s(this,{numberOfInputs:x})}createChannelSplitter(x=6){return new i(this,{numberOfOutputs:x})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(x=1){return new u(this,{maxDelayTime:x})}createDynamicsCompressor(){return new h(this)}createGain(){return new p(this)}createIIRFilter(x,w){return new m(this,{feedback:w,feedforward:x})}createOscillator(){return new g(this)}createPanner(){return new _(this)}createPeriodicWave(x,w,b={disableNormalization:!1}){return new y(this,{...b,imag:w,real:x})}createStereoPanner(){return new S(this)}createWaveShaper(){return new N(this)}decodeAudioData(x,w,b){return l(this._nativeContext,x).then(v=>(typeof w=="function"&&w(v),v),v=>{throw typeof b=="function"&&b(v),v})}};var od={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Ic=(e,t,r,o,n,s,i,a)=>class extends e{constructor(l,u){let h=s(l),p={...od,...u},m=n(h,p),f=i(h),g=f?r():null;super(l,!1,m,g),this._Q=t(this,f,m.Q,_t,wt),this._detune=t(this,f,m.detune,1200*Math.log2(_t),-1200*Math.log2(_t)),this._frequency=t(this,f,m.frequency,l.sampleRate/2,0),this._gain=t(this,f,m.gain,40*Math.log10(_t),wt),this._nativeBiquadFilterNode=m,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,u,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,u,h)}catch(p){throw p.code===11?o():p}if(l.length!==u.length||u.length!==h.length)throw o()}};var qc=(e,t,r,o,n)=>()=>{let s=new WeakMap,i=async(a,c)=>{let l=r(a),u=et(l,c);if(!u){let h={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=t(c,h)}return s.set(c,l),u?(await e(c,a.Q,l.Q),await e(c,a.detune,l.detune),await e(c,a.frequency,l.frequency),await e(c,a.gain,l.gain)):(await o(c,a.Q,l.Q),await o(c,a.detune,l.detune),await o(c,a.frequency,l.frequency),await o(c,a.gain,l.gain)),await n(a,c,l),l};return{render(a,c){let l=s.get(c);return l!==void 0?Promise.resolve(l):i(a,c)}}};var Pc=(e,t)=>(r,o)=>{let n=t.get(r);if(n!==void 0)return n;let s=e.get(r);if(s!==void 0)return s;try{let i=o();return i instanceof Promise?(e.set(r,i),i.catch(()=>!1).then(a=>(e.delete(r),t.set(r,a),a))):(t.set(r,i),i)}catch{return t.set(r,!1),!1}};var nd={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Vc=(e,t,r,o,n)=>class extends e{constructor(i,a){let c=o(i),l={...nd,...a},u=r(c,l),h=n(c)?t():null;super(i,!1,u,h)}};var Lc=(e,t,r)=>()=>{let o=new WeakMap,n=async(s,i)=>{let a=t(s);if(!et(a,i)){let l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=e(i,l)}return o.set(i,a),await r(s,i,a),a};return{render(s,i){let a=o.get(i);return a!==void 0?Promise.resolve(a):n(s,i)}}};var sd={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Bc=(e,t,r,o,n,s)=>class extends e{constructor(a,c){let l=o(a),u=s({...sd,...c}),h=r(l,u),p=n(l)?t():null;super(a,!1,h,p)}};var Wc=(e,t,r)=>()=>{let o=new WeakMap,n=async(s,i)=>{let a=t(s);if(!et(a,i)){let l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=e(i,l)}return o.set(i,a),await r(s,i,a),a};return{render(s,i){let a=o.get(i);return a!==void 0?Promise.resolve(a):n(s,i)}}};var jc=e=>(t,r,o)=>e(r,t,o);var Gc=e=>(t,r,o=0,n=0)=>{let s=t[o];if(s===void 0)throw e();return _r(r)?s.connect(r,0,n):s.connect(r,0)};var zc=e=>(t,r)=>{let o=e(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),n=t.createBuffer(1,2,44100);return o.buffer=n,o.loop=!0,o.connect(r),o.start(),()=>{o.stop(),o.disconnect(r)}};var id={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Uc=(e,t,r,o,n,s,i)=>class extends e{constructor(c,l){let u=n(c),h={...id,...l},p=o(u,h),m=s(u),f=m?r():null;super(c,!1,p,f),this._constantSourceNodeRenderer=f,this._nativeConstantSourceNode=p,this._offset=t(this,m,p.offset,_t,wt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){let l=typeof c=="function"?i(this,c):null;this._nativeConstantSourceNode.onended=l;let u=this._nativeConstantSourceNode.onended;this._onended=u!==null&&u===l?c:u}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){_e(this);let l=()=>{this._nativeConstantSourceNode.removeEventListener("ended",l),Gt(this)&&Oe(this)};this._nativeConstantSourceNode.addEventListener("ended",l)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}};var $c=(e,t,r,o,n)=>()=>{let s=new WeakMap,i=null,a=null,c=async(l,u)=>{let h=r(l),p=et(h,u);if(!p){let m={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=t(u,m),i!==null&&h.start(i),a!==null&&h.stop(a)}return s.set(u,h),p?await e(u,l.offset,h.offset):await o(u,l.offset,h.offset),await n(l,u,h),h};return{set start(l){i=l},set stop(l){a=l},render(l,u){let h=s.get(u);return h!==void 0?Promise.resolve(h):c(l,u)}}};var Hc=e=>t=>(e[0]=t,e[0]);var ad={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Zc=(e,t,r,o,n,s)=>class extends e{constructor(a,c){let l=o(a),u={...ad,...c},h=r(l,u),m=n(l)?t():null;super(a,!1,h,m),this._isBufferNullified=!1,this._nativeConvolverNode=h,u.buffer!==null&&s(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(a){if(this._nativeConvolverNode.buffer=a,a===null&&this._nativeConvolverNode.buffer!==null){let c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,s(this,0)}else this._isBufferNullified=!1,s(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(a){this._nativeConvolverNode.normalize=a}};var Qc=(e,t,r)=>()=>{let o=new WeakMap,n=async(s,i)=>{let a=t(s);if(!et(a,i)){let l={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=e(i,l)}return o.set(i,a),le(a)?await r(s,i,a.inputs[0]):await r(s,i,a),a};return{render(s,i){let a=o.get(i);return a!==void 0?Promise.resolve(a):n(s,i)}}};var Xc=(e,t)=>(r,o,n)=>{if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(r,o,n)}catch(s){throw s.name==="SyntaxError"?e():s}};var Yc=()=>new DOMException("","DataCloneError");var li=e=>{let{port1:t,port2:r}=new MessageChannel;return new Promise(o=>{let n=()=>{r.onmessage=null,t.close(),r.close(),o()};r.onmessage=()=>n();try{t.postMessage(e,[e])}catch{}finally{n()}})};var Kc=(e,t,r,o,n,s,i,a,c,l,u)=>(h,p)=>{let m=i(h)?h:s(h);if(n.has(p)){let f=r();return Promise.reject(f)}try{n.add(p)}catch{}return t(c,()=>c(m))?m.decodeAudioData(p).then(f=>(li(p).catch(()=>{}),t(a,()=>a(f))||u(f),e.add(f),f)):new Promise((f,g)=>{let _=async()=>{try{await li(p)}catch{}},y=S=>{g(S),_()};try{m.decodeAudioData(p,S=>{typeof S.copyFromChannel!="function"&&(l(S),Gr(S)),e.add(S),_().then(()=>f(S))},S=>{y(S===null?o():S)})}catch(S){y(S)}})};var Jc=(e,t,r,o,n,s,i,a)=>(c,l)=>{let u=t.get(c);if(u===void 0)throw new Error("Missing the expected cycle count.");let h=s(c.context),p=a(h);if(u===l){if(t.delete(c),!p&&i(c)){let m=o(c),{outputs:f}=r(c);for(let g of f)if(Je(g)){let _=o(g[0]);e(m,_,g[1],g[2])}else{let _=n(g[0]);m.connect(_,g[1])}}}else t.set(c,u-l)};var cd={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},tl=(e,t,r,o,n,s,i)=>class extends e{constructor(c,l){let u=n(c),h={...cd,...l},p=o(u,h),m=s(u),f=m?r(h.maxDelayTime):null;super(c,!1,p,f),this._delayTime=t(this,m,p.delayTime),i(this,h.maxDelayTime)}get delayTime(){return this._delayTime}};var el=(e,t,r,o,n)=>s=>{let i=new WeakMap,a=async(c,l)=>{let u=r(c),h=et(u,l);if(!h){let p={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:s};u=t(l,p)}return i.set(l,u),h?await e(l,c.delayTime,u.delayTime):await o(l,c.delayTime,u.delayTime),await n(c,l,u),u};return{render(c,l){let u=i.get(l);return u!==void 0?Promise.resolve(u):a(c,l)}}};var rl=e=>(t,r,o,n)=>e(t[n],s=>s[0]===r&&s[1]===o);var ol=e=>(t,r)=>{e(t).delete(r)};var nl=e=>"delayTime"in e;var sl=(e,t,r)=>function o(n,s){let i=dr(s)?s:r(e,s);if(nl(i))return[];if(n[0]===i)return[n];if(n.includes(i))return[];let{outputs:a}=t(i);return Array.from(a).map(c=>o([...n,i],c[0])).reduce((c,l)=>c.concat(l),[])};var qn=(e,t,r)=>{let o=t[r];if(o===void 0)throw e();return o},il=e=>(t,r=void 0,o=void 0,n=0)=>r===void 0?t.forEach(s=>s.disconnect()):typeof r=="number"?qn(e,t,r).disconnect():_r(r)?o===void 0?t.forEach(s=>s.disconnect(r)):n===void 0?qn(e,t,o).disconnect(r,0):qn(e,t,o).disconnect(r,0,n):o===void 0?t.forEach(s=>s.disconnect(r)):qn(e,t,o).disconnect(r,0);var ld={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},al=(e,t,r,o,n,s,i,a)=>class extends e{constructor(l,u){let h=s(l),p={...ld,...u},m=o(h,p),f=i(h),g=f?r():null;super(l,!1,m,g),this._attack=t(this,f,m.attack),this._knee=t(this,f,m.knee),this._nativeDynamicsCompressorNode=m,this._ratio=t(this,f,m.ratio),this._release=t(this,f,m.release),this._threshold=t(this,f,m.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(l){let u=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=l,l>2)throw this._nativeDynamicsCompressorNode.channelCount=u,n()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(l){let u=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=l,l==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=u,n()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}};var cl=(e,t,r,o,n)=>()=>{let s=new WeakMap,i=async(a,c)=>{let l=r(a),u=et(l,c);if(!u){let h={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=t(c,h)}return s.set(c,l),u?(await e(c,a.attack,l.attack),await e(c,a.knee,l.knee),await e(c,a.ratio,l.ratio),await e(c,a.release,l.release),await e(c,a.threshold,l.threshold)):(await o(c,a.attack,l.attack),await o(c,a.knee,l.knee),await o(c,a.ratio,l.ratio),await o(c,a.release,l.release),await o(c,a.threshold,l.threshold)),await n(a,c,l),l};return{render(a,c){let l=s.get(c);return l!==void 0?Promise.resolve(l):i(a,c)}}};var ll=()=>new DOMException("","EncodingError");var ul=e=>t=>new Promise((r,o)=>{if(e===null){o(new SyntaxError);return}let n=e.document.head;if(n===null)o(new SyntaxError);else{let s=e.document.createElement("script"),i=new Blob([t],{type:"application/javascript"}),a=URL.createObjectURL(i),c=e.onerror,l=()=>{e.onerror=c,URL.revokeObjectURL(a)};e.onerror=(u,h,p,m,f)=>{if(h===a||h===e.location.href&&p===1&&m===1)return l(),o(f),!1;if(c!==null)return c(u,h,p,m,f)},s.onerror=()=>{l(),o(new SyntaxError)},s.onload=()=>{l(),r()},s.src=a,s.type="module",n.appendChild(s)}});var hl=e=>class{constructor(r){this._nativeEventTarget=r,this._listeners=new WeakMap}addEventListener(r,o,n){if(o!==null){let s=this._listeners.get(o);s===void 0&&(s=e(this,o),typeof o=="function"&&this._listeners.set(o,s)),this._nativeEventTarget.addEventListener(r,s,n)}}dispatchEvent(r){return this._nativeEventTarget.dispatchEvent(r)}removeEventListener(r,o,n){let s=o===null?void 0:this._listeners.get(o);this._nativeEventTarget.removeEventListener(r,s===void 0?null:s,n)}};var pl=e=>(t,r,o)=>{Object.defineProperties(e,{currentFrame:{configurable:!0,get(){return Math.round(t*r)}},currentTime:{configurable:!0,get(){return t}}});try{return o()}finally{e!==null&&(delete e.currentFrame,delete e.currentTime)}};var fl=e=>async t=>{try{let r=await fetch(t);if(r.ok)return[await r.text(),r.url]}catch{}throw e()};var ud={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},ml=(e,t,r,o,n,s)=>class extends e{constructor(a,c){let l=n(a),u={...ud,...c},h=o(l,u),p=s(l),m=p?r():null;super(a,!1,h,m),this._gain=t(this,p,h.gain,_t,wt)}get gain(){return this._gain}};var dl=(e,t,r,o,n)=>()=>{let s=new WeakMap,i=async(a,c)=>{let l=r(a),u=et(l,c);if(!u){let h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=t(c,h)}return s.set(c,l),u?await e(c,a.gain,l.gain):await o(c,a.gain,l.gain),await n(a,c,l),l};return{render(a,c){let l=s.get(c);return l!==void 0?Promise.resolve(l):i(a,c)}}};var gl=(e,t)=>r=>t(e,r);var _l=e=>t=>{let r=e(t);if(r.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return r.renderer};var xl=e=>t=>{var r;return(r=e.get(t))!==null&&r!==void 0?r:0};var yl=e=>t=>{let r=e(t);if(r.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return r.renderer};var vl=e=>t=>e.get(t);var ht=()=>new DOMException("","InvalidStateError");var wl=e=>t=>{let r=e.get(t);if(r===void 0)throw ht();return r};var bl=(e,t)=>r=>{let o=e.get(r);if(o!==void 0)return o;if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");return o=new t(1,1,44100),e.set(r,o),o};var Sl=e=>t=>{let r=e.get(t);if(r===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return r};var Xr=()=>new DOMException("","InvalidAccessError");var Al=e=>{e.getFrequencyResponse=(t=>(r,o,n)=>{if(r.length!==o.length||o.length!==n.length)throw Xr();return t.call(e,r,o,n)})(e.getFrequencyResponse)};var hd={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Tl=(e,t,r,o,n,s)=>class extends e{constructor(a,c){let l=o(a),u=n(l),h={...hd,...c},p=t(l,u?null:a.baseLatency,h),m=u?r(h.feedback,h.feedforward):null;super(a,!1,p,m),Al(p),this._nativeIIRFilterNode=p,s(this,1)}getFrequencyResponse(a,c,l){return this._nativeIIRFilterNode.getFrequencyResponse(a,c,l)}};var Pn=(e,t,r,o,n,s,i,a,c,l,u)=>{let h=l.length,p=a;for(let m=0;m<h;m+=1){let f=r[0]*l[m];for(let g=1;g<n;g+=1){let _=p-g&c-1;f+=r[g]*s[_],f-=e[g]*i[_]}for(let g=n;g<o;g+=1)f+=r[g]*s[p-g&c-1];for(let g=n;g<t;g+=1)f-=e[g]*i[p-g&c-1];s[p]=l[m],i[p]=f,p=p+1&c-1,u[m]=f}return p};var pd=(e,t,r,o)=>{let n=r instanceof Float64Array?r:new Float64Array(r),s=o instanceof Float64Array?o:new Float64Array(o),i=n.length,a=s.length,c=Math.min(i,a);if(n[0]!==1){for(let f=0;f<i;f+=1)s[f]/=n[0];for(let f=1;f<a;f+=1)n[f]/=n[0]}let l=32,u=new Float32Array(l),h=new Float32Array(l),p=t.createBuffer(e.numberOfChannels,e.length,e.sampleRate),m=e.numberOfChannels;for(let f=0;f<m;f+=1){let g=e.getChannelData(f),_=p.getChannelData(f);u.fill(0),h.fill(0),Pn(n,i,s,a,c,u,h,0,l,g,_)}return p},Cl=(e,t,r,o,n)=>(s,i)=>{let a=new WeakMap,c=null,l=async(u,h)=>{let p=null,m=t(u),f=et(m,h);if(h.createIIRFilter===void 0?p=e(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):f||(m=h.createIIRFilter(i,s)),a.set(h,p===null?m:p),p!==null){if(c===null){if(r===null)throw new Error("Missing the native OfflineAudioContext constructor.");let _=new r(u.context.destination.channelCount,u.context.length,h.sampleRate);c=(async()=>{await o(u,_,_.destination);let y=await n(_);return pd(y,h,s,i)})()}let g=await c;return p.buffer=g,p.start(0),p}return await o(u,h,m),m};return{render(u,h){let p=a.get(h);return p!==void 0?Promise.resolve(p):l(u,h)}}};var Nl=(e,t,r,o,n,s)=>i=>(a,c)=>{let l=e.get(a);if(l===void 0){if(!i&&s(a)){let u=o(a),{outputs:h}=r(a);for(let p of h)if(Je(p)){let m=o(p[0]);t(u,m,p[1],p[2])}else{let m=n(p[0]);u.disconnect(m,p[1])}}e.set(a,c)}else e.set(a,l+c)};var kl=(e,t)=>r=>{let o=e.get(r);return t(o)||t(r)};var Ol=(e,t)=>r=>e.has(r)||t(r);var Dl=(e,t)=>r=>e.has(r)||t(r);var El=(e,t)=>r=>{let o=e.get(r);return t(o)||t(r)};var Ml=e=>t=>e!==null&&t instanceof e;var Fl=e=>t=>e!==null&&typeof e.AudioNode=="function"&&t instanceof e.AudioNode;var Rl=e=>t=>e!==null&&typeof e.AudioParam=="function"&&t instanceof e.AudioParam;var Il=(e,t)=>r=>e(r)||t(r);var ql=e=>t=>e!==null&&t instanceof e;var Pl=e=>e!==null&&e.isSecureContext;var Vl=(e,t,r,o)=>class extends e{constructor(s,i){let a=r(s),c=t(a,i);if(o(a))throw TypeError();super(s,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}};var fd={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},Ll=(e,t,r,o)=>class extends e{constructor(s,i){let a=r(s);if(o(a))throw new TypeError;let c={...fd,...i},l=t(a,c);super(s,!1,l,null),this._nativeMediaStreamAudioDestinationNode=l}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}};var Bl=(e,t,r,o)=>class extends e{constructor(s,i){let a=r(s),c=t(a,i);if(o(a))throw new TypeError;super(s,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}};var Wl=(e,t,r)=>class extends e{constructor(n,s){let i=r(n),a=t(i,s);super(n,!0,a,null)}};var jl=(e,t,r,o,n)=>class extends o{constructor(i={}){if(n===null)throw new Error("Missing the native AudioContext constructor.");let a;try{a=new n(i)}catch(u){throw u.code===12&&u.message==="sampleRate is not in range"?t():u}if(a===null)throw r();if(!Fn(i.latencyHint))throw new TypeError(`The provided value '${i.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(i.sampleRate!==void 0&&a.sampleRate!==i.sampleRate)throw t();super(a,2);let{latencyHint:c}=i,{sampleRate:l}=a;if(this._baseLatency=typeof a.baseLatency=="number"?a.baseLatency:c==="balanced"?512/l:c==="interactive"||c===void 0?256/l:c==="playback"?1024/l:Math.max(2,Math.min(128,Math.round(c*l/128)))*128/l,this._nativeAudioContext=a,n.name==="webkitAudioContext"?(this._nativeGainNode=a.createGain(),this._nativeOscillatorNode=a.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(a.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,a.state==="running"){this._state="suspended";let u=()=>{this._state==="suspended"&&(this._state=null),a.removeEventListener("statechange",u)};a.addEventListener("statechange",u)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Ke(this)}))}resume(){return this._state==="suspended"?new Promise((i,a)=>{let c=()=>{this._nativeAudioContext.removeEventListener("statechange",c),this._nativeAudioContext.state==="running"?i():this.resume().then(i,a)};this._nativeAudioContext.addEventListener("statechange",c)}):this._nativeAudioContext.resume().catch(i=>{throw i===void 0||i.code===15?e():i})}suspend(){return this._nativeAudioContext.suspend().catch(i=>{throw i===void 0?e():i})}};var Gl=(e,t,r,o,n,s)=>class extends r{constructor(a,c){super(a),this._nativeContext=a,Wr.set(this,a),o(a)&&n.set(a,new Set),this._destination=new e(this,c),this._listener=t(this,a),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(a){let c=typeof a=="function"?s(this,a):null;this._nativeContext.onstatechange=c;let l=this._nativeContext.onstatechange;this._onstatechange=l!==null&&l===c?a:l}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}};var ye=e=>{let t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{let r=e.decodeAudioData(t.buffer,()=>{});return r===void 0?!1:(r.catch(()=>{}),!0)}catch{}return!1};var md={numberOfChannels:1},zl=(e,t,r,o,n)=>class extends o{constructor(i){let{length:a,numberOfChannels:c,sampleRate:l}={...md,...i},u=r(c,a,l);e(ye,()=>ye(u))||u.addEventListener("statechange",(()=>{let h=0,p=m=>{this._state==="running"&&(h>0?(u.removeEventListener("statechange",p),m.stopImmediatePropagation(),this._waitForThePromiseToSettle(m)):h+=1)};return p})()),super(u,c),this._length=a,this._nativeOfflineAudioContext=u,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(t()):(this._state="running",n(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Ke(this)}))}_waitForThePromiseToSettle(i){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(i):setTimeout(()=>this._waitForThePromiseToSettle(i))}};var Ul=(e,t)=>(r,o,n)=>{let s=new Set;return r.connect=(i=>(a,c=0,l=0)=>{let u=s.size===0;if(t(a))return i.call(r,a,c,l),e(s,[a,c,l],h=>h[0]===a&&h[1]===c&&h[2]===l,!0),u&&o(),a;i.call(r,a,c),e(s,[a,c],h=>h[0]===a&&h[1]===c,!0),u&&o()})(r.connect),r.disconnect=(i=>(a,c,l)=>{let u=s.size>0;if(a===void 0)i.apply(r),s.clear();else if(typeof a=="number"){i.call(r,a);for(let p of s)p[1]===a&&s.delete(p)}else{t(a)?i.call(r,a,c,l):i.call(r,a,c);for(let p of s)p[0]===a&&(c===void 0||p[1]===c)&&(l===void 0||p[2]===l)&&s.delete(p)}let h=s.size===0;u&&h&&n()})(r.disconnect),r};var rt=(e,t,r)=>{let o=t[r];o!==void 0&&o!==e[r]&&(e[r]=o)};var Y=(e,t)=>{rt(e,t,"channelCount"),rt(e,t,"channelCountMode"),rt(e,t,"channelInterpretation")};var ui=e=>typeof e.getFloatTimeDomainData=="function";var $l=e=>{e.getFloatTimeDomainData=t=>{let r=new Uint8Array(t.length);e.getByteTimeDomainData(r);let o=Math.max(r.length,e.fftSize);for(let n=0;n<o;n+=1)t[n]=(r[n]-128)*.0078125;return t}};var Hl=(e,t)=>(r,o)=>{let n=r.createAnalyser();if(Y(n,o),!(o.maxDecibels>o.minDecibels))throw t();return rt(n,o,"fftSize"),rt(n,o,"maxDecibels"),rt(n,o,"minDecibels"),rt(n,o,"smoothingTimeConstant"),e(ui,()=>ui(n))||$l(n),n};var Zl=e=>e===null?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null;var nt=(e,t,r)=>{let o=t[r];o!==void 0&&o!==e[r].value&&(e[r].value=o)};var Ql=e=>{e.start=(t=>{let r=!1;return(o=0,n=0,s)=>{if(r)throw ht();t.call(e,o,n,s),r=!0}})(e.start)};var Yr=e=>{e.start=(t=>(r=0,o=0,n)=>{if(typeof n=="number"&&n<0||o<0||r<0)throw new RangeError("The parameters can't be negative.");t.call(e,r,o,n)})(e.start)};var Kr=e=>{e.stop=(t=>(r=0)=>{if(r<0)throw new RangeError("The parameter can't be negative.");t.call(e,r)})(e.stop)};var Xl=(e,t,r,o,n,s,i,a,c,l,u)=>(h,p)=>{let m=h.createBufferSource();return Y(m,p),nt(m,p,"playbackRate"),rt(m,p,"buffer"),rt(m,p,"loop"),rt(m,p,"loopEnd"),rt(m,p,"loopStart"),t(r,()=>r(h))||Ql(m),t(o,()=>o(h))||c(m),t(n,()=>n(h))||l(m,h),t(s,()=>s(h))||Yr(m),t(i,()=>i(h))||u(m,h),t(a,()=>a(h))||Kr(m),e(h,m),m};var Yl=e=>e===null?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null;var Kl=(e,t)=>(r,o,n)=>{let s=r.destination;if(s.channelCount!==o)try{s.channelCount=o}catch{}n&&s.channelCountMode!=="explicit"&&(s.channelCountMode="explicit"),s.maxChannelCount===0&&Object.defineProperty(s,"maxChannelCount",{value:o});let i=e(r,{channelCount:o,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return t(i,"channelCount",a=>()=>a.call(i),a=>c=>{a.call(i,c);try{s.channelCount=c}catch(l){if(c>s.maxChannelCount)throw l}}),t(i,"channelCountMode",a=>()=>a.call(i),a=>c=>{a.call(i,c),s.channelCountMode=c}),t(i,"channelInterpretation",a=>()=>a.call(i),a=>c=>{a.call(i,c),s.channelInterpretation=c}),Object.defineProperty(i,"maxChannelCount",{get:()=>s.maxChannelCount}),i.connect(s),i};var Jl=e=>e===null?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null;var tu=e=>{let{port1:t}=new MessageChannel;try{t.postMessage(e)}finally{t.close()}};var eu=(e,t,r,o,n)=>(s,i,a,c,l,u)=>{if(a!==null)try{let h=new a(s,c,u),p=new Map,m=null;if(Object.defineProperties(h,{channelCount:{get:()=>u.channelCount,set:()=>{throw e()}},channelCountMode:{get:()=>"explicit",set:()=>{throw e()}},onprocessorerror:{get:()=>m,set:f=>{typeof m=="function"&&h.removeEventListener("processorerror",m),m=typeof f=="function"?f:null,typeof m=="function"&&h.addEventListener("processorerror",m)}}}),h.addEventListener=(f=>(...g)=>{if(g[0]==="processorerror"){let _=typeof g[1]=="function"?g[1]:typeof g[1]=="object"&&g[1]!==null&&typeof g[1].handleEvent=="function"?g[1].handleEvent:null;if(_!==null){let y=p.get(g[1]);y!==void 0?g[1]=y:(g[1]=S=>{S.type==="error"?(Object.defineProperties(S,{type:{value:"processorerror"}}),_(S)):_(new ErrorEvent(g[0],{...S}))},p.set(_,g[1]))}}return f.call(h,"error",g[1],g[2]),f.call(h,...g)})(h.addEventListener),h.removeEventListener=(f=>(...g)=>{if(g[0]==="processorerror"){let _=p.get(g[1]);_!==void 0&&(p.delete(g[1]),g[1]=_)}return f.call(h,"error",g[1],g[2]),f.call(h,g[0],g[1],g[2])})(h.removeEventListener),u.numberOfOutputs!==0){let f=r(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(f).connect(s.destination),n(h,()=>f.disconnect(),()=>f.connect(s.destination))}return h}catch(h){throw h.code===11?o():h}if(l===void 0)throw o();return tu(u),t(s,i,l,u)};var Vn=(e,t)=>e===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*t)))));var ru=e=>new Promise((t,r)=>{let{port1:o,port2:n}=new MessageChannel;o.onmessage=({data:s})=>{o.close(),n.close(),t(s)},o.onmessageerror=({data:s})=>{o.close(),n.close(),r(s)},n.postMessage(e)});var ou=async(e,t)=>{let r=await ru(t);return new e(r)};var nu=(e,t,r,o)=>{let n=Uo.get(e);n===void 0&&(n=new WeakMap,Uo.set(e,n));let s=ou(r,o);return n.set(t,s),s};var su=(e,t,r,o,n,s,i,a,c,l,u,h,p)=>(m,f,g,_)=>{if(_.numberOfInputs===0&&_.numberOfOutputs===0)throw c();let y=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(y.some(B=>B<1))throw c();if(y.length!==_.numberOfOutputs)throw t();if(_.channelCountMode!=="explicit")throw c();let S=_.channelCount*_.numberOfInputs,N=y.reduce((B,Z)=>B+Z,0),M=g.parameterDescriptors===void 0?0:g.parameterDescriptors.length;if(S+M>6||N>6)throw c();let x=new MessageChannel,w=[],b=[];for(let B=0;B<_.numberOfInputs;B+=1)w.push(i(m,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),b.push(n(m,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));let v=[];if(g.parameterDescriptors!==void 0)for(let{defaultValue:B,maxValue:Z,minValue:Nt,name:ft}of g.parameterDescriptors){let ot=s(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:_.parameterData[ft]!==void 0?_.parameterData[ft]:B===void 0?0:B});Object.defineProperties(ot.offset,{defaultValue:{get:()=>B===void 0?0:B},maxValue:{get:()=>Z===void 0?_t:Z},minValue:{get:()=>Nt===void 0?wt:Nt}}),v.push(ot)}let q=o(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,S+M)}),I=Vn(f,m.sampleRate),T=a(m,I,S+M,Math.max(1,N)),O=n(m,{channelCount:Math.max(1,N),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,N)}),L=[];for(let B=0;B<_.numberOfOutputs;B+=1)L.push(o(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[B]}));for(let B=0;B<_.numberOfInputs;B+=1){w[B].connect(b[B]);for(let Z=0;Z<_.channelCount;Z+=1)b[B].connect(q,Z,B*_.channelCount+Z)}let F=new Hr(g.parameterDescriptors===void 0?[]:g.parameterDescriptors.map(({name:B},Z)=>{let Nt=v[Z];return Nt.connect(q,0,S+Z),Nt.start(0),[B,Nt.offset]}));q.connect(T);let k=_.channelInterpretation,C=null,A=_.numberOfOutputs===0?[T]:L,P={get bufferSize(){return I},get channelCount(){return _.channelCount},set channelCount(B){throw r()},get channelCountMode(){return _.channelCountMode},set channelCountMode(B){throw r()},get channelInterpretation(){return k},set channelInterpretation(B){for(let Z of w)Z.channelInterpretation=B;k=B},get context(){return T.context},get inputs(){return w},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},get onprocessorerror(){return C},set onprocessorerror(B){typeof C=="function"&&P.removeEventListener("processorerror",C),C=typeof B=="function"?B:null,typeof C=="function"&&P.addEventListener("processorerror",C)},get parameters(){return F},get port(){return x.port2},addEventListener(...B){return T.addEventListener(B[0],B[1],B[2])},connect:e.bind(null,A),disconnect:l.bind(null,A),dispatchEvent(...B){return T.dispatchEvent(B[0])},removeEventListener(...B){return T.removeEventListener(B[0],B[1],B[2])}},R=new Map;x.port1.addEventListener=(B=>(...Z)=>{if(Z[0]==="message"){let Nt=typeof Z[1]=="function"?Z[1]:typeof Z[1]=="object"&&Z[1]!==null&&typeof Z[1].handleEvent=="function"?Z[1].handleEvent:null;if(Nt!==null){let ft=R.get(Z[1]);ft!==void 0?Z[1]=ft:(Z[1]=ot=>{u(m.currentTime,m.sampleRate,()=>Nt(ot))},R.set(Nt,Z[1]))}}return B.call(x.port1,Z[0],Z[1],Z[2])})(x.port1.addEventListener),x.port1.removeEventListener=(B=>(...Z)=>{if(Z[0]==="message"){let Nt=R.get(Z[1]);Nt!==void 0&&(R.delete(Z[1]),Z[1]=Nt)}return B.call(x.port1,Z[0],Z[1],Z[2])})(x.port1.removeEventListener);let E=null;Object.defineProperty(x.port1,"onmessage",{get:()=>E,set:B=>{typeof E=="function"&&x.port1.removeEventListener("message",E),E=typeof B=="function"?B:null,typeof E=="function"&&(x.port1.addEventListener("message",E),x.port1.start())}}),g.prototype.port=x.port1;let $=null;nu(m,P,g,_).then(B=>$=B);let Dt=Qr(_.numberOfInputs,_.channelCount),Rt=Qr(_.numberOfOutputs,y),X=g.parameterDescriptors===void 0?[]:g.parameterDescriptors.reduce((B,{name:Z})=>({...B,[Z]:new Float32Array(128)}),{}),st=!0,vt=()=>{_.numberOfOutputs>0&&T.disconnect(O);for(let B=0,Z=0;B<_.numberOfOutputs;B+=1){let Nt=L[B];for(let ft=0;ft<y[B];ft+=1)O.disconnect(Nt,Z+ft,ft);Z+=y[B]}},G=new Map;T.onaudioprocess=({inputBuffer:B,outputBuffer:Z})=>{if($!==null){let Nt=h(P);for(let ft=0;ft<I;ft+=128){for(let ot=0;ot<_.numberOfInputs;ot+=1)for(let gt=0;gt<_.channelCount;gt+=1)Zr(B,Dt[ot],gt,gt,ft);g.parameterDescriptors!==void 0&&g.parameterDescriptors.forEach(({name:ot},gt)=>{Zr(B,X,ot,S+gt,ft)});for(let ot=0;ot<_.numberOfInputs;ot+=1)for(let gt=0;gt<y[ot];gt+=1)Rt[ot][gt].byteLength===0&&(Rt[ot][gt]=new Float32Array(128));try{let ot=Dt.map((ae,Qe)=>{if(Nt[Qe].size>0)return G.set(Qe,I/128),ae;let Qs=G.get(Qe);return Qs===void 0?[]:(ae.every(wm=>wm.every(bm=>bm===0))&&(Qs===1?G.delete(Qe):G.set(Qe,Qs-1)),ae)});st=u(m.currentTime+ft/m.sampleRate,m.sampleRate,()=>$.process(ot,Rt,X));for(let ae=0,Qe=0;ae<_.numberOfOutputs;ae+=1){for(let Do=0;Do<y[ae];Do+=1)In(Z,Rt[ae],Do,Qe+Do,ft);Qe+=y[ae]}}catch(ot){st=!1,P.dispatchEvent(new ErrorEvent("processorerror",{colno:ot.colno,filename:ot.filename,lineno:ot.lineno,message:ot.message}))}if(!st){for(let ot=0;ot<_.numberOfInputs;ot+=1){w[ot].disconnect(b[ot]);for(let gt=0;gt<_.channelCount;gt+=1)b[ft].disconnect(q,gt,ot*_.channelCount+gt)}if(g.parameterDescriptors!==void 0){let ot=g.parameterDescriptors.length;for(let gt=0;gt<ot;gt+=1){let ae=v[gt];ae.disconnect(q,0,S+gt),ae.stop()}}q.disconnect(T),T.onaudioprocess=null,se?vt():ie();break}}}};let se=!1,Ht=i(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Be=()=>T.connect(Ht).connect(m.destination),ie=()=>{T.disconnect(Ht),Ht.disconnect()},Lr=()=>{if(st){ie(),_.numberOfOutputs>0&&T.connect(O);for(let B=0,Z=0;B<_.numberOfOutputs;B+=1){let Nt=L[B];for(let ft=0;ft<y[B];ft+=1)O.connect(Nt,Z+ft,ft);Z+=y[B]}}se=!0},Tn=()=>{st&&(Be(),vt()),se=!1};return Be(),p(P,Lr,Tn)};var hi=(e,t)=>{let r=e.createBiquadFilter();return Y(r,t),nt(r,t,"Q"),nt(r,t,"detune"),nt(r,t,"frequency"),nt(r,t,"gain"),rt(r,t,"type"),r};var iu=(e,t)=>(r,o)=>{let n=r.createChannelMerger(o.numberOfInputs);return e!==null&&e.name==="webkitAudioContext"&&t(r,n),Y(n,o),n};var au=e=>{let t=e.numberOfOutputs;Object.defineProperty(e,"channelCount",{get:()=>t,set:r=>{if(r!==t)throw ht()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:r=>{if(r!=="explicit")throw ht()}}),Object.defineProperty(e,"channelInterpretation",{get:()=>"discrete",set:r=>{if(r!=="discrete")throw ht()}})};var Jr=(e,t)=>{let r=e.createChannelSplitter(t.numberOfOutputs);return Y(r,t),au(r),r};var cu=(e,t,r,o,n)=>(s,i)=>{if(s.createConstantSource===void 0)return r(s,i);let a=s.createConstantSource();return Y(a,i),nt(a,i,"offset"),t(o,()=>o(s))||Yr(a),t(n,()=>n(s))||Kr(a),e(s,a),a};var ue=(e,t)=>(e.connect=t.connect.bind(t),e.disconnect=t.disconnect.bind(t),e);var lu=(e,t,r,o)=>(n,{offset:s,...i})=>{let a=n.createBuffer(1,2,44100),c=t(n,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=r(n,{...i,gain:s}),u=a.getChannelData(0);u[0]=1,u[1]=1,c.buffer=a,c.loop=!0;let h={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(f){l.channelCount=f},get channelCountMode(){return l.channelCountMode},set channelCountMode(f){l.channelCountMode=f},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(f){l.channelInterpretation=f},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(f){c.onended=f},addEventListener(...f){return c.addEventListener(f[0],f[1],f[2])},dispatchEvent(...f){return c.dispatchEvent(f[0])},removeEventListener(...f){return c.removeEventListener(f[0],f[1],f[2])},start(f=0){c.start.call(c,f)},stop(f=0){c.stop.call(c,f)}},p=()=>c.connect(l),m=()=>c.disconnect(l);return e(n,c),o(ue(h,l),p,m)};var uu=(e,t)=>(r,o)=>{let n=r.createConvolver();if(Y(n,o),o.disableNormalization===n.normalize&&(n.normalize=!o.disableNormalization),rt(n,o,"buffer"),o.channelCount>2||(t(n,"channelCount",s=>()=>s.call(n),s=>i=>{if(i>2)throw e();return s.call(n,i)}),o.channelCountMode==="max"))throw e();return t(n,"channelCountMode",s=>()=>s.call(n),s=>i=>{if(i==="max")throw e();return s.call(n,i)}),n};var pi=(e,t)=>{let r=e.createDelay(t.maxDelayTime);return Y(r,t),nt(r,t,"delayTime"),r};var hu=e=>(t,r)=>{let o=t.createDynamicsCompressor();if(Y(o,r),r.channelCount>2||r.channelCountMode==="max")throw e();return nt(o,r,"attack"),nt(o,r,"knee"),nt(o,r,"ratio"),nt(o,r,"release"),nt(o,r,"threshold"),o};var zt=(e,t)=>{let r=e.createGain();return Y(r,t),nt(r,t,"gain"),r};var pu=e=>(t,r,o)=>{if(t.createIIRFilter===void 0)return e(t,r,o);let n=t.createIIRFilter(o.feedforward,o.feedback);return Y(n,o),n};function dd(e,t){let r=t[0]*t[0]+t[1]*t[1];return[(e[0]*t[0]+e[1]*t[1])/r,(e[1]*t[0]-e[0]*t[1])/r]}function gd(e,t){return[e[0]*t[0]-e[1]*t[1],e[0]*t[1]+e[1]*t[0]]}function fu(e,t){let r=[0,0];for(let o=e.length-1;o>=0;o-=1)r=gd(r,t),r[0]+=e[o];return r}var mu=(e,t,r,o)=>(n,s,{channelCount:i,channelCountMode:a,channelInterpretation:c,feedback:l,feedforward:u})=>{let h=Vn(s,n.sampleRate),p=l instanceof Float64Array?l:new Float64Array(l),m=u instanceof Float64Array?u:new Float64Array(u),f=p.length,g=m.length,_=Math.min(f,g);if(f===0||f>20)throw o();if(p[0]===0)throw t();if(g===0||g>20)throw o();if(m[0]===0)throw t();if(p[0]!==1){for(let v=0;v<g;v+=1)m[v]/=p[0];for(let v=1;v<f;v+=1)p[v]/=p[0]}let y=r(n,h,i,i);y.channelCount=i,y.channelCountMode=a,y.channelInterpretation=c;let S=32,N=[],M=[],x=[];for(let v=0;v<i;v+=1){N.push(0);let q=new Float32Array(S),I=new Float32Array(S);q.fill(0),I.fill(0),M.push(q),x.push(I)}y.onaudioprocess=v=>{let q=v.inputBuffer,I=v.outputBuffer,T=q.numberOfChannels;for(let O=0;O<T;O+=1){let L=q.getChannelData(O),F=I.getChannelData(O);N[O]=Pn(p,f,m,g,_,M[O],x[O],N[O],S,L,F)}};let w=n.sampleRate/2;return ue({get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(v){y.channelCount=v},get channelCountMode(){return y.channelCountMode},set channelCountMode(v){y.channelCountMode=v},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(v){y.channelInterpretation=v},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...v){return y.addEventListener(v[0],v[1],v[2])},dispatchEvent(...v){return y.dispatchEvent(v[0])},getFrequencyResponse(v,q,I){if(v.length!==q.length||q.length!==I.length)throw e();let T=v.length;for(let O=0;O<T;O+=1){let L=-Math.PI*(v[O]/w),F=[Math.cos(L),Math.sin(L)],k=fu(m,F),C=fu(p,F),A=dd(k,C);q[O]=Math.sqrt(A[0]*A[0]+A[1]*A[1]),I[O]=Math.atan2(A[1],A[0])}},removeEventListener(...v){return y.removeEventListener(v[0],v[1],v[2])}},y)};var du=(e,t)=>e.createMediaElementSource(t.mediaElement);var gu=(e,t)=>{let r=e.createMediaStreamDestination();return Y(r,t),r.numberOfOutputs===1&&Object.defineProperty(r,"numberOfOutputs",{get:()=>0}),r};var _u=(e,{mediaStream:t})=>{let r=t.getAudioTracks();r.sort((s,i)=>s.id<i.id?-1:s.id>i.id?1:0);let o=r.slice(0,1),n=e.createMediaStreamSource(new MediaStream(o));return Object.defineProperty(n,"mediaStream",{value:t}),n};var xu=(e,t)=>(r,{mediaStreamTrack:o})=>{if(typeof r.createMediaStreamTrackSource=="function")return r.createMediaStreamTrackSource(o);let n=new MediaStream([o]),s=r.createMediaStreamSource(n);if(o.kind!=="audio")throw e();if(t(r))throw new TypeError;return s};var yu=e=>e===null?null:e.hasOwnProperty("OfflineAudioContext")?e.OfflineAudioContext:e.hasOwnProperty("webkitOfflineAudioContext")?e.webkitOfflineAudioContext:null;var vu=(e,t,r,o,n,s)=>(i,a)=>{let c=i.createOscillator();return Y(c,a),nt(c,a,"detune"),nt(c,a,"frequency"),a.periodicWave!==void 0?c.setPeriodicWave(a.periodicWave):rt(c,a,"type"),t(r,()=>r(i))||Yr(c),t(o,()=>o(i))||s(c,i),t(n,()=>n(i))||Kr(c),e(i,c),c};var wu=e=>(t,r)=>{let o=t.createPanner();return o.orientationX===void 0?e(t,r):(Y(o,r),nt(o,r,"orientationX"),nt(o,r,"orientationY"),nt(o,r,"orientationZ"),nt(o,r,"positionX"),nt(o,r,"positionY"),nt(o,r,"positionZ"),rt(o,r,"coneInnerAngle"),rt(o,r,"coneOuterAngle"),rt(o,r,"coneOuterGain"),rt(o,r,"distanceModel"),rt(o,r,"maxDistance"),rt(o,r,"panningModel"),rt(o,r,"refDistance"),rt(o,r,"rolloffFactor"),o)};var bu=(e,t,r,o,n,s,i,a,c,l)=>(u,{coneInnerAngle:h,coneOuterAngle:p,coneOuterGain:m,distanceModel:f,maxDistance:g,orientationX:_,orientationY:y,orientationZ:S,panningModel:N,positionX:M,positionY:x,positionZ:w,refDistance:b,rolloffFactor:v,...q})=>{let I=u.createPanner();if(q.channelCount>2||q.channelCountMode==="max")throw i();Y(I,q);let T={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},O=r(u,{...T,channelInterpretation:"speakers",numberOfInputs:6}),L=o(u,{...q,gain:1}),F=o(u,{...T,gain:1}),k=o(u,{...T,gain:0}),C=o(u,{...T,gain:0}),A=o(u,{...T,gain:0}),P=o(u,{...T,gain:0}),R=o(u,{...T,gain:0}),E=n(u,256,6,1),$=s(u,{...T,curve:new Float32Array([1,1]),oversample:"none"}),K=[_,y,S],Dt=[M,x,w],Rt=new Float32Array(1);E.onaudioprocess=({inputBuffer:G})=>{let se=[c(G,Rt,0),c(G,Rt,1),c(G,Rt,2)];se.some((Be,ie)=>Be!==K[ie])&&(I.setOrientation(...se),K=se);let Ht=[c(G,Rt,3),c(G,Rt,4),c(G,Rt,5)];Ht.some((Be,ie)=>Be!==Dt[ie])&&(I.setPosition(...Ht),Dt=Ht)},Object.defineProperty(k.gain,"defaultValue",{get:()=>0}),Object.defineProperty(C.gain,"defaultValue",{get:()=>0}),Object.defineProperty(A.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0});let X={get bufferSize(){},get channelCount(){return I.channelCount},set channelCount(G){if(G>2)throw i();L.channelCount=G,I.channelCount=G},get channelCountMode(){return I.channelCountMode},set channelCountMode(G){if(G==="max")throw i();L.channelCountMode=G,I.channelCountMode=G},get channelInterpretation(){return I.channelInterpretation},set channelInterpretation(G){L.channelInterpretation=G,I.channelInterpretation=G},get coneInnerAngle(){return I.coneInnerAngle},set coneInnerAngle(G){I.coneInnerAngle=G},get coneOuterAngle(){return I.coneOuterAngle},set coneOuterAngle(G){I.coneOuterAngle=G},get coneOuterGain(){return I.coneOuterGain},set coneOuterGain(G){if(G<0||G>1)throw t();I.coneOuterGain=G},get context(){return I.context},get distanceModel(){return I.distanceModel},set distanceModel(G){I.distanceModel=G},get inputs(){return[L]},get maxDistance(){return I.maxDistance},set maxDistance(G){if(G<0)throw new RangeError;I.maxDistance=G},get numberOfInputs(){return I.numberOfInputs},get numberOfOutputs(){return I.numberOfOutputs},get orientationX(){return F.gain},get orientationY(){return k.gain},get orientationZ(){return C.gain},get panningModel(){return I.panningModel},set panningModel(G){I.panningModel=G},get positionX(){return A.gain},get positionY(){return P.gain},get positionZ(){return R.gain},get refDistance(){return I.refDistance},set refDistance(G){if(G<0)throw new RangeError;I.refDistance=G},get rolloffFactor(){return I.rolloffFactor},set rolloffFactor(G){if(G<0)throw new RangeError;I.rolloffFactor=G},addEventListener(...G){return L.addEventListener(G[0],G[1],G[2])},dispatchEvent(...G){return L.dispatchEvent(G[0])},removeEventListener(...G){return L.removeEventListener(G[0],G[1],G[2])}};h!==X.coneInnerAngle&&(X.coneInnerAngle=h),p!==X.coneOuterAngle&&(X.coneOuterAngle=p),m!==X.coneOuterGain&&(X.coneOuterGain=m),f!==X.distanceModel&&(X.distanceModel=f),g!==X.maxDistance&&(X.maxDistance=g),_!==X.orientationX.value&&(X.orientationX.value=_),y!==X.orientationY.value&&(X.orientationY.value=y),S!==X.orientationZ.value&&(X.orientationZ.value=S),N!==X.panningModel&&(X.panningModel=N),M!==X.positionX.value&&(X.positionX.value=M),x!==X.positionY.value&&(X.positionY.value=x),w!==X.positionZ.value&&(X.positionZ.value=w),b!==X.refDistance&&(X.refDistance=b),v!==X.rolloffFactor&&(X.rolloffFactor=v),(K[0]!==1||K[1]!==0||K[2]!==0)&&I.setOrientation(...K),(Dt[0]!==0||Dt[1]!==0||Dt[2]!==0)&&I.setPosition(...Dt);let st=()=>{L.connect(I),e(L,$,0,0),$.connect(F).connect(O,0,0),$.connect(k).connect(O,0,1),$.connect(C).connect(O,0,2),$.connect(A).connect(O,0,3),$.connect(P).connect(O,0,4),$.connect(R).connect(O,0,5),O.connect(E).connect(u.destination)},vt=()=>{L.disconnect(I),a(L,$,0,0),$.disconnect(F),F.disconnect(O),$.disconnect(k),k.disconnect(O),$.disconnect(C),C.disconnect(O),$.disconnect(A),A.disconnect(O),$.disconnect(P),P.disconnect(O),$.disconnect(R),R.disconnect(O),O.disconnect(E),E.disconnect(u.destination)};return l(ue(X,I),st,vt)};var Su=e=>(t,{disableNormalization:r,imag:o,real:n})=>{let s=o instanceof Float32Array?o:new Float32Array(o),i=n instanceof Float32Array?n:new Float32Array(n),a=t.createPeriodicWave(i,s,{disableNormalization:r});if(Array.from(o).length<2)throw e();return a};var to=(e,t,r,o)=>e.createScriptProcessor(t,r,o);var Au=(e,t)=>(r,o)=>{let n=o.channelCountMode;if(n==="clamped-max")throw t();if(r.createStereoPanner===void 0)return e(r,o);let s=r.createStereoPanner();return Y(s,o),nt(s,o,"pan"),Object.defineProperty(s,"channelCountMode",{get:()=>n,set:i=>{if(i!==n)throw t()}}),s};var Tu=(e,t,r,o,n,s)=>{let a=new Float32Array([1,1]),c=Math.PI/2,l={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...l,oversample:"none"},h=(f,g,_,y)=>{let S=new Float32Array(16385),N=new Float32Array(16385);for(let q=0;q<16385;q+=1){let I=q/16384*c;S[q]=Math.cos(I),N[q]=Math.sin(I)}let M=r(f,{...l,gain:0}),x=o(f,{...u,curve:S}),w=o(f,{...u,curve:a}),b=r(f,{...l,gain:0}),v=o(f,{...u,curve:N});return{connectGraph(){g.connect(M),g.connect(w.inputs===void 0?w:w.inputs[0]),g.connect(b),w.connect(_),_.connect(x.inputs===void 0?x:x.inputs[0]),_.connect(v.inputs===void 0?v:v.inputs[0]),x.connect(M.gain),v.connect(b.gain),M.connect(y,0,0),b.connect(y,0,1)},disconnectGraph(){g.disconnect(M),g.disconnect(w.inputs===void 0?w:w.inputs[0]),g.disconnect(b),w.disconnect(_),_.disconnect(x.inputs===void 0?x:x.inputs[0]),_.disconnect(v.inputs===void 0?v:v.inputs[0]),x.disconnect(M.gain),v.disconnect(b.gain),M.disconnect(y,0,0),b.disconnect(y,0,1)}}},p=(f,g,_,y)=>{let S=new Float32Array(16385),N=new Float32Array(16385),M=new Float32Array(16385),x=new Float32Array(16385),w=Math.floor(16385/2);for(let A=0;A<16385;A+=1)if(A>w){let P=(A-w)/(16384-w)*c;S[A]=Math.cos(P),N[A]=Math.sin(P),M[A]=0,x[A]=1}else{let P=A/(16384-w)*c;S[A]=1,N[A]=0,M[A]=Math.cos(P),x[A]=Math.sin(P)}let b=t(f,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),v=r(f,{...l,gain:0}),q=o(f,{...u,curve:S}),I=r(f,{...l,gain:0}),T=o(f,{...u,curve:N}),O=o(f,{...u,curve:a}),L=r(f,{...l,gain:0}),F=o(f,{...u,curve:M}),k=r(f,{...l,gain:0}),C=o(f,{...u,curve:x});return{connectGraph(){g.connect(b),g.connect(O.inputs===void 0?O:O.inputs[0]),b.connect(v,0),b.connect(I,0),b.connect(L,1),b.connect(k,1),O.connect(_),_.connect(q.inputs===void 0?q:q.inputs[0]),_.connect(T.inputs===void 0?T:T.inputs[0]),_.connect(F.inputs===void 0?F:F.inputs[0]),_.connect(C.inputs===void 0?C:C.inputs[0]),q.connect(v.gain),T.connect(I.gain),F.connect(L.gain),C.connect(k.gain),v.connect(y,0,0),L.connect(y,0,0),I.connect(y,0,1),k.connect(y,0,1)},disconnectGraph(){g.disconnect(b),g.disconnect(O.inputs===void 0?O:O.inputs[0]),b.disconnect(v,0),b.disconnect(I,0),b.disconnect(L,1),b.disconnect(k,1),O.disconnect(_),_.disconnect(q.inputs===void 0?q:q.inputs[0]),_.disconnect(T.inputs===void 0?T:T.inputs[0]),_.disconnect(F.inputs===void 0?F:F.inputs[0]),_.disconnect(C.inputs===void 0?C:C.inputs[0]),q.disconnect(v.gain),T.disconnect(I.gain),F.disconnect(L.gain),C.disconnect(k.gain),v.disconnect(y,0,0),L.disconnect(y,0,0),I.disconnect(y,0,1),k.disconnect(y,0,1)}}},m=(f,g,_,y,S)=>{if(g===1)return h(f,_,y,S);if(g===2)return p(f,_,y,S);throw n()};return(f,{channelCount:g,channelCountMode:_,pan:y,...S})=>{if(_==="max")throw n();let N=e(f,{...S,channelCount:1,channelCountMode:_,numberOfInputs:2}),M=r(f,{...S,channelCount:g,channelCountMode:_,gain:1}),x=r(f,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:y}),{connectGraph:w,disconnectGraph:b}=m(f,g,M,x,N);Object.defineProperty(x.gain,"defaultValue",{get:()=>0}),Object.defineProperty(x.gain,"maxValue",{get:()=>1}),Object.defineProperty(x.gain,"minValue",{get:()=>-1});let v={get bufferSize(){},get channelCount(){return M.channelCount},set channelCount(O){M.channelCount!==O&&(q&&b(),{connectGraph:w,disconnectGraph:b}=m(f,O,M,x,N),q&&w()),M.channelCount=O},get channelCountMode(){return M.channelCountMode},set channelCountMode(O){if(O==="clamped-max"||O==="max")throw n();M.channelCountMode=O},get channelInterpretation(){return M.channelInterpretation},set channelInterpretation(O){M.channelInterpretation=O},get context(){return M.context},get inputs(){return[M]},get numberOfInputs(){return M.numberOfInputs},get numberOfOutputs(){return M.numberOfOutputs},get pan(){return x.gain},addEventListener(...O){return M.addEventListener(O[0],O[1],O[2])},dispatchEvent(...O){return M.dispatchEvent(O[0])},removeEventListener(...O){return M.removeEventListener(O[0],O[1],O[2])}},q=!1,I=()=>{w(),q=!0},T=()=>{b(),q=!1};return s(ue(v,N),I,T)}};var Cu=(e,t,r,o,n,s,i)=>(a,c)=>{let l=a.createWaveShaper();if(s!==null&&s.name==="webkitAudioContext"&&a.createGain().gain.automationRate===void 0)return r(a,c);Y(l,c);let u=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(u!==null&&u.length<2)throw t();rt(l,{curve:u},"curve"),rt(l,c,"oversample");let h=null,p=!1;return i(l,"curve",g=>()=>g.call(l),g=>_=>(g.call(l,_),p&&(o(_)&&h===null?h=e(a,l):!o(_)&&h!==null&&(h(),h=null)),_)),n(l,()=>{p=!0,o(l.curve)&&(h=e(a,l))},()=>{p=!1,h!==null&&(h(),h=null)})};var Nu=(e,t,r,o,n)=>(s,{curve:i,oversample:a,...c})=>{let l=s.createWaveShaper(),u=s.createWaveShaper();Y(l,c),Y(u,c);let h=r(s,{...c,gain:1}),p=r(s,{...c,gain:-1}),m=r(s,{...c,gain:1}),f=r(s,{...c,gain:-1}),g=null,_=!1,y=null,S={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(x){h.channelCount=x,p.channelCount=x,l.channelCount=x,m.channelCount=x,u.channelCount=x,f.channelCount=x},get channelCountMode(){return l.channelCountMode},set channelCountMode(x){h.channelCountMode=x,p.channelCountMode=x,l.channelCountMode=x,m.channelCountMode=x,u.channelCountMode=x,f.channelCountMode=x},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(x){h.channelInterpretation=x,p.channelInterpretation=x,l.channelInterpretation=x,m.channelInterpretation=x,u.channelInterpretation=x,f.channelInterpretation=x},get context(){return l.context},get curve(){return y},set curve(x){if(x!==null&&x.length<2)throw t();if(x===null)l.curve=x,u.curve=x;else{let w=x.length,b=new Float32Array(w+2-w%2),v=new Float32Array(w+2-w%2);b[0]=x[0],v[0]=-x[w-1];let q=Math.ceil((w+1)/2),I=(w+1)/2-1;for(let T=1;T<q;T+=1){let O=T/q*I,L=Math.floor(O),F=Math.ceil(O);b[T]=L===F?x[L]:(1-(O-L))*x[L]+(1-(F-O))*x[F],v[T]=L===F?-x[w-1-L]:-((1-(O-L))*x[w-1-L])-(1-(F-O))*x[w-1-F]}b[q]=w%2===1?x[q-1]:(x[q-2]+x[q-1])/2,l.curve=b,u.curve=v}y=x,_&&(o(y)&&g===null?g=e(s,h):g!==null&&(g(),g=null))},get inputs(){return[h]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(x){l.oversample=x,u.oversample=x},addEventListener(...x){return h.addEventListener(x[0],x[1],x[2])},dispatchEvent(...x){return h.dispatchEvent(x[0])},removeEventListener(...x){return h.removeEventListener(x[0],x[1],x[2])}};i!==null&&(S.curve=i instanceof Float32Array?i:new Float32Array(i)),a!==S.oversample&&(S.oversample=a);let N=()=>{h.connect(l).connect(m),h.connect(p).connect(u).connect(f).connect(m),_=!0,o(y)&&(g=e(s,h))},M=()=>{h.disconnect(l),l.disconnect(m),h.disconnect(p),p.disconnect(u),u.disconnect(f),f.disconnect(m),_=!1,g!==null&&(g(),g=null)};return n(ue(S,m),N,M)};var It=()=>new DOMException("","NotSupportedError");var _d={numberOfChannels:1},ku=(e,t,r,o,n)=>class extends e{constructor(i,a,c){let l;if(typeof i=="number"&&a!==void 0&&c!==void 0)l={length:a,numberOfChannels:i,sampleRate:c};else if(typeof i=="object")l=i;else throw new Error("The given parameters are not valid.");let{length:u,numberOfChannels:h,sampleRate:p}={..._d,...l},m=o(h,u,p);t(ye,()=>ye(m))||m.addEventListener("statechange",(()=>{let f=0,g=_=>{this._state==="running"&&(f>0?(m.removeEventListener("statechange",g),_.stopImmediatePropagation(),this._waitForThePromiseToSettle(_)):f+=1)};return g})()),super(m,h),this._length=u,this._nativeOfflineAudioContext=m,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(r()):(this._state="running",n(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,Ke(this)}))}_waitForThePromiseToSettle(i){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(i):setTimeout(()=>this._waitForThePromiseToSettle(i))}};var xd={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Ou=(e,t,r,o,n,s,i)=>class extends e{constructor(c,l){let u=n(c),h={...xd,...l},p=r(u,h),m=s(u),f=m?o():null,g=c.sampleRate/2;super(c,!1,p,f),this._detune=t(this,m,p.detune,153600,-153600),this._frequency=t(this,m,p.frequency,g,-g),this._nativeOscillatorNode=p,this._onended=null,this._oscillatorNodeRenderer=f,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){let l=typeof c=="function"?i(this,c):null;this._nativeOscillatorNode.onended=l;let u=this._nativeOscillatorNode.onended;this._onended=u!==null&&u===l?c:u}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){_e(this);let l=()=>{this._nativeOscillatorNode.removeEventListener("ended",l),Gt(this)&&Oe(this)};this._nativeOscillatorNode.addEventListener("ended",l)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}};var Du=(e,t,r,o,n)=>()=>{let s=new WeakMap,i=null,a=null,c=null,l=async(u,h)=>{let p=r(u),m=et(p,h);if(!m){let f={channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,detune:p.detune.value,frequency:p.frequency.value,periodicWave:i===null?void 0:i,type:p.type};p=t(h,f),a!==null&&p.start(a),c!==null&&p.stop(c)}return s.set(h,p),m?(await e(h,u.detune,p.detune),await e(h,u.frequency,p.frequency)):(await o(h,u.detune,p.detune),await o(h,u.frequency,p.frequency)),await n(u,h,p),p};return{set periodicWave(u){i=u},set start(u){a=u},set stop(u){c=u},render(u,h){let p=s.get(h);return p!==void 0?Promise.resolve(p):l(u,h)}}};var yd={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Eu=(e,t,r,o,n,s,i)=>class extends e{constructor(c,l){let u=n(c),h={...yd,...l},p=r(u,h),m=s(u),f=m?o():null;super(c,!1,p,f),this._nativePannerNode=p,this._orientationX=t(this,m,p.orientationX,_t,wt),this._orientationY=t(this,m,p.orientationY,_t,wt),this._orientationZ=t(this,m,p.orientationZ,_t,wt),this._positionX=t(this,m,p.positionX,_t,wt),this._positionY=t(this,m,p.positionY,_t,wt),this._positionZ=t(this,m,p.positionZ,_t,wt),i(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}};var Mu=(e,t,r,o,n,s,i,a,c,l)=>()=>{let u=new WeakMap,h=null,p=async(m,f)=>{let g=null,_=s(m),y={channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation},S={...y,coneInnerAngle:_.coneInnerAngle,coneOuterAngle:_.coneOuterAngle,coneOuterGain:_.coneOuterGain,distanceModel:_.distanceModel,maxDistance:_.maxDistance,panningModel:_.panningModel,refDistance:_.refDistance,rolloffFactor:_.rolloffFactor},N=et(_,f);if("bufferSize"in _)g=o(f,{...y,gain:1});else if(!N){let M={...S,orientationX:_.orientationX.value,orientationY:_.orientationY.value,orientationZ:_.orientationZ.value,positionX:_.positionX.value,positionY:_.positionY.value,positionZ:_.positionZ.value};_=n(f,M)}if(u.set(f,g===null?_:g),g!==null){if(h===null){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");let T=new i(6,m.context.length,f.sampleRate),O=t(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});O.connect(T.destination),h=(async()=>{let L=await Promise.all([m.orientationX,m.orientationY,m.orientationZ,m.positionX,m.positionY,m.positionZ].map(async(F,k)=>{let C=r(T,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:k===0?1:0});return await a(T,F,C.offset),C}));for(let F=0;F<6;F+=1)L[F].connect(O,0,F),L[F].start(0);return l(T)})()}let M=await h,x=o(f,{...y,gain:1});await c(m,f,x);let w=[];for(let T=0;T<M.numberOfChannels;T+=1)w.push(M.getChannelData(T));let b=[w[0][0],w[1][0],w[2][0]],v=[w[3][0],w[4][0],w[5][0]],q=o(f,{...y,gain:1}),I=n(f,{...S,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:v[0],positionY:v[1],positionZ:v[2]});x.connect(q).connect(I.inputs[0]),I.connect(g);for(let T=128;T<M.length;T+=128){let O=[w[0][T],w[1][T],w[2][T]],L=[w[3][T],w[4][T],w[5][T]];if(O.some((F,k)=>F!==b[k])||L.some((F,k)=>F!==v[k])){b=O,v=L;let F=T/f.sampleRate;q.gain.setValueAtTime(0,F),q=o(f,{...y,gain:0}),I=n(f,{...S,orientationX:b[0],orientationY:b[1],orientationZ:b[2],positionX:v[0],positionY:v[1],positionZ:v[2]}),q.gain.setValueAtTime(1,F),x.connect(q).connect(I.inputs[0]),I.connect(g)}}return g}return N?(await e(f,m.orientationX,_.orientationX),await e(f,m.orientationY,_.orientationY),await e(f,m.orientationZ,_.orientationZ),await e(f,m.positionX,_.positionX),await e(f,m.positionY,_.positionY),await e(f,m.positionZ,_.positionZ)):(await a(f,m.orientationX,_.orientationX),await a(f,m.orientationY,_.orientationY),await a(f,m.orientationZ,_.orientationZ),await a(f,m.positionX,_.positionX),await a(f,m.positionY,_.positionY),await a(f,m.positionZ,_.positionZ)),le(_)?await c(m,f,_.inputs[0]):await c(m,f,_),_};return{render(m,f){let g=u.get(f);return g!==void 0?Promise.resolve(g):p(m,f)}}};var vd={disableNormalization:!1},Fu=(e,t,r,o)=>class Ru{constructor(s,i){let a=t(s),c=o({...vd,...i}),l=e(a,c);return r.add(l),l}static[Symbol.hasInstance](s){return s!==null&&typeof s=="object"&&Object.getPrototypeOf(s)===Ru.prototype||r.has(s)}};var Iu=(e,t)=>(r,o,n)=>(e(o).replay(n),t(o,r,n));var qu=(e,t,r)=>async(o,n,s)=>{let i=e(o);await Promise.all(i.activeInputs.map((a,c)=>Array.from(a).map(async([l,u])=>{let p=await t(l).render(l,n),m=o.context.destination;!r(l)&&(o!==m||!r(o))&&p.connect(s,u,c)})).reduce((a,c)=>[...a,...c],[]))};var Pu=(e,t,r)=>async(o,n,s)=>{let i=t(o);await Promise.all(Array.from(i.activeInputs).map(async([a,c])=>{let u=await e(a).render(a,n);r(a)||u.connect(s,c)}))};var Vu=(e,t,r,o)=>n=>e(ye,()=>ye(n))?Promise.resolve(e(o,o)).then(s=>{if(!s){let i=r(n,512,0,1);n.oncomplete=()=>{i.onaudioprocess=null,i.disconnect()},i.onaudioprocess=()=>n.currentTime,i.connect(n.destination)}return n.startRendering()}):new Promise(s=>{let i=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.oncomplete=a=>{i.disconnect(),s(a.renderedBuffer)},i.connect(n.destination),n.startRendering()});var Lu=e=>(t,r)=>{e.set(t,r)};var Bu=e=>(t,r)=>e.set(t,r);var Wu=(e,t,r,o,n,s,i,a)=>(c,l)=>r(c).render(c,l).then(()=>Promise.all(Array.from(o(l)).map(u=>r(u).render(u,l)))).then(()=>n(l)).then(u=>(typeof u.copyFromChannel!="function"?(i(u),Gr(u)):t(s,()=>s(u))||a(u),e.add(u),u));var wd={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},ju=(e,t,r,o,n,s)=>class extends e{constructor(a,c){let l=n(a),u={...wd,...c},h=r(l,u),p=s(l),m=p?o():null;super(a,!1,h,m),this._pan=t(this,p,h.pan)}get pan(){return this._pan}};var Gu=(e,t,r,o,n)=>()=>{let s=new WeakMap,i=async(a,c)=>{let l=r(a),u=et(l,c);if(!u){let h={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=t(c,h)}return s.set(c,l),u?await e(c,a.pan,l.pan):await o(c,a.pan,l.pan),le(l)?await n(a,c,l.inputs[0]):await n(a,c,l),l};return{render(a,c){let l=s.get(c);return l!==void 0?Promise.resolve(l):i(a,c)}}};var zu=e=>()=>{if(e===null)return!1;try{new e({length:1,sampleRate:44100})}catch{return!1}return!0};var Uu=(e,t)=>async()=>{if(e===null)return!0;if(t===null)return!1;let r=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),o=new t(1,128,44100),n=URL.createObjectURL(r),s=!1,i=!1;try{await o.audioWorklet.addModule(n);let a=new e(o,"a",{numberOfOutputs:0}),c=o.createOscillator();a.port.onmessage=()=>s=!0,a.onprocessorerror=()=>i=!0,c.connect(a),c.start(0),await o.startRendering(),await new Promise(l=>setTimeout(l))}catch{}finally{URL.revokeObjectURL(n)}return s&&!i};var $u=(e,t)=>()=>{if(t===null)return Promise.resolve(!1);let r=new t(1,1,44100),o=e(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(n=>{r.oncomplete=()=>{o.disconnect(),n(r.currentTime!==0)},r.startRendering()})};var fi=()=>new DOMException("","UnknownError");var bd={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Hu=(e,t,r,o,n,s,i)=>class extends e{constructor(c,l){let u=n(c),h={...bd,...l},p=r(u,h),f=s(u)?o():null;super(c,!0,p,f),this._isCurveNullified=!1,this._nativeWaveShaperNode=p,i(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}};var Zu=(e,t,r)=>()=>{let o=new WeakMap,n=async(s,i)=>{let a=t(s);if(!et(a,i)){let l={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=e(i,l)}return o.set(i,a),le(a)?await r(s,i,a.inputs[0]):await r(s,i,a),a};return{render(s,i){let a=o.get(i);return a!==void 0?Promise.resolve(a):n(s,i)}}};var Qu=()=>typeof window>"u"?null:window;var Xu=(e,t)=>r=>{r.copyFromChannel=(o,n,s=0)=>{let i=e(s),a=e(n);if(a>=r.numberOfChannels)throw t();let c=r.length,l=r.getChannelData(a),u=o.length;for(let h=i<0?-i:0;h+i<c&&h<u;h+=1)o[h]=l[h+i]},r.copyToChannel=(o,n,s=0)=>{let i=e(s),a=e(n);if(a>=r.numberOfChannels)throw t();let c=r.length,l=r.getChannelData(a),u=o.length;for(let h=i<0?-i:0;h+i<c&&h<u;h+=1)l[h+i]=o[h]}};var Yu=e=>t=>{t.copyFromChannel=(r=>(o,n,s=0)=>{let i=e(s),a=e(n);if(i<t.length)return r.call(t,o,a,i)})(t.copyFromChannel),t.copyToChannel=(r=>(o,n,s=0)=>{let i=e(s),a=e(n);if(i<t.length)return r.call(t,o,a,i)})(t.copyToChannel)};var Ku=e=>(t,r)=>{let o=r.createBuffer(1,1,44100);t.buffer===null&&(t.buffer=o),e(t,"buffer",n=>()=>{let s=n.call(t);return s===o?null:s},n=>s=>n.call(t,s===null?o:s))};var Ju=(e,t)=>(r,o)=>{o.channelCount=1,o.channelCountMode="explicit",Object.defineProperty(o,"channelCount",{get:()=>1,set:()=>{throw e()}}),Object.defineProperty(o,"channelCountMode",{get:()=>"explicit",set:()=>{throw e()}});let n=r.createBufferSource();t(o,()=>{let a=o.numberOfInputs;for(let c=0;c<a;c+=1)n.connect(o,0,c)},()=>n.disconnect(o))};var mi=(e,t,r)=>e.copyFromChannel===void 0?e.getChannelData(r)[0]:(e.copyFromChannel(t,r),t[0]);var di=e=>{if(e===null)return!1;let t=e.length;return t%2!==0?e[Math.floor(t/2)]!==0:e[t/2-1]+e[t/2]!==0};var eo=(e,t,r,o)=>{let n=e;for(;!n.hasOwnProperty(t);)n=Object.getPrototypeOf(n);let{get:s,set:i}=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,{get:r(s),set:o(i)})};var th=e=>({...e,outputChannelCount:e.outputChannelCount!==void 0?e.outputChannelCount:e.numberOfInputs===1&&e.numberOfOutputs===1?[e.channelCount]:Array.from({length:e.numberOfOutputs},()=>1)});var eh=e=>({...e,channelCount:e.numberOfOutputs});var rh=e=>{let{imag:t,real:r}=e;return t===void 0?r===void 0?{...e,imag:[0,0],real:[0,0]}:{...e,imag:Array.from(r,()=>0),real:r}:r===void 0?{...e,imag:t,real:Array.from(t,()=>0)}:{...e,imag:t,real:r}};var gi=(e,t,r)=>{try{e.setValueAtTime(t,r)}catch(o){if(o.code!==9)throw o;gi(e,t,r+1e-7)}};var oh=e=>{let t=e.createBufferSource();t.start();try{t.start()}catch{return!0}return!1};var nh=e=>{let t=e.createBufferSource(),r=e.createBuffer(1,1,44100);t.buffer=r;try{t.start(0,1)}catch{return!1}return!0};var sh=e=>{let t=e.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0};var Ln=e=>{let t=e.createOscillator();try{t.start(-1)}catch(r){return r instanceof RangeError}return!1};var _i=e=>{let t=e.createBuffer(1,1,44100),r=e.createBufferSource();r.buffer=t,r.start(),r.stop();try{return r.stop(),!0}catch{return!1}};var Bn=e=>{let t=e.createOscillator();try{t.stop(-1)}catch(r){return r instanceof RangeError}return!1};var ih=e=>{let{port1:t,port2:r}=new MessageChannel;try{t.postMessage(e)}finally{t.close(),r.close()}};var ah=e=>{e.start=(t=>(r=0,o=0,n)=>{let s=e.buffer,i=s===null?o:Math.min(s.duration,o);s!==null&&i>s.duration-.5/e.context.sampleRate?t.call(e,r,0,0):t.call(e,r,i,n)})(e.start)};var xi=(e,t)=>{let r=t.createGain();e.connect(r);let o=(n=>()=>{n.call(e,r),e.removeEventListener("ended",o)})(e.disconnect);e.addEventListener("ended",o),ue(e,r),e.stop=(n=>{let s=!1;return(i=0)=>{if(s)try{n.call(e,i)}catch{r.gain.setValueAtTime(0,i)}else n.call(e,i),s=!0}})(e.stop)};var xr=(e,t)=>r=>{let o={value:e};return Object.defineProperties(r,{currentTarget:o,target:o}),typeof t=="function"?t.call(e,r):t.handleEvent.call(e,r)};var Sd=Xa(xe),Ad=ic(xe),Td=rl(Xe),lh=new WeakMap,Cd=xl(lh),he=Pc(new Map,new WeakMap),De=Qu(),uh=Hl(he,ce),yi=_l(kt),qt=qu(kt,yi,je),Nd=uc(uh,it,qt),ct=wl(Wr),Ge=yu(De),at=ql(Ge),hh=new WeakMap,ph=hl(xr),ro=Yl(De),vi=Ml(ro),wi=Fl(De),fh=Rl(De),Ho=Jl(De),bt=Nc(Ya(Nn),sc(Sd,Ad,zr,Td,Ur,kt,Cd,ke,it,xe,Gt,je,$r),he,Nl(Go,Ur,kt,it,gr,Gt),ce,Xr,It,Jc(zr,Go,kt,it,gr,ct,Gt,at),sl(hh,kt,Tt),ph,ct,vi,wi,fh,at,Ho),kd=lc(bt,Nd,ce,uh,ct,at);var bi=new WeakSet,ch=Zl(De),mh=Hc(new Uint32Array(1)),Si=Xu(mh,ce),Ai=Yu(mh),Od=hc(bi,he,It,ch,Ge,zu(ch),Si,Ai);var Wn=ac(zt),dh=Pu(yi,Ye,je),Ee=jc(dh),oo=Xl(Wn,he,oh,nh,sh,Ln,_i,Bn,ah,Ku(eo),xi),Me=Iu(yl(Ye),dh),Dd=mc(Ee,oo,it,Me,qt),ve=Oc(Ka(kn),hh,jo,Dc,Zt.createCancelAndHoldAutomationEvent,Zt.createCancelScheduledValuesAutomationEvent,Zt.createExponentialRampToValueAutomationEvent,Zt.createLinearRampToValueAutomationEvent,Zt.createSetTargetAutomationEvent,Zt.createSetValueAutomationEvent,Zt.createSetValueCurveAutomationEvent,ro,gi),Ed=fc(bt,Dd,ve,ht,oo,ct,at,xr);var Md=bc(bt,Sc,ce,ht,Kl(zt,eo),ct,at,qt),Fd=qc(Ee,hi,it,Me,qt),yr=Bu(lh),Rd=Ic(bt,ve,Fd,Xr,hi,ct,at,yr),tr=Ul(xe,wi),Id=Ju(ht,tr),er=iu(ro,Id),qd=Lc(er,it,qt),Pd=Vc(bt,qd,er,ct,at),Vd=Wc(Jr,it,qt),Ld=Bc(bt,Vd,Jr,ct,at,eh),Bd=lu(Wn,oo,zt,tr),no=cu(Wn,he,Bd,Ln,Bn),Wd=$c(Ee,no,it,Me,qt),jd=Uc(bt,ve,Wd,no,ct,at,xr),gh=uu(It,eo),Gd=Qc(gh,it,qt),zd=Zc(bt,Gd,gh,ct,at,yr),Ud=el(Ee,pi,it,Me,qt),$d=tl(bt,ve,Ud,pi,ct,at,yr),_h=hu(It),Hd=cl(Ee,_h,it,Me,qt),Zd=al(bt,ve,Hd,_h,It,ct,at,yr),Qd=dl(Ee,zt,it,Me,qt),Xd=ml(bt,ve,Qd,zt,ct,at),Yd=mu(Xr,ht,to,It),jn=Vu(he,zt,to,$u(zt,Ge)),Kd=Cl(oo,it,Ge,qt,jn),Jd=pu(Yd),tg=Tl(bt,Jd,Kd,ct,at,yr),eg=Ac(ve,er,no,to,It,mi,at,eo),xh=new WeakMap,Ti=Gl(Md,eg,ph,at,xh,xr),yh=vu(Wn,he,Ln,_i,Bn,xi),rg=Du(Ee,yh,it,Me,qt),og=Ou(bt,ve,yh,rg,ct,at,xr),vh=zc(oo),ng=Nu(vh,ht,zt,di,tr),Gn=Cu(vh,ht,ng,di,tr,ro,eo),sg=bu(zr,ht,er,zt,to,Gn,It,Ur,mi,tr),wh=wu(sg),ig=Mu(Ee,er,no,zt,wh,it,Ge,Me,qt,jn),ag=Eu(bt,ve,wh,ig,ct,at,yr),cg=Su(ce),lg=Fu(cg,ct,new WeakSet,rh),ug=Tu(er,Jr,zt,Gn,It,tr),bh=Au(ug,It),hg=Gu(Ee,bh,it,Me,qt),pg=ju(bt,ve,bh,hg,ct,at),fg=Zu(Gn,it,qt),mg=Hu(bt,ht,Gn,fg,ct,at,yr),Sh=Pl(De),Ci=pl(De),Ah=new WeakMap,dg=bl(Ah,Ge),gg=Sh?nc(he,It,ul(De),Ci,fl(Qa),ct,dg,at,Ho,new WeakMap,new WeakMap,Uu(Ho,Ge),De):void 0,_g=Il(vi,at),xg=Kc(bi,he,Yc,ll,new WeakSet,ct,_g,jr,ye,Si,Ai),Th=Rc(gg,kd,Od,Ed,Rd,Pd,Ld,jd,zd,xg,$d,Zd,Xd,tg,Ti,og,ag,lg,pg,mg),yg=Vl(bt,du,ct,at),vg=Ll(bt,gu,ct,at),wg=Bl(bt,_u,ct,at),bg=xu(ht,at),Sg=Wl(bt,bg,ct),Ch=wc(Th,ht,It,fi,yg,vg,wg,Sg,ro);var Ni=Sl(xh),Ag=cc(Ni),Nh=Gc(ce),Tg=ol(Ni),kh=il(ce),Oh=new WeakMap,Cg=gl(Oh,Tt),Ng=su(Nh,ce,ht,er,Jr,no,zt,to,It,kh,Ci,Cg,tr),kg=eu(ht,Ng,zt,It,tr),Og=Fc(Ee,Nh,oo,er,Jr,no,zt,Tg,kh,Ci,it,Ho,Ge,Me,qt,jn),Dg=vl(Ah),Eg=Lu(Oh),ki=Sh?Ec(Ag,bt,ve,Og,kg,kt,Dg,ct,at,Ho,th,Eg,ih,xr):void 0;var MV=jl(ht,It,fi,Ti,ro);var Dh=Xc(It,Ge),Eh=Wu(bi,he,yi,Ni,jn,jr,Si,Ai),FV=zl(he,ht,Dh,Ti,Eh);var Mh=ku(Th,he,ht,Dh,Eh);var Fh=kl(Wr,vi),Rh=Ol(Br,wi),Ih=Dl(jo,fh),qh=El(Wr,at);function j(e,t){if(!e)throw new Error(t)}function Et(e,t,r=1/0){if(!(t<=e&&e<=r))throw new RangeError(`Value must be within [${t}, ${r}], got: ${e}`)}function zn(e){!e.isOffline&&e.state!=="running"&&Zo('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}var Ph=console;function Vh(...e){Ph.log(...e)}function Zo(...e){Ph.warn(...e)}function Ct(e){return typeof e>"u"}function U(e){return!Ct(e)}function Lh(e){return typeof e=="function"}function Pt(e){return typeof e=="number"}function we(e){return Object.prototype.toString.call(e)==="[object Object]"&&e.constructor===Object}function Un(e){return typeof e=="boolean"}function St(e){return Array.isArray(e)}function Mt(e){return typeof e=="string"}function Qo(e){return Mt(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)}function Bh(e){return new Ch(e)}function Wh(e,t,r){return new Mh(e,t,r)}var Fe=typeof self=="object"?self:null,jh=Fe&&(Fe.hasOwnProperty("AudioContext")||Fe.hasOwnProperty("webkitAudioContext"));function Gh(e,t,r){return j(U(ki),"This node only works in a secure context (https or localhost)"),new ki(e,t,r)}function Wt(e,t,r,o){var n=arguments.length,s=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,r):o,i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s}function J(e,t,r,o){function n(s){return s instanceof r?s:new r(function(i){i(s)})}return new(r||(r=Promise))(function(s,i){function a(u){try{l(o.next(u))}catch(h){i(h)}}function c(u){try{l(o.throw(u))}catch(h){i(h)}}function l(u){u.done?s(u.value):n(u.value).then(a,c)}l((o=o.apply(e,t||[])).next())})}var $n=class{constructor(t,r,o){this._callback=t,this._type=r,this._updateInterval=o,this._createClock()}_createWorker(){let t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),r=URL.createObjectURL(t),o=new Worker(r);o.onmessage=this._callback.bind(this),this._worker=o}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(t*1e3,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}};function be(e){return Ih(e)}function Re(e){return Rh(e)}function so(e){return qh(e)}function rr(e){return Fh(e)}function Hn(e){return e instanceof AudioBuffer}function Rg(e,t){return e==="value"||be(t)||Re(t)||Hn(t)}function Se(e,...t){if(!t.length)return e;let r=t.shift();if(we(e)&&we(r))for(let o in r)Rg(o,r[o])?e[o]=r[o]:we(r[o])?(e[o]||Object.assign(e,{[o]:{}}),Se(e[o],r[o])):Object.assign(e,{[o]:r[o]});return Se(e,...t)}function zh(e,t){return e.length===t.length&&e.every((r,o)=>t[o]===r)}function d(e,t,r=[],o){let n={},s=Array.from(t);if(we(s[0])&&o&&!Reflect.has(s[0],o)&&(Object.keys(s[0]).some(a=>Reflect.has(e,a))||(Se(n,{[o]:s[0]}),r.splice(r.indexOf(o),1),s.shift())),s.length===1&&we(s[0]))Se(n,s[0]);else for(let i=0;i<r.length;i++)U(s[i])&&(n[r[i]]=s[i]);return Se(e,n)}function Uh(e){return e.constructor.getDefaults()}function Qt(e,t){return Ct(e)?t:e}function pe(e,t){return t.forEach(r=>{Reflect.has(e,r)&&delete e[r]}),e}var Ot=class{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Fe&&this.toString()===Fe.TONE_DEBUG_CLASS)&&Vh(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}};Ot.version=Eo;function io(e,t){return e>t+1e-6}function Xo(e,t){return io(e,t)||Ut(e,t)}function Zn(e,t){return e+1e-6<t}function Ut(e,t){return Math.abs(e-t)<1e-6}function Oi(e,t,r){return Math.max(Math.min(e,r),t)}var Ft=class e extends Ot{constructor(){super(),this.name="Timeline",this._timeline=[];let t=d(e.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(j(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){let r=this._timeline[this.length-1];j(Xo(t.time,r.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{let r=this._search(t.time);this._timeline.splice(r+1,0,t)}if(this.length>this.memory){let r=this.length-this.memory;this._timeline.splice(0,r)}return this}remove(t){let r=this._timeline.indexOf(t);return r!==-1&&this._timeline.splice(r,1),this}get(t,r="time"){let o=this._search(t,r);return o!==-1?this._timeline[o]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,r="time"){let o=this._search(t,r);return o+1<this._timeline.length?this._timeline[o+1]:null}getBefore(t){let r=this._timeline.length;if(r>0&&this._timeline[r-1].time<t)return this._timeline[r-1];let o=this._search(t);return o-1>=0?this._timeline[o-1]:null}cancel(t){if(this._timeline.length>1){let r=this._search(t);if(r>=0)if(Ut(this._timeline[r].time,t)){for(let o=r;o>=0&&Ut(this._timeline[o].time,t);o--)r=o;this._timeline=this._timeline.slice(0,r)}else this._timeline=this._timeline.slice(0,r+1);else this._timeline=[]}else this._timeline.length===1&&Xo(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){let r=this._search(t);return r>=0&&(this._timeline=this._timeline.slice(r+1)),this}previousEvent(t){let r=this._timeline.indexOf(t);return r>0?this._timeline[r-1]:null}_search(t,r="time"){if(this._timeline.length===0)return-1;let o=0,n=this._timeline.length,s=n;if(n>0&&this._timeline[n-1][r]<=t)return n-1;for(;o<s;){let i=Math.floor(o+(s-o)/2),a=this._timeline[i],c=this._timeline[i+1];if(Ut(a[r],t)){for(let l=i;l<this._timeline.length;l++){let u=this._timeline[l];if(Ut(u[r],t))i=l;else break}return i}else{if(Zn(a[r],t)&&io(c[r],t))return i;io(a[r],t)?s=i:o=i+1}}return-1}_iterate(t,r=0,o=this._timeline.length-1){this._timeline.slice(r,o+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,r){let o=this._search(t);return o!==-1&&this._iterate(r,0,o),this}forEachAfter(t,r){let o=this._search(t);return this._iterate(r,o+1),this}forEachBetween(t,r,o){let n=this._search(t),s=this._search(r);return n!==-1&&s!==-1?(this._timeline[n].time!==t&&(n+=1),this._timeline[s].time===r&&(s-=1),this._iterate(o,n,s)):n===-1&&this._iterate(o,0,s),this}forEachFrom(t,r){let o=this._search(t);for(;o>=0&&this._timeline[o].time>=t;)o--;return this._iterate(r,o+1),this}forEachAtTime(t,r){let o=this._search(t);if(o!==-1&&Ut(this._timeline[o].time,t)){let n=o;for(let s=o;s>=0&&Ut(this._timeline[s].time,t);s--)n=s;this._iterate(s=>{r(s)},n,o)}return this}dispose(){return super.dispose(),this._timeline=[],this}};var $h=[];function or(e){$h.push(e)}function Hh(e){$h.forEach(t=>t(e))}var Zh=[];function nr(e){Zh.push(e)}function Qh(e){Zh.forEach(t=>t(e))}var sr=class e extends Ot{constructor(){super(...arguments),this.name="Emitter"}on(t,r){return t.split(/\W+/).forEach(n=>{Ct(this._events)&&(this._events={}),this._events.hasOwnProperty(n)||(this._events[n]=[]),this._events[n].push(r)}),this}once(t,r){let o=(...n)=>{r(...n),this.off(t,o)};return this.on(t,o),this}off(t,r){return t.split(/\W+/).forEach(n=>{if(Ct(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Ct(r))this._events[t]=[];else{let s=this._events[t];for(let i=s.length-1;i>=0;i--)s[i]===r&&s.splice(i,1)}}),this}emit(t,...r){if(this._events&&this._events.hasOwnProperty(t)){let o=this._events[t].slice(0);for(let n=0,s=o.length;n<s;n++)o[n].apply(this,r)}return this}static mixin(t){["on","once","off","emit"].forEach(r=>{let o=Object.getOwnPropertyDescriptor(e.prototype,r);Object.defineProperty(t.prototype,r,o)})}dispose(){return super.dispose(),this._events=void 0,this}};var ao=class extends sr{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}};var vr=class e extends ao{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Ft,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;let t=d(e.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=Bh({latencyHint:t.latencyHint}),this._ticker=new $n(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Hh(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,r,o){return this._context.createBuffer(t,r,o)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,r){return this._context.createIIRFilter(t,r)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,r,o){return this._context.createPeriodicWave(t,r,o)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return j(rr(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return j(rr(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return j(rr(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){j(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){j(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){j(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){j(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,r){return Gh(this.rawContext,t,r)}addAudioWorkletModule(t,r){return J(this,void 0,void 0,function*(){j(U(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(r)||this._workletModules.set(r,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(r)})}workletsAreReady(){return J(this,void 0,void 0,function*(){let t=[];this._workletModules.forEach(r=>t.push(r)),yield Promise.all(t)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let r=0;if(this._latencyHint=t,Mt(t))switch(t){case"interactive":r=.1;break;case"playback":r=.5;break;case"balanced":r=.25;break}this.lookAhead=r,this.updateInterval=r/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return rr(this._context)?this._context.resume():Promise.resolve()}close(){return J(this,void 0,void 0,function*(){rr(this._context)&&(yield this._context.close()),this._initialized&&Qh(this)})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{let r=this._context.createBuffer(1,128,this._context.sampleRate),o=r.getChannelData(0);for(let s=0;s<o.length;s++)o[s]=t;let n=this._context.createBufferSource();return n.channelCount=1,n.channelCountMode="explicit",n.buffer=r,n.loop=!0,n.start(0),this._constants.set(t,n),n}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){let t=this.now(),r=this._timeouts.peek();for(;this._timeouts.length&&r&&r.time<=t;)r.callback(),this._timeouts.shift(),r=this._timeouts.peek()}setTimeout(t,r){this._timeoutIds++;let o=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:o+r}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(r=>{r.id===t&&this._timeouts.remove(r)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,r){let o=++this._timeoutIds,n=()=>{let s=this.now();this._timeouts.add({callback:()=>{t(),n()},id:o,time:s+r})};return n(),o}};var Qn=class extends ao{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,r,o){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,r){return{}}createPanner(){return{}}createPeriodicWave(t,r,o){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,r){return{}}get rawContext(){return{}}addAudioWorkletModule(t,r){return J(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(t,r){return 0}clearTimeout(t){return this}setInterval(t,r){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};function V(e,t){St(t)?t.forEach(r=>V(e,r)):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function co(e,t){St(t)?t.forEach(r=>co(e,r)):Object.defineProperty(e,t,{writable:!0})}var H=()=>{};var xt=class e extends Ot{constructor(){super(),this.name="ToneAudioBuffer",this.onload=H;let t=d(e.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Hn(t.url)||t.url instanceof e?this.set(t.url):Mt(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:H,onload:H,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:At().sampleRate}set(t){return t instanceof e?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return J(this,void 0,void 0,function*(){let r=e.load(t).then(o=>{this.set(o),this.onload(this)});e.downloads.push(r);try{yield r}finally{let o=e.downloads.indexOf(r);e.downloads.splice(o,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){let r=St(t)&&t[0].length>0,o=r?t.length:1,n=r?t[0].length:t.length,s=At(),i=s.createBuffer(o,n,s.sampleRate),a=!r&&o===1?[t]:t;for(let c=0;c<o;c++)i.copyToChannel(a[c],c);return this._buffer=i,this}toMono(t){if(Pt(t))this.fromArray(this.toArray(t));else{let r=new Float32Array(this.length),o=this.numberOfChannels;for(let n=0;n<o;n++){let s=this.toArray(n);for(let i=0;i<s.length;i++)r[i]+=s[i]}r=r.map(n=>n/o),this.fromArray(r)}return this}toArray(t){if(Pt(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{let r=[];for(let o=0;o<this.numberOfChannels;o++)r[o]=this.getChannelData(o);return r}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,r=this.duration){let o=Math.floor(t*this.sampleRate),n=Math.floor(r*this.sampleRate);j(o<n,"The start time must be less than the end time");let s=n-o,i=At().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let a=0;a<this.numberOfChannels;a++)i.copyToChannel(this.getChannelData(a).subarray(o,n),a);return new e(i)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new e().fromArray(t)}static fromUrl(t){return J(this,void 0,void 0,function*(){return yield new e().load(t)})}static load(t){return J(this,void 0,void 0,function*(){let r=t.match(/\[([^\]\[]+\|.+)\]$/);if(r){let a=r[1].split("|"),c=a[0];for(let l of a)if(e.supportsType(l)){c=l;break}t=t.replace(r[0],c)}let o=e.baseUrl===""||e.baseUrl.endsWith("/")?e.baseUrl:e.baseUrl+"/",n=yield fetch(o+t);if(!n.ok)throw new Error(`could not load url: ${t}`);let s=yield n.arrayBuffer();return yield At().decodeAudioData(s)})}static supportsType(t){let r=t.split("."),o=r[r.length-1];return document.createElement("audio").canPlayType("audio/"+o)!==""}static loaded(){return J(this,void 0,void 0,function*(){for(yield Promise.resolve();e.downloads.length;)yield e.downloads[0]})}};xt.baseUrl="";xt.downloads=[];var Ie=class extends vr{constructor(){super({clockSource:"offline",context:so(arguments[0])?arguments[0]:Wh(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:so(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=so(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return J(this,void 0,void 0,function*(){let r=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,r++;let o=Math.floor(this.sampleRate/128);t&&r%o===0&&(yield new Promise(n=>setTimeout(n,1)))}})}render(t=!0){return J(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(t);let r=yield this._context.startRendering();return new xt(r)})}close(){return Promise.resolve()}};var Xh=new Qn,lo=Xh;function At(){return lo===Xh&&jh&&Di(new vr),lo}function Di(e){rr(e)?lo=new vr(e):so(e)?lo=new Ie(e):lo=e}function Ei(){return lo.resume()}if(Fe&&!Fe.TONE_SILENCE_LOGGING){let e="v";Eo==="dev"&&(e="");let t=` * Tone.js ${e}${Eo} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function ir(e){return Math.pow(10,e/20)}function wr(e){return 20*(Math.log(e)/Math.LN10)}function br(e){return Math.pow(2,e/12)}var Xn=440;function Yh(){return Xn}function Kh(e){Xn=e}function Sr(e){return Math.round(Mi(e))}function Mi(e){return 69+12*Math.log2(e/Xn)}function Yn(e){return Xn*Math.pow(2,(e-69)/12)}var Kn=class e extends Ot{constructor(t,r,o){super(),this.defaultUnits="s",this._val=r,this._units=o,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,r)=>{let o=parseInt(t,10),n=r==="."?1.5:1;return o===1?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/o)*n},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{let r=parseInt(t,10);return this._beatsToUnits(8/(Math.floor(r)*3))},regexp:/^(\d+)t$/i},tr:{method:(t,r,o)=>{let n=0;return t&&t!=="0"&&(n+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),r&&r!=="0"&&(n+=this._beatsToUnits(parseFloat(r))),o&&o!=="0"&&(n+=this._beatsToUnits(parseFloat(o)/4)),n},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof e&&this.fromType(this._val),Ct(this._val))return this._noArg();if(Mt(this._val)&&Ct(this._units)){for(let t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(we(this._val)){let t=0;for(let r in this._val)if(U(this._val[r])){let o=this._val[r],n=new this.constructor(this.context,r).valueOf()*o;t+=n}return t}if(U(this._units)){let t=this._expressions[this._units],r=this._val.toString().trim().match(t.regexp);return r?t.method.apply(this,r.slice(1)):t.method.call(this,this._val)}else return Mt(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}};var re=class e extends Kn{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{let r=new e(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(r))},regexp:/^@(.+)/}})}quantize(t,r=1){let o=new this.constructor(this.context,t).valueOf(),n=this.valueOf(),a=Math.round(n/o)*o-n;return n+a*r}toNotation(){let t=this.toSeconds(),r=["1m"];for(let s=1;s<9;s++){let i=Math.pow(2,s);r.push(i+"n."),r.push(i+"n"),r.push(i+"t")}r.push("0");let o=r[0],n=new e(this.context,r[0]).toSeconds();return r.forEach(s=>{let i=new e(this.context,s).toSeconds();Math.abs(i-t)<Math.abs(n-t)&&(o=s,n=i)}),o}toBarsBeatsSixteenths(){let t=this._beatsToUnits(1),r=this.valueOf()/t;r=parseFloat(r.toFixed(4));let o=Math.floor(r/this._getTimeSignature()),n=r%1*4;r=Math.floor(r)%this._getTimeSignature();let s=n.toString();return s.length>3&&(n=parseFloat(parseFloat(s).toFixed(3))),[o,r,n].join(":")}toTicks(){let t=this._beatsToUnits(1),r=this.valueOf()/t;return Math.round(r*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Sr(this.toFrequency())}_now(){return this.context.now()}};var Xt=class e extends re{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Yh()}static set A4(t){Kh(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return this.defaultUnits==="midi"?t:e.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,r){let n=Ig[t.toLowerCase()]+(parseInt(r,10)+1)*12;return this.defaultUnits==="midi"?n:e.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,r,o){let n=1;return t&&t!=="0"&&(n*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),r&&r!=="0"&&(n*=this._beatsToUnits(parseFloat(r))),o&&o!=="0"&&(n*=this._beatsToUnits(parseFloat(o)/4)),n}}})}transpose(t){return new e(this.context,this.valueOf()*br(t))}harmonize(t){return t.map(r=>this.transpose(r))}toMidi(){return Sr(this.valueOf())}toNote(){let t=this.toFrequency(),r=Math.log2(t/e.A4),o=Math.round(12*r)+57,n=Math.floor(o/12);return n<0&&(o+=-12*n),qg[o%12]+n.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){let t=this._beatsToUnits(1),r=this.valueOf()/t;return Math.floor(r*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(t*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return Yn(t)}static ftom(t){return Sr(t)}},Ig={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},qg=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];var fe=class extends re{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}};var pt=class e extends Ot{constructor(){super();let t=d(e.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:At()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new re(this.context,t).toSeconds()}toFrequency(t){return new Xt(this.context,t).toFrequency()}toTicks(t){return new fe(this.context,t).toTicks()}_getPartialProperties(t){let r=this.get();return Object.keys(r).forEach(o=>{Ct(t[o])&&delete r[o]}),r}get(){let t=Uh(this);return Object.keys(t).forEach(r=>{if(Reflect.has(this,r)){let o=this[r];U(o)&&U(o.value)&&U(o.setValueAtTime)?t[r]=o.value:o instanceof e?t[r]=o._getPartialProperties(t[r]):St(o)||Pt(o)||Mt(o)||Un(o)?t[r]=o:delete t[r]}}),t}set(t){return Object.keys(t).forEach(r=>{Reflect.has(this,r)&&U(this[r])&&(this[r]&&U(this[r].value)&&U(this[r].setValueAtTime)?this[r].value!==t[r]&&(this[r].value=t[r]):this[r]instanceof e?this[r].set(t[r]):this[r]=t[r])}),this}};var Ae=class extends Ft{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){let r=this.get(t);return r!==null?r.state:this._initial}setStateAtTime(t,r,o){return Et(r,0),this.add(Object.assign({},o,{state:t,time:r})),this}getLastState(t,r){let o=this._search(r);for(let n=o;n>=0;n--){let s=this._timeline[n];if(s.state===t)return s}}getNextState(t,r){let o=this._search(r);if(o!==-1)for(let n=o;n<this._timeline.length;n++){let s=this._timeline[n];if(s.state===t)return s}}};var Q=class e extends pt{constructor(){super(d(e.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;let t=d(e.getDefaults(),arguments,["param","units","convert"]);for(j(U(t.param)&&(be(t.param)||t.param instanceof e),"param must be an AudioParam");!be(t.param);)t.param=t.param._param;this._swappable=U(t.swappable)?t.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Ft(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,U(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(pt.getDefaults(),{convert:!0,units:"number"})}get value(){let t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return U(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return U(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(t,r){return this.units===r}_assertRange(t){return U(this.maxValue)&&U(this.minValue)&&Et(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?ir(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&this.units==="decibels"?wr(t):t}setValueAtTime(t,r){let o=this.toSeconds(r),n=this._fromType(t);return j(isFinite(n)&&isFinite(o),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(r)}`),this._assertRange(n),this.log(this.units,"setValueAtTime",t,o),this._events.add({time:o,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,o),this}getValueAtTime(t){let r=Math.max(this.toSeconds(t),0),o=this._events.getAfter(r),n=this._events.get(r),s=this._initialValue;if(n===null)s=this._initialValue;else if(n.type==="setTargetAtTime"&&(o===null||o.type==="setValueAtTime")){let i=this._events.getBefore(n.time),a;i===null?a=this._initialValue:a=i.value,n.type==="setTargetAtTime"&&(s=this._exponentialApproach(n.time,a,n.value,n.constant,r))}else if(o===null)s=n.value;else if(o.type==="linearRampToValueAtTime"||o.type==="exponentialRampToValueAtTime"){let i=n.value;if(n.type==="setTargetAtTime"){let a=this._events.getBefore(n.time);a===null?i=this._initialValue:i=a.value}o.type==="linearRampToValueAtTime"?s=this._linearInterpolate(n.time,i,o.time,o.value,r):s=this._exponentialInterpolate(n.time,i,o.time,o.value,r)}else s=n.value;return this._toType(s)}setRampPoint(t){t=this.toSeconds(t);let r=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),this._fromType(r)===0&&(r=this._toType(this._minOutput)),this.setValueAtTime(r,t),this}linearRampToValueAtTime(t,r){let o=this._fromType(t),n=this.toSeconds(r);return j(isFinite(o)&&isFinite(n),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(r)}`),this._assertRange(o),this._events.add({time:n,type:"linearRampToValueAtTime",value:o}),this.log(this.units,"linearRampToValueAtTime",t,n),this._param.linearRampToValueAtTime(o,n),this}exponentialRampToValueAtTime(t,r){let o=this._fromType(t);o=Ut(o,0)?this._minOutput:o,this._assertRange(o);let n=this.toSeconds(r);return j(isFinite(o)&&isFinite(n),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(r)}`),this._events.add({time:n,type:"exponentialRampToValueAtTime",value:o}),this.log(this.units,"exponentialRampToValueAtTime",t,n),this._param.exponentialRampToValueAtTime(o,n),this}exponentialRampTo(t,r,o){return o=this.toSeconds(o),this.setRampPoint(o),this.exponentialRampToValueAtTime(t,o+this.toSeconds(r)),this}linearRampTo(t,r,o){return o=this.toSeconds(o),this.setRampPoint(o),this.linearRampToValueAtTime(t,o+this.toSeconds(r)),this}targetRampTo(t,r,o){return o=this.toSeconds(o),this.setRampPoint(o),this.exponentialApproachValueAtTime(t,o,r),this}exponentialApproachValueAtTime(t,r,o){r=this.toSeconds(r),o=this.toSeconds(o);let n=Math.log(o+1)/Math.log(200);return this.setTargetAtTime(t,r,n),this.cancelAndHoldAtTime(r+o*.9),this.linearRampToValueAtTime(t,r+o),this}setTargetAtTime(t,r,o){let n=this._fromType(t);j(isFinite(o)&&o>0,"timeConstant must be a number greater than 0");let s=this.toSeconds(r);return this._assertRange(n),j(isFinite(n)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(r)}`),this._events.add({constant:o,time:s,type:"setTargetAtTime",value:n}),this.log(this.units,"setTargetAtTime",t,s,o),this._param.setTargetAtTime(n,s,o),this}setValueCurveAtTime(t,r,o,n=1){o=this.toSeconds(o),r=this.toSeconds(r);let s=this._fromType(t[0])*n;this.setValueAtTime(this._toType(s),r);let i=o/(t.length-1);for(let a=1;a<t.length;a++){let c=this._fromType(t[a])*n;this.linearRampToValueAtTime(this._toType(c),r+a*i)}return this}cancelScheduledValues(t){let r=this.toSeconds(t);return j(isFinite(r),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(r),this._param.cancelScheduledValues(r),this.log(this.units,"cancelScheduledValues",r),this}cancelAndHoldAtTime(t){let r=this.toSeconds(t),o=this._fromType(this.getValueAtTime(r));j(isFinite(r),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",r,"value="+o);let n=this._events.get(r),s=this._events.getAfter(r);return n&&Ut(n.time,r)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(r),this._events.cancel(r+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),s.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(o),r):s.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(o),r)),this._events.add({time:r,type:"setValueAtTime",value:o}),this._param.setValueAtTime(o,r),this}rampTo(t,r=.1,o){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(t,r,o):this.linearRampTo(t,r,o),this}apply(t){let r=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(r),r);let o=this._events.get(r);if(o&&o.type==="setTargetAtTime"){let n=this._events.getAfter(o.time),s=n?n.time:r+2,i=(s-r)/10;for(let a=r;a<s;a+=i)t.linearRampToValueAtTime(this.getValueAtTime(a),a)}return this._events.forEachAfter(this.context.currentTime,n=>{n.type==="cancelScheduledValues"?t.cancelScheduledValues(n.time):n.type==="setTargetAtTime"?t.setTargetAtTime(n.value,n.time,n.constant):t[n.type](n.value,n.time)}),this}setParam(t){j(this._swappable,"The Param must be assigned as 'swappable' in the constructor");let r=this.input;return r.disconnect(this._param),this.apply(t),this._param=t,r.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,r,o,n,s){return o+(r-o)*Math.exp(-(s-t)/n)}_linearInterpolate(t,r,o,n,s){return r+(n-r)*((s-t)/(o-t))}_exponentialInterpolate(t,r,o,n,s){return r*Math.pow(n/r,(s-t)/(o-t))}};var D=class e extends pt{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return U(this.input)?be(this.input)||this.input instanceof Q?1:this.input.numberOfInputs:0}get numberOfOutputs(){return U(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return U(t)&&(t instanceof e||Re(t))}_getInternalNodes(){let t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(o=>{o.channelCount=t.channelCount,o.channelCountMode=t.channelCountMode,o.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){let t=this._getInternalNodes();j(t.length>0,"ToneAudioNode does not have any internal nodes");let r=t[0];return{channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){let r=this._getChannelProperties();this._setChannelProperties(Object.assign(r,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){let r=this._getChannelProperties();this._setChannelProperties(Object.assign(r,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){let r=this._getChannelProperties();this._setChannelProperties(Object.assign(r,{channelInterpretation:t}))}connect(t,r=0,o=0){return Vt(this,t,r,o),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Zo("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,r=0,o=0){return Jh(this,t,r,o),this}chain(...t){return oe(this,...t),this}fan(...t){return t.forEach(r=>this.connect(r)),this}dispose(){return super.dispose(),U(this.input)&&(this.input instanceof e?this.input.dispose():Re(this.input)&&this.input.disconnect()),U(this.output)&&(this.output instanceof e?this.output.dispose():Re(this.output)&&this.output.disconnect()),this._internalChannels=[],this}};function oe(...e){let t=e.shift();e.reduce((r,o)=>(r instanceof D?r.connect(o):Re(r)&&Vt(r,o),o),t)}function Vt(e,t,r=0,o=0){for(j(U(e),"Cannot connect from undefined node"),j(U(t),"Cannot connect to undefined node"),(t instanceof D||Re(t))&&j(t.numberOfInputs>0,"Cannot connect to node with no inputs"),j(e.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof D||t instanceof Q;)U(t.input)&&(t=t.input);for(;e instanceof D;)U(e.output)&&(e=e.output);be(t)?e.connect(t,r):e.connect(t,r,o)}function Jh(e,t,r=0,o=0){if(U(t))for(;t instanceof D;)t=t.input;for(;!Re(e);)U(e.output)&&(e=e.output);be(t)?e.disconnect(t,r):Re(t)?e.disconnect(t,r,o):e.disconnect()}var W=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;let t=d(e.getDefaults(),arguments,["gain","units"]);this.gain=new Q({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),V(this,"gain")}static getDefaults(){return Object.assign(D.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}};var Te=class extends D{constructor(t){super(t),this.onended=H,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new W({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(r){let o=this.toSeconds(r);return this._startTime!==-1&&o>=this._startTime&&(this._stopTime===-1||o<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(D.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:H})}_startGain(t,r=1){j(this._startTime===-1,"Source cannot be started more than once");let o=this.toSeconds(this._fadeIn);return this._startTime=t+o,this._startTime=Math.max(this._startTime,this.context.currentTime),o>0?(this._gainNode.gain.setValueAtTime(0,t),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(r,t+o):this._gainNode.gain.exponentialApproachValueAtTime(r,t,o)):this._gainNode.gain.setValueAtTime(r,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){j(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();let r=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+r,this._stopTime=Math.max(this._stopTime,this.context.currentTime),r>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,r,t):this._gainNode.gain.targetRampTo(0,r,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{let o=this._curve==="exponential"?r*2:0;this._stopSource(this.now()+o),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==H&&(this.onended(this),this.onended=H,!this.context.isOffline)){let t=()=>this.dispose();typeof window.requestIdleCallback<"u"?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),j(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}};var Yo=class e extends Te{constructor(){super(d(e.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();let t=d(e.getDefaults(),arguments,["offset"]);Vt(this._source,this._gainNode),this.offset=new Q({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Te.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){let r=this.toSeconds(t);return this.log("start",r),this._startGain(r),this._source.start(r),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}};var z=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;let t=d(e.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Yo({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(D.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,r=0,o=0){return uo(this,t,r,o),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,r){return this._param.setValueAtTime(t,r),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,r){return this._param.linearRampToValueAtTime(t,r),this}exponentialRampToValueAtTime(t,r){return this._param.exponentialRampToValueAtTime(t,r),this}exponentialRampTo(t,r,o){return this._param.exponentialRampTo(t,r,o),this}linearRampTo(t,r,o){return this._param.linearRampTo(t,r,o),this}targetRampTo(t,r,o){return this._param.targetRampTo(t,r,o),this}exponentialApproachValueAtTime(t,r,o){return this._param.exponentialApproachValueAtTime(t,r,o),this}setTargetAtTime(t,r,o){return this._param.setTargetAtTime(t,r,o),this}setValueCurveAtTime(t,r,o,n){return this._param.setValueCurveAtTime(t,r,o,n),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,r,o){return this._param.rampTo(t,r,o),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}};function uo(e,t,r,o){(t instanceof Q||be(t)||t instanceof z&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof z&&(t.overridden=!0)),Vt(e,t,r,o)}var Jn=class e extends Q{constructor(){super(d(e.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Ft(1/0),this._multiplier=1;let t=d(e.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Q.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,r,o){r=this.toSeconds(r),this.setRampPoint(r);let n=this._fromType(t),s=this._events.get(r),i=Math.round(Math.max(1/o,1));for(let a=0;a<=i;a++){let c=o*a+r,l=this._exponentialApproach(s.time,s.value,n,o,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}setValueAtTime(t,r){let o=this.toSeconds(r);super.setValueAtTime(t,r);let n=this._events.get(o),s=this._events.previousEvent(n),i=this._getTicksUntilEvent(s,o);return n.ticks=Math.max(i,0),this}linearRampToValueAtTime(t,r){let o=this.toSeconds(r);super.linearRampToValueAtTime(t,r);let n=this._events.get(o),s=this._events.previousEvent(n),i=this._getTicksUntilEvent(s,o);return n.ticks=Math.max(i,0),this}exponentialRampToValueAtTime(t,r){r=this.toSeconds(r);let o=this._fromType(t),n=this._events.get(r),s=Math.round(Math.max((r-n.time)*10,1)),i=(r-n.time)/s;for(let a=0;a<=s;a++){let c=i*a+n.time,l=this._exponentialInterpolate(n.time,n.value,r,o,c);this.linearRampToValueAtTime(this._toType(l),c)}return this}_getTicksUntilEvent(t,r){if(t===null)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Ct(t.ticks)){let i=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(i,t.time)}let o=this._fromType(this.getValueAtTime(t.time)),n=this._fromType(this.getValueAtTime(r)),s=this._events.get(r);return s&&s.time===r&&s.type==="setValueAtTime"&&(n=this._fromType(this.getValueAtTime(r-this.sampleTime))),.5*(r-t.time)*(o+n)+t.ticks}getTicksAtTime(t){let r=this.toSeconds(t),o=this._events.get(r);return Math.max(this._getTicksUntilEvent(o,r),0)}getDurationOfTicks(t,r){let o=this.toSeconds(r),n=this.getTicksAtTime(r);return this.getTimeOfTick(n+t)-o}getTimeOfTick(t){let r=this._events.get(t,"ticks"),o=this._events.getAfter(t,"ticks");if(r&&r.ticks===t)return r.time;if(r&&o&&o.type==="linearRampToValueAtTime"&&r.value!==o.value){let n=this._fromType(this.getValueAtTime(r.time)),i=(this._fromType(this.getValueAtTime(o.time))-n)/(o.time-r.time),a=Math.sqrt(Math.pow(n,2)-2*i*(r.ticks-t)),c=(-n+a)/i,l=(-n-a)/i;return(c>0?c:l)+r.time}else return r?r.value===0?1/0:r.time+(t-r.ticks)/r.value:t/this._initialValue}ticksToTime(t,r){return this.getDurationOfTicks(t,r)}timeToTicks(t,r){let o=this.toSeconds(r),n=this.toSeconds(t),s=this.getTicksAtTime(o);return this.getTicksAtTime(o+n)-s}_fromType(t){return this.units==="bpm"&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return this.units==="bpm"&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){let r=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(r,0)}};var ts=class e extends z{constructor(){super(d(e.getDefaults(),arguments,["value"])),this.name="TickSignal";let t=d(e.getDefaults(),arguments,["value"]);this.input=this._param=new Jn({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(z.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,r){return this._param.ticksToTime(t,r)}timeToTicks(t,r){return this._param.timeToTicks(t,r)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,r){return this._param.getDurationOfTicks(t,r)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}};var es=class e extends pt{constructor(){super(d(e.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Ae,this._tickOffset=new Ft;let t=d(e.getDefaults(),arguments,["frequency"]);this.frequency=new ts({context:this.context,units:t.units,value:t.frequency}),V(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},pt.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,r){let o=this.toSeconds(t);return this._state.getValueAtTime(o)!=="started"&&(this._state.setStateAtTime("started",o),U(r)&&this.setTicksAtTime(r,o)),this}stop(t){let r=this.toSeconds(t);if(this._state.getValueAtTime(r)==="stopped"){let o=this._state.get(r);o&&o.time>0&&(this._tickOffset.cancel(o.time),this._state.cancel(o.time))}return this._state.cancel(r),this._state.setStateAtTime("stopped",r),this.setTicksAtTime(0,r),this}pause(t){let r=this.toSeconds(t);return this._state.getValueAtTime(r)==="started"&&this._state.setStateAtTime("paused",r),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){let r=this.toSeconds(t),o=this._state.getLastState("stopped",r),n={state:"paused",time:r};this._state.add(n);let s=o,i=0;return this._state.forEachBetween(o.time,r+this.sampleTime,a=>{let c=s.time,l=this._tickOffset.get(a.time);l&&l.time>=s.time&&(i=l.ticks,c=l.time),s.state==="started"&&a.state!=="started"&&(i+=this.frequency.getTicksAtTime(a.time)-this.frequency.getTicksAtTime(c)),s=a}),this._state.remove(n),i}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){let r=this.now(),o=this.frequency.timeToTicks(t,r);this.setTicksAtTime(o,r)}getSecondsAtTime(t){t=this.toSeconds(t);let r=this._state.getLastState("stopped",t),o={state:"paused",time:t};this._state.add(o);let n=r,s=0;return this._state.forEachBetween(r.time,t+this.sampleTime,i=>{let a=n.time,c=this._tickOffset.get(i.time);c&&c.time>=n.time&&(s=c.seconds,a=c.time),n.state==="started"&&i.state!=="started"&&(s+=i.time-a),n=i}),this._state.remove(o),s}setTicksAtTime(t,r){return r=this.toSeconds(r),this._tickOffset.cancel(r),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,r),ticks:t,time:r}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,r=this.now()){let o=this._tickOffset.get(r),n=this._state.get(r),s=Math.max(o.time,n.time),i=this.frequency.getTicksAtTime(s)+t-o.ticks;return this.frequency.getTimeOfTick(i)}forEachTickBetween(t,r,o){let n=this._state.get(t);this._state.forEachBetween(t,r,i=>{n&&n.state==="started"&&i.state!=="started"&&this.forEachTickBetween(Math.max(n.time,t),i.time-this.sampleTime,o),n=i});let s=null;if(n&&n.state==="started"){let i=Math.max(n.time,t),a=this.frequency.getTicksAtTime(i),c=this.frequency.getTicksAtTime(n.time),l=a-c,u=Math.ceil(l)-l;u=Ut(u,1)?0:u;let h=this.frequency.getTimeOfTick(a+u);for(;h<r;){try{o(h,Math.round(this.getTicksAtTime(h)))}catch(p){s=p;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}};var ho=class e extends pt{constructor(){super(d(e.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=H,this._lastUpdate=0,this._state=new Ae("stopped"),this._boundLoop=this._loop.bind(this);let t=d(e.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new es({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,V(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(pt.getDefaults(),{callback:H,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,r){zn(this.context);let o=this.toSeconds(t);return this.log("start",o),this._state.getValueAtTime(o)!=="started"&&(this._state.setStateAtTime("started",o),this._tickSource.start(o,r),o<this._lastUpdate&&this.emit("start",o,r)),this}stop(t){let r=this.toSeconds(t);return this.log("stop",r),this._state.cancel(r),this._state.setStateAtTime("stopped",r),this._tickSource.stop(r),r<this._lastUpdate&&this.emit("stop",r),this}pause(t){let r=this.toSeconds(t);return this._state.getValueAtTime(r)==="started"&&(this._state.setStateAtTime("paused",r),this._tickSource.pause(r),r<this._lastUpdate&&this.emit("pause",r)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,r){return this._tickSource.setTicksAtTime(t,r),this}getTimeOfTick(t,r=this.now()){return this._tickSource.getTimeOfTick(t,r)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,r){let o=this.toSeconds(r),n=this.getTicksAtTime(o);return this._tickSource.getTimeOfTick(n+t,o)}_loop(){let t=this._lastUpdate,r=this.now();this._lastUpdate=r,this.log("loop",t,r),t!==r&&(this._state.forEachBetween(t,r,o=>{switch(o.state){case"started":let n=this._tickSource.getTicksAtTime(o.time);this.emit("start",o.time,n);break;case"stopped":o.time!==0&&this.emit("stop",o.time);break;case"paused":this.emit("pause",o.time);break}}),this._tickSource.forEachTickBetween(t,r,(o,n)=>{this.callback(o,n)}))}getStateAtTime(t){let r=this.toSeconds(t);return this._state.getValueAtTime(r)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}};sr.mixin(ho);var ar=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";let t=d(e.getDefaults(),arguments,["delayTime","maxDelay"]),r=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(r,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(r),this.delayTime=new Q({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),V(this,"delayTime")}static getDefaults(){return Object.assign(D.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}};var po=class e extends Ot{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let t=d(e.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(r=>{this._loadingCount++;let o=t.urls[r];this.add(r,o,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:H,onload:H,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return j(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,this._loadingCount===0&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,r])=>r.loaded)}add(t,r,o=H,n=H){return Mt(r)?this._buffers.set(t.toString(),new xt(this.baseUrl+r,o,n)):this._buffers.set(t.toString(),new xt(r,o,n)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}};var yt=class extends fe{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}};var Fi=class extends pt{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Ft,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,r){return this._events.add({callback:t,time:this.toSeconds(r)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){let t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){let r=this._events.shift();r&&t-r.time<=this.expiration&&r.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}};or(e=>{e.draw=new Fi({context:e})});nr(e=>{e.draw.dispose()});var rs=class extends Ot{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){j(U(t.time),"Events must have a time property"),j(U(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let r=new Ri(t.time,t.time+t.duration,t);for(this._root===null?this._root=r:this._root.insert(r),this._length++;r!==null;)r.updateHeight(),r.updateMax(),this._rebalance(r),r=r.parent;return this}remove(t){if(this._root!==null){let r=[];this._root.search(t.time,r);for(let o of r)if(o.event===t){this._removeNode(o),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,r=>this.remove(r)),this}_setRoot(t){this._root=t,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(t,r){t.parent!==null?(t.isLeftChild()?t.parent.left=r:t.parent.right=r,this._rebalance(t.parent)):this._setRoot(r)}_removeNode(t){if(t.left===null&&t.right===null)this._replaceNodeInParent(t,null);else if(t.right===null)this._replaceNodeInParent(t,t.left);else if(t.left===null)this._replaceNodeInParent(t,t.right);else{let r=t.getBalance(),o,n=null;if(r>0)if(t.left.right===null)o=t.left,o.right=t.right,n=o;else{for(o=t.left.right;o.right!==null;)o=o.right;o.parent&&(o.parent.right=o.left,n=o.parent,o.left=t.left,o.right=t.right)}else if(t.right.left===null)o=t.right,o.left=t.left,n=o;else{for(o=t.right.left;o.left!==null;)o=o.left;o.parent&&(o.parent.left=o.right,n=o.parent,o.left=t.left,o.right=t.right)}t.parent!==null?t.isLeftChild()?t.parent.left=o:t.parent.right=o:this._setRoot(o),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){let r=t.parent,o=t.isLeftChild(),n=t.right;n&&(t.right=n.left,n.left=t),r!==null?o?r.left=n:r.right=n:this._setRoot(n)}_rotateRight(t){let r=t.parent,o=t.isLeftChild(),n=t.left;n&&(t.left=n.right,n.right=t),r!==null?o?r.left=n:r.right=n:this._setRoot(n)}_rebalance(t){let r=t.getBalance();r>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):r<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(this._root!==null){let r=[];if(this._root.search(t,r),r.length>0){let o=r[0];for(let n=1;n<r.length;n++)r[n].low>o.low&&(o=r[n]);return o.event}}return null}forEach(t){if(this._root!==null){let r=[];this._root.traverse(o=>r.push(o)),r.forEach(o=>{o.event&&t(o.event)})}return this}forEachAtTime(t,r){if(this._root!==null){let o=[];this._root.search(t,o),o.forEach(n=>{n.event&&r(n.event)})}return this}forEachFrom(t,r){if(this._root!==null){let o=[];this._root.searchAfter(t,o),o.forEach(n=>{n.event&&r(n.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(t=>t.dispose()),this._root=null,this}},Ri=class{constructor(t,r,o){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=o,this.low=t,this.high=r,this.max=this.high}insert(t){t.low<=this.low?this.left===null?this.left=t:this.left.insert(t):this.right===null?this.right=t:this.right.insert(t)}search(t,r){t>this.max||(this.left!==null&&this.left.search(t,r),this.low<=t&&this.high>t&&r.push(this),!(this.low>t)&&this.right!==null&&this.right.search(t,r))}searchAfter(t,r){this.low>=t&&(r.push(this),this.left!==null&&this.left.searchAfter(t,r)),this.right!==null&&this.right.searchAfter(t,r)}traverse(t){t(this),this.left!==null&&this.left.traverse(t),this.right!==null&&this.right.traverse(t)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return this.left!==null&&this.right!==null?t=this.left.height-this.right.height:this.left!==null?t=this.left.height+1:this.right!==null&&(t=-(this.right.height+1)),t}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}};var me=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["volume"])),this.name="Volume";let t=d(e.getDefaults(),arguments,["volume"]);this.input=this.output=new W({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,V(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(D.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}};var Ii=class e extends D{constructor(){super(d(e.getDefaults(),arguments)),this.name="Destination",this.input=new me({context:this.context}),this.output=new W({context:this.context}),this.volume=this.input.volume;let t=d(e.getDefaults(),arguments);oe(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(D.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),oe(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};or(e=>{e.destination=new Ii({context:e})});nr(e=>{e.destination.dispose()});var os=class extends Ot{constructor(t){super(),this.name="TimelineValue",this._timeline=new Ft({memory:10}),this._initialValue=t}set(t,r){return this._timeline.add({value:t,time:r}),this}get(t){let r=this._timeline.get(t);return r?r.value:this._initialValue}};var ze=class e{constructor(t,r){this.id=e._eventId++;let o=Object.assign(e.getDefaults(),r);this.transport=t,this.callback=o.callback,this._once=o.once,this.time=o.time}static getDefaults(){return{callback:H,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}};ze._eventId=0;var ns=class e extends ze{constructor(t,r){super(t,r),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);let o=Object.assign(e.getDefaults(),r);this.duration=new yt(t.context,o.duration).valueOf(),this._interval=new yt(t.context,o.interval).valueOf(),this._nextTick=o.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},ze.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){let r=this.transport.getTicksAtTime(t);r>=this.time&&r>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new yt(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;let r=this.transport.getTicksAtTime(t);r>this.time&&(this._nextTick=this.time+Math.ceil((r-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new yt(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new yt(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}};var ss=class e extends pt{constructor(){super(d(e.getDefaults(),arguments)),this.name="Transport",this._loop=new os(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Ft,this._repeatedEvents=new rs,this._syncedSignals=[],this._swingAmount=0;let t=d(e.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new ho({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),V(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(pt.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,r){if(this._loop.get(t)&&r>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),r=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&r%this._ppq!==0&&r%(this._swingTicks*2)!==0){let o=r%(this._swingTicks*2)/(this._swingTicks*2),n=Math.sin(o*Math.PI)*this._swingAmount;t+=new yt(this.context,this._swingTicks*2/3).toSeconds()*n}this._timeline.forEachAtTime(r,o=>o.invoke(t))}schedule(t,r){let o=new ze(this,{callback:t,time:new fe(this.context,r).toTicks()});return this._addEvent(o,this._timeline)}scheduleRepeat(t,r,o,n=1/0){let s=new ns(this,{callback:t,duration:new re(this.context,n).toTicks(),interval:new re(this.context,r).toTicks(),time:new fe(this.context,o).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(t,r){let o=new ze(this,{callback:t,once:!0,time:new fe(this.context,r).toTicks()});return this._addEvent(o,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){let r=this._scheduledEvents[t.toString()];r.timeline.remove(r.event),r.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,r){return this._scheduledEvents[t.id.toString()]={event:t,timeline:r},r.add(t),t.id}cancel(t=0){let r=this.toTicks(t);return this._timeline.forEachFrom(r,o=>this.clear(o.id)),this._repeatedEvents.forEachFrom(r,o=>this.clear(o.id)),this}_bindClockEvents(){this._clock.on("start",(t,r)=>{r=new yt(this.context,r).toSeconds(),this.emit("start",t,r)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,r){let o;return U(r)&&(o=this.toTicks(r)),this._clock.start(t,o),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!=="started"?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){St(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new re(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new re(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,r){return this.loopStart=t,this.loopEnd=r,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new yt(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){let t=this.now(),r=this._clock.getTicksAtTime(t);return new yt(this.context,r).toBarsBeatsSixteenths()}set position(t){let r=this.toTicks(t);this.ticks=r}get seconds(){return this._clock.seconds}set seconds(t){let r=this.now(),o=this._clock.frequency.timeToTicks(t,r);this.ticks=o}get progress(){if(this.loop){let t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){let r=this.now();if(this.state==="started"){let o=this._clock.getTicksAtTime(r),n=this._clock.frequency.getDurationOfTicks(Math.ceil(o)-o,r),s=r+n;this.emit("stop",s),this._clock.setTicksAtTime(t,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this._clock.setTicksAtTime(t,r)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),this.state!=="started")return 0;{let r=this.now(),o=this.getTicksAtTime(r),n=t-o%t;return this._clock.nextTickTime(n,r)}}syncSignal(t,r){if(!r){let n=this.now();if(t.getValueAtTime(n)!==0){let i=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);r=t.getValueAtTime(n)/i}else r=0}let o=new W(r);return this.bpm.connect(o),o.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:o,signal:t}),t.value=0,this}unsyncSignal(t){for(let r=this._syncedSignals.length-1;r>=0;r--){let o=this._syncedSignals[r];o.signal===t&&(o.ratio.dispose(),o.signal.value=o.initial,this._syncedSignals.splice(r,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),co(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}};sr.mixin(ss);or(e=>{e.transport=new ss({context:e})});nr(e=>{e.transport.dispose()});var tt=class extends D{constructor(t){super(t),this.input=void 0,this._state=new Ae("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=H,this._syncedStop=H,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new me({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,V(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(D.getDefaults(),{mute:!1,onstop:H,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,r,o){let n=Ct(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(n=this._clampToCurrentTime(n),!this._synced&&this._state.getValueAtTime(n)==="started")j(io(n,this._state.get(n).time),"Start time must be strictly greater than previous start time"),this._state.cancel(n),this._state.setStateAtTime("started",n),this.log("restart",n),this.restart(n,r,o);else if(this.log("start",n),this._state.setStateAtTime("started",n),this._synced){let s=this._state.get(n);s&&(s.offset=this.toSeconds(Qt(r,0)),s.duration=o?this.toSeconds(o):void 0);let i=this.context.transport.schedule(a=>{this._start(a,r,o)},n);this._scheduled.push(i),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>n&&this._syncedStart(this.now(),this.context.transport.seconds)}else zn(this.context),this._start(n,r,o);return this}stop(t){let r=Ct(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(r=this._clampToCurrentTime(r),this._state.getValueAtTime(r)==="started"||U(this._state.getNextState("started",r))){if(this.log("stop",r),!this._synced)this._stop(r);else{let o=this.context.transport.schedule(this._stop.bind(this),r);this._scheduled.push(o)}this._state.cancel(r),this._state.setStateAtTime("stopped",r)}return this}restart(t,r,o){return t=this.toSeconds(t),this._state.getValueAtTime(t)==="started"&&(this._state.cancel(t),this._restart(t,r,o)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,r)=>{if(r>0){let o=this._state.get(r);if(o&&o.state==="started"&&o.time!==r){let n=r-this.toSeconds(o.time),s;o.duration&&(s=this.toSeconds(o.duration)-n),this._start(t,this.toSeconds(o.offset)+n,s)}}},this._syncedStop=t=>{let r=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(r)==="started"&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=H,this.unsync(),this._volume.dispose(),this._state.dispose(),this}};var qe=class e extends Te{constructor(){super(d(e.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;let t=d(e.getDefaults(),arguments,["url","onload"]);Vt(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Q({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new xt(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Te.getDefaults(),{url:new xt,loop:!1,loopEnd:0,loopStart:0,onload:H,onerror:H,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,r,o,n=1){j(this.buffer.loaded,"buffer is either not set or not loaded");let s=this.toSeconds(t);this._startGain(s,n),this.loop?r=Qt(r,this.loopStart):r=Qt(r,0);let i=Math.max(this.toSeconds(r),0);if(this.loop){let a=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),l=a-c;Xo(i,a)&&(i=(i-c)%l+c),Ut(i,this.buffer.duration)&&(i=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Zn(i,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,i)),U(o)){let a=this.toSeconds(o);a=Math.max(a,0),this.stop(s+a)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}};var Ar=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;let t=d(e.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(tt.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(j(t in tp,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,this.state==="started")){let r=this.now();this._stop(r),this._start(r)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){let r=tp[this._type];this._source=new qe({url:r,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(r.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}},fo=44100*5,qi=2,Ue={brown:null,pink:null,white:null},tp={get brown(){if(!Ue.brown){let e=[];for(let t=0;t<qi;t++){let r=new Float32Array(fo);e[t]=r;let o=0;for(let n=0;n<fo;n++){let s=Math.random()*2-1;r[n]=(o+.02*s)/1.02,o=r[n],r[n]*=3.5}}Ue.brown=new xt().fromArray(e)}return Ue.brown},get pink(){if(!Ue.pink){let e=[];for(let t=0;t<qi;t++){let r=new Float32Array(fo);e[t]=r;let o,n,s,i,a,c,l;o=n=s=i=a=c=l=0;for(let u=0;u<fo;u++){let h=Math.random()*2-1;o=.99886*o+h*.0555179,n=.99332*n+h*.0750759,s=.969*s+h*.153852,i=.8665*i+h*.3104856,a=.55*a+h*.5329522,c=-.7616*c-h*.016898,r[u]=o+n+s+i+a+c+l+h*.5362,r[u]*=.11,l=h*.115926}}Ue.pink=new xt().fromArray(e)}return Ue.pink},get white(){if(!Ue.white){let e=[];for(let t=0;t<qi;t++){let r=new Float32Array(fo);e[t]=r;for(let o=0;o<fo;o++)r[o]=Math.random()*2-1}Ue.white=new xt().fromArray(e)}return Ue.white}};function Yt(e,t){return J(this,void 0,void 0,function*(){let r=t/e.context.sampleRate,o=new Ie(1,r,e.context.sampleRate);return new e.constructor(Object.assign(e.get(),{frequency:2/r,detune:0,context:o})).toDestination().start(0),(yield o.render()).getChannelData(0)})}var Ko=class e extends Te{constructor(){super(d(e.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];let t=d(e.getDefaults(),arguments,["frequency","type"]);Vt(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Q({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Q({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),V(this,["frequency","detune"])}static getDefaults(){return Object.assign(Te.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){let r=this.toSeconds(t);return this.log("start",r),this._startGain(r),this._oscillator.start(r),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}};var dt=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;let t=d(e.getDefaults(),arguments,["frequency","type"]);this.frequency=new z({context:this.context,units:"frequency",value:t.frequency}),V(this,"frequency"),this.detune=new z({context:this.context,units:"cents",value:t.detune}),V(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(tt.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){let r=this.toSeconds(t),o=new Ko({context:this.context,onended:()=>this.onstop(this)});this._oscillator=o,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(r)}_stop(t){let r=this.toSeconds(t);this._oscillator&&this._oscillator.stop(r)}_restart(t){let r=this.toSeconds(t);return this.log("restart",r),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(r),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return e._periodicWaveCache.find(r=>r.phase===this._phase&&zh(r.partials,this._partials));{let t=e._periodicWaveCache.find(r=>r.type===this._type&&r.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;let r=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&r)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{let o=this._getCachedPeriodicWave();if(U(o)){let{partials:n,wave:s}=o;this._wave=s,this._partials=n,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{let[n,s]=this._getRealImaginary(t,this._phase),i=this.context.createPeriodicWave(n,s);this._wave=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),e._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:n,type:this._type,wave:this._wave}),e._periodicWaveCache.length>100&&e._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){Et(t,0);let r=this._type,o=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(o&&(r=o[1]),this._type!=="custom")t===0?this.type=r:this.type=r+t.toString();else{let n=new Float32Array(t);this._partials.forEach((s,i)=>n[i]=s),this._partials=Array.from(n),this.type=this._type}}_getRealImaginary(t,r){let n=2048,s=new Float32Array(n),i=new Float32Array(n),a=1;if(t==="custom"){if(a=this._partials.length+1,this._partialCount=this._partials.length,n=a,this._partials.length===0)return[s,i]}else{let c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);c?(a=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),t=c[1],a=Math.max(a,2),n=a):this._partialCount=0,this._partials=[]}for(let c=1;c<n;++c){let l=2/(c*Math.PI),u;switch(t){case"sine":u=c<=a?1:0,this._partials[c-1]=u;break;case"square":u=c&1?2*l:0,this._partials[c-1]=u;break;case"sawtooth":u=l*(c&1?1:-1),this._partials[c-1]=u;break;case"triangle":c&1?u=2*(l*l)*(c-1>>1&1?-1:1):u=0,this._partials[c-1]=u;break;case"custom":u=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}u!==0?(s[c]=-u*Math.sin(r*c),i[c]=u*Math.cos(r*c)):(s[c]=0,i[c]=0)}return[s,i]}_inverseFFT(t,r,o){let n=0,s=t.length;for(let i=0;i<s;i++)n+=t[i]*Math.cos(i*o)+r[i]*Math.sin(i*o);return n}getInitialValue(){let[t,r]=this._getRealImaginary(this._type,0),o=0,n=Math.PI*2,s=32;for(let i=0;i<s;i++)o=Math.max(this._inverseFFT(t,r,i/s*n),o);return Oi(-this._inverseFFT(t,r,this._phase)/o,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return J(this,void 0,void 0,function*(){return Yt(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}};dt._periodicWaveCache=[];var Lt=class e extends D{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["context"])))}connect(t,r=0,o=0){return uo(this,t,r,o),this}};var $t=class e extends Lt{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;let t=d(e.getDefaults(),arguments,["mapping","length"]);St(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):Lh(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(z.getDefaults(),{length:1024})}setMap(t,r=1024){let o=new Float32Array(r);for(let n=0,s=r;n<s;n++){let i=n/(s-1)*2-1;o[n]=t(i,n)}return this.curve=o,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){let r=["none","2x","4x"].some(o=>o.includes(t));j(r,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}};var mo=class extends Lt{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new $t({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}};var lt=class e extends z{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;let t=d(e.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new W({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(z.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}};var Jo=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new mo({context:this.context}),this._modulationNode=new W({context:this.context});let t=d(e.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new dt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new dt({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new lt({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),V(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(dt.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return J(this,void 0,void 0,function*(){return Yt(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}};var go=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new W({context:this.context,gain:0});let t=d(e.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new dt({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new z({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new dt({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new lt({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new lt({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),V(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(dt.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return J(this,void 0,void 0,function*(){return Yt(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}};var Tr=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new W({context:this.context,gain:0}),this._thresh=new $t({context:this.context,mapping:r=>r<=0?-1:1});let t=d(e.getDefaults(),arguments,["frequency","width"]);this.width=new z({context:this.context,units:"audioRange",value:t.width}),this._triangle=new dt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),V(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(tt.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return J(this,void 0,void 0,function*(){return Yt(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}};var tn=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];let t=d(e.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new z({context:this.context,units:"frequency",value:t.frequency}),this.detune=new z({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,V(this,["frequency","detune"])}static getDefaults(){return Object.assign(dt.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(r=>r.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(r=>r.stop(t))}_restart(t){this._forEach(r=>r.restart(t))}_forEach(t){for(let r=0;r<this._oscillators.length;r++)t(this._oscillators[r],r)}get type(){return this._type}set type(t){this._type=t,this._forEach(r=>r.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){let r=-t/2,o=t/(this._oscillators.length-1);this._forEach((n,s)=>n.detune.value=r+o*s)}}get count(){return this._oscillators.length}set count(t){if(Et(t,1),this._oscillators.length!==t){this._forEach(r=>r.dispose()),this._oscillators=[];for(let r=0;r<t;r++){let o=new dt({context:this.context,volume:-6-t*1.1,type:this._type,phase:this._phase+r/t*360,partialCount:this._partialCount,onstop:r===0?()=>this.onstop(this):H});this.type==="custom"&&(o.partials=this._partials),this.frequency.connect(o.frequency),this.detune.connect(o.detune),o.detune.overridden=!1,o.connect(this.output),this._oscillators[r]=o}this.spread=this._spread,this.state==="started"&&this._forEach(r=>r.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((r,o)=>r.phase=this._phase+o/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(r=>r.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(r=>r.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(r=>r.partialCount=t),this._type=this._oscillators[0].type}asArray(t=1024){return J(this,void 0,void 0,function*(){return Yt(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}};var en=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new lt({context:this.context,value:2});let t=d(e.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Tr({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new dt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),V(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(tt.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return J(this,void 0,void 0,function*(){return Yt(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}};var ep={am:Jo,fat:tn,fm:go,oscillator:dt,pulse:Tr,pwm:en},Cr=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";let t=d(e.getDefaults(),arguments,["frequency","type"]);this.frequency=new z({context:this.context,units:"frequency",value:t.frequency}),this.detune=new z({context:this.context,units:"cents",value:t.detune}),V(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(dt.getDefaults(),go.getDefaults(),Jo.getDefaults(),tn.getDefaults(),Tr.getDefaults(),en.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(r=>this._sourceType===r)&&(t=this._sourceType),t+this._oscillator.type}set type(t){t.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):t==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):t==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;let r=ep[t],o=this.now();if(this._oscillator){let n=this._oscillator;n.stop(o),this.context.setTimeout(()=>n.dispose(),this.blockTime)}this._oscillator=new r({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(o)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let r="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(r=this._oscillator.type),t==="fm"?this.type="fm"+r:t==="am"?this.type="am"+r:t==="fat"?this.type="fat"+r:t==="oscillator"?this.type=r:t==="pulse"?this.type="pulse":t==="pwm"&&(this.type="pwm")}_getOscType(t,r){return t instanceof ep[r]}get baseType(){return this._oscillator.baseType}set baseType(t){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&t!=="pulse"&&t!=="pwm"&&(this._oscillator.baseType=t)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(t){this._getOscType(this._oscillator,"fat")&&Pt(t)&&(this._oscillator.count=t)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(t){this._getOscType(this._oscillator,"fat")&&Pt(t)&&(this._oscillator.spread=t)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Mt(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(t=1024){return J(this,void 0,void 0,function*(){return Yt(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}};var cr=class e extends z{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new W({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,oe(this._constantSource,this._sum)}static getDefaults(){return Object.assign(z.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}};function as(e,t=1/0){let r=new WeakMap;return function(o,n){Reflect.defineProperty(o,n,{configurable:!0,enumerable:!0,get:function(){return r.get(this)},set:function(s){Et(s,e,t),r.set(this,s)}})}}function Kt(e,t=1/0){let r=new WeakMap;return function(o,n){Reflect.defineProperty(o,n,{configurable:!0,enumerable:!0,get:function(){return r.get(this)},set:function(s){Et(this.toSeconds(s),e,t),r.set(this,s)}})}}var rn=class e extends tt{constructor(){super(d(e.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;let t=d(e.getDefaults(),arguments,["url","onload"]);this._buffer=new xt({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(tt.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:H,onerror:H,playbackRate:1,reverse:!1})}load(t){return J(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=H){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,r,o){return super.start(t,r,o),this}_start(t,r,o){this._loop?r=Qt(r,this._loopStart):r=Qt(r,0);let n=this.toSeconds(r),s=o;o=Qt(o,Math.max(this._buffer.duration-n,0));let i=this.toSeconds(o);i=i/this._playbackRate,t=this.toSeconds(t);let a=new qe({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(t+i),this._state.setStateAtTime("stopped",t+i,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&Ct(s)?a.start(t,n):a.start(t,n,i-this.toSeconds(this.fadeOut))}_stop(t){let r=this.toSeconds(t);this._activeSources.forEach(o=>o.stop(r))}restart(t,r,o){return super.restart(t,r,o),this}_restart(t,r,o){this._stop(t),this._start(t,r,o)}seek(t,r){let o=this.toSeconds(r);if(this._state.getValueAtTime(o)==="started"){let n=this.toSeconds(t);this._stop(o),this._start(o,n)}return this}setLoopPoints(t,r){return this.loopStart=t,this.loopEnd=r,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&Et(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(r=>{r.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&Et(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(r=>{r.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(r=>{r.loop=t}),t)){let r=this._state.getNextState("stopped",this.now());r&&this._state.cancel(r.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;let r=this.now(),o=this._state.getNextState("stopped",r);o&&o.implicitEnd&&(this._state.cancel(o.time),this._activeSources.forEach(n=>n.cancelStop())),this._activeSources.forEach(n=>{n.playbackRate.setValueAtTime(t,r)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}};Wt([Kt(0)],rn.prototype,"fadeIn",void 0);Wt([Kt(0)],rn.prototype,"fadeOut",void 0);var cs=class extends Lt{constructor(){super(...arguments),this.name="Abs",this._abs=new $t({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}};var ls=class extends Lt{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new $t({context:this.context,mapping:t=>Math.abs(t)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}};var on=class extends Lt{constructor(){super(...arguments),this.name="Negate",this._multiply=new lt({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}};var $e=class e extends z{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new W({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new on({context:this.context}),this.subtrahend=this._param,oe(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(z.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}};var us=class e extends Lt{constructor(){super(Object.assign(d(e.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new $t({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new lt({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}};var hs=class e extends z{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;let t=d(e.getDefaults(),arguments,["value"]);this._subtract=this.input=new $e({context:this.context,value:t.value}),this._gtz=this.output=new us({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,V(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(z.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}};var jt=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new z({context:this.context,value:0}),this.output=this._sig,this.input=void 0;let t=d(e.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(D.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,r){if(Mt(t))return t;{let o;for(o in ps)if(ps[o][r]===t)return o;return t}}_setCurve(t,r,o){if(Mt(o)&&Reflect.has(ps,o)){let n=ps[o];we(n)?t!=="_decayCurve"&&(this[t]=n[r]):this[t]=n}else if(St(o)&&t!=="_decayCurve")this[t]=o;else throw new Error("Envelope: invalid curve: "+o)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){j(["linear","exponential"].some(r=>r===t),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,r=1){this.log("triggerAttack",t,r),t=this.toSeconds(t);let n=this.toSeconds(this.attack),s=this.toSeconds(this.decay),i=this.getValueAtTime(t);if(i>0){let a=1/n;n=(1-i)/a}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(r,t);else if(this._attackCurve==="linear")this._sig.linearRampTo(r,n,t);else if(this._attackCurve==="exponential")this._sig.targetRampTo(r,n,t);else{this._sig.cancelAndHoldAtTime(t);let a=this._attackCurve;for(let c=1;c<a.length;c++)if(a[c-1]<=i&&i<=a[c]){a=this._attackCurve.slice(c),a[0]=i;break}this._sig.setValueCurveAtTime(a,t,n,r)}if(s&&this.sustain<1){let a=r*this.sustain,c=t+n;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(a,s+c):this._sig.exponentialApproachValueAtTime(a,c,s)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);let r=this.getValueAtTime(t);if(r>0){let o=this.toSeconds(this.release);o<this.sampleTime?this._sig.setValueAtTime(0,t):this._releaseCurve==="linear"?this._sig.linearRampTo(0,o,t):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,o,t):(j(St(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,o,r))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,r,o=1){return r=this.toSeconds(r),this.triggerAttack(r,o),this.triggerRelease(r+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,r=0,o=0){return uo(this,t,r,o),this}asArray(t=1024){return J(this,void 0,void 0,function*(){let r=t/this.context.sampleRate,o=new Ie(1,r,this.context.sampleRate),n=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=n+this.toSeconds(this.release),i=s*.1,a=s+i,c=new this.constructor(Object.assign(this.get(),{attack:r*this.toSeconds(this.attack)/a,decay:r*this.toSeconds(this.decay)/a,release:r*this.toSeconds(this.release)/a,context:o}));return c._sig.toDestination(),c.triggerAttackRelease(r*(n+i)/a,0),(yield o.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}};Wt([Kt(0)],jt.prototype,"attack",void 0);Wt([Kt(0)],jt.prototype,"decay",void 0);Wt([as(0,1)],jt.prototype,"sustain",void 0);Wt([Kt(0)],jt.prototype,"release",void 0);var ps=(()=>{let t,r,o=[];for(t=0;t<128;t++)o[t]=Math.sin(t/127*(Math.PI/2));let n=[],s=6.4;for(t=0;t<127;t++){r=t/127;let p=Math.sin(r*(Math.PI*2)*s-Math.PI/2)+1;n[t]=p/10+r*.83}n[127]=1;let i=[],a=5;for(t=0;t<128;t++)i[t]=Math.ceil(t/127*a)/a;let c=[];for(t=0;t<128;t++)r=t/127,c[t]=.5*(1-Math.cos(Math.PI*r));let l=[];for(t=0;t<128;t++){r=t/127;let p=Math.pow(r,3)*4+.2,m=Math.cos(p*Math.PI*2*r);l[t]=Math.abs(m*(1-r))}function u(p){let m=new Array(p.length);for(let f=0;f<p.length;f++)m[f]=1-p[f];return m}function h(p){return p.slice(0).reverse()}return{bounce:{In:u(l),Out:l},cosine:{In:o,Out:h(o)},exponential:"exponential",linear:"linear",ripple:{In:n,Out:u(n)},sine:{In:c,Out:u(c)},step:{In:i,Out:u(i)}}})();var ne=class e extends D{constructor(){super(d(e.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;let t=d(e.getDefaults(),arguments);this._volume=this.output=new me({context:this.context,volume:t.volume}),this.volume=this._volume.volume,V(this,"volume")}static getDefaults(){return Object.assign(D.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,r){let o=this["_original_"+t]=this[t];this[t]=(...n)=>{let s=n[r],i=this.context.transport.schedule(a=>{n[r]=a,o.apply(this,n)},s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,r,o,n){let s=this.toSeconds(o),i=this.toSeconds(r);return this.triggerAttack(t,s,n),this.triggerRelease(s+i),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}};var de=class e extends ne{constructor(){super(d(e.getDefaults(),arguments));let t=d(e.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(ne.getDefaults(),{detune:0,onsilence:H,portamento:0})}triggerAttack(t,r,o=1){this.log("triggerAttack",t,r,o);let n=this.toSeconds(r);return this._triggerEnvelopeAttack(n,o),this.setNote(t,n),this}triggerRelease(t){this.log("triggerRelease",t);let r=this.toSeconds(t);return this._triggerEnvelopeRelease(r),this}setNote(t,r){let o=this.toSeconds(r),n=t instanceof Xt?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(o)>.05){let s=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(n,s,o)}else this.frequency.setValueAtTime(n,o);return this}};Wt([Kt(0)],de.prototype,"portamento",void 0);var Nr=class e extends jt{constructor(){super(d(e.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new W({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}};var He=class e extends de{constructor(){super(d(e.getDefaults(),arguments)),this.name="Synth";let t=d(e.getDefaults(),arguments);this.oscillator=new Cr(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Nr(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),V(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(de.getDefaults(),{envelope:Object.assign(pe(jt.getDefaults(),Object.keys(D.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(pe(Cr.getDefaults(),[...Object.keys(tt.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,r){if(this.envelope.triggerAttack(t,r),this.oscillator.start(t),this.envelope.sustain===0){let o=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+o+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}};var xo=class e extends He{constructor(){super(d(e.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;let t=d(e.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,V(this,["oscillator","envelope"])}static getDefaults(){return Se(de.getDefaults(),He.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,r){let o=this.toSeconds(r),n=this.toFrequency(t instanceof Xt?t.toFrequency():t),s=n*this.octaves;return this.oscillator.frequency.setValueAtTime(s,o),this.oscillator.frequency.exponentialRampToValueAtTime(n,o+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}};Wt([as(0)],xo.prototype,"octaves",void 0);Wt([Kt(0)],xo.prototype,"pitchDecay",void 0);var ms=class e extends ne{constructor(){super(d(e.getDefaults(),arguments)),this.name="NoiseSynth";let t=d(e.getDefaults(),arguments);this.noise=new Ar(Object.assign({context:this.context},t.noise)),this.envelope=new Nr(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(ne.getDefaults(),{envelope:Object.assign(pe(jt.getDefaults(),Object.keys(D.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(pe(Ar.getDefaults(),Object.keys(tt.getDefaults())),{type:"white"})})}triggerAttack(t,r=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,r),this.noise.start(t),this.envelope.sustain===0&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,r,o=1){return r=this.toSeconds(r),t=this.toSeconds(t),this.triggerAttack(r,o),this.triggerRelease(r+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}};var rp=new Set;function yo(e){rp.add(e)}function ds(e,t){let r=`registerProcessor("${e}", ${t})`;rp.add(r)}var Lg=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;yo(Lg);var Bg=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;yo(Bg);var Wg=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;yo(Wg);var op="feedback-comb-filter",jg=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;ds(op,jg);var nn=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";let t=d(e.getDefaults(),arguments,["frequency","type"]);this._frequency=t.frequency,this._type=t.type,this.input=new W({context:this.context}),this.output=new W({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(D.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){let t=this._filter,r=this.toFrequency(this._frequency),o=1/(2*Math.PI*r);if(this._type==="lowpass"){let n=1/(o*this.context.sampleRate),s=n-1;this._filter=this.context.createIIRFilter([n,0],[1,s])}else{let n=1/(o*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,n])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(t),t.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(t=128){let r=new Float32Array(t);for(let s=0;s<t;s++){let a=Math.pow(s/t,2)*19980+20;r[s]=a}let o=new Float32Array(t),n=new Float32Array(t);return this._filter.getFrequencyResponse(r,o,n),o}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}};var gs=class e extends ne{constructor(){super(d(e.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;let t=d(e.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),r={};Object.keys(t.urls).forEach(o=>{let n=parseInt(o,10);if(j(Qo(o)||Pt(n)&&isFinite(n),`url key is neither a note or midi pitch: ${o}`),Qo(o)){let s=new Xt(this.context,o).toMidi();r[s]=t.urls[o]}else Pt(n)&&isFinite(n)&&(r[n]=t.urls[n])}),this._buffers=new po({urls:r,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(ne.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:H,onerror:H,release:.1,urls:{}})}_findClosest(t){let o=0;for(;o<96;){if(this._buffers.has(t+o))return-o;if(this._buffers.has(t-o))return o;o++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,r,o=1){return this.log("triggerAttack",t,r,o),Array.isArray(t)||(t=[t]),t.forEach(n=>{let s=Mi(new Xt(this.context,n).toFrequency()),i=Math.round(s),a=s-i,c=this._findClosest(i),l=i-c,u=this._buffers.get(l),h=br(c+a),p=new qe({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);p.start(r,0,u.duration/h,o),St(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(p),p.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){let m=this._activeSources.get(i),f=m.indexOf(p);f!==-1&&m.splice(f,1)}}}),this}triggerRelease(t,r){return this.log("triggerRelease",t,r),Array.isArray(t)||(t=[t]),t.forEach(o=>{let n=new Xt(this.context,o).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){let s=this._activeSources.get(n);r=this.toSeconds(r),s.forEach(i=>{i.stop(r)}),this._activeSources.set(n,[])}}),this}releaseAll(t){let r=this.toSeconds(t);return this._activeSources.forEach(o=>{for(;o.length;)o.shift().stop(r)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,r,o,n=1){let s=this.toSeconds(o);return this.triggerAttack(t,s,n),St(r)?(j(St(t),"notes must be an array when duration is array"),t.forEach((i,a)=>{let c=r[Math.min(a,r.length-1)];this.triggerRelease(i,s+this.toSeconds(c))})):this.triggerRelease(t,s+this.toSeconds(r)),this}add(t,r,o){if(j(Qo(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Qo(t)){let n=new Xt(this.context,t).toMidi();this._buffers.add(n,r,o)}else this._buffers.add(t,r,o);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(r=>r.dispose())}),this._activeSources.clear(),this}};Wt([Kt(0)],gs.prototype,"attack",void 0);Wt([Kt(0)],gs.prototype,"release",void 0);var vo=class e extends pt{constructor(){super(d(e.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new Ae("stopped"),this._startOffset=0;let t=d(e.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(pt.getDefaults(),{callback:H,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,r=>{let o;if(r.state==="started"){r.id!==-1&&this.context.transport.clear(r.id);let n=r.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||Pt(this._loop)&&this._loop>1){o=1/0,Pt(this._loop)&&(o=this._loop*this._getLoopDuration());let s=this._state.getAfter(n);s!==null&&(o=Math.min(o,s.time-n)),o!==1/0&&(this._state.setStateAtTime("stopped",n+o+1,{id:-1}),o=new yt(this.context,o));let i=new yt(this.context,this._getLoopDuration());r.id=this.context.transport.scheduleRepeat(this._tick.bind(this),i,new yt(this.context,n),o)}else r.id=this.context.transport.schedule(this._tick.bind(this),new yt(this.context,n))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){let r=this.toTicks(t);return this._state.getValueAtTime(r)==="stopped"&&(this._state.add({id:-1,state:"started",time:r}),this._rescheduleEvents(r)),this}stop(t){this.cancel(t);let r=this.toTicks(t);if(this._state.getValueAtTime(r)==="started"){this._state.setStateAtTime("stopped",r,{id:-1});let o=this._state.getBefore(r),n=r;o!==null&&(n=o.time),this._rescheduleEvents(n)}return this}cancel(t){t=Qt(t,-1/0);let r=this.toTicks(t);return this._state.forEachFrom(r,o=>{this.context.transport.clear(o.id)}),this._state.cancel(r),this}_tick(t){let r=this.context.transport.getTicksAtTime(t);if(!this.mute&&this._state.getValueAtTime(r)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let o=.02;Un(this.humanize)||(o=this.toSeconds(this.humanize)),t+=(Math.random()*2-1)*o}this.callback(t,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new yt(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new yt(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){let t=this.context.transport.ticks,r=this._state.get(t);if(r!==null&&r.state==="started"){let o=this._getLoopDuration();return(t-r.time)%o/o}else return 0}else return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}};var sn=class e extends pt{constructor(){super(d(e.getDefaults(),arguments,["callback","interval"])),this.name="Loop";let t=d(e.getDefaults(),arguments,["callback","interval"]);this._event=new vo({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign(pt.getDefaults(),{interval:"4n",callback:H,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return this._event.loop===!0?1/0:this._event.loop}set iterations(t){t===1/0?this._event.loop=!0:this._event.loop=t}dispose(){return super.dispose(),this._event.dispose(),this}};var wo=class e extends D{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new ls({context:this.context}),this.a=new W({context:this.context,gain:0}),this.b=new W({context:this.context,gain:0}),this.output=new W({context:this.context}),this._internalChannels=[this.a,this.b];let t=d(e.getDefaults(),arguments,["fade"]);this.fade=new z({context:this.context,units:"normalRange",value:t.fade}),V(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Vt(this._split,this.a.gain,0),Vt(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(D.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}};var Jt=class extends D{constructor(t){super(t),this.name="Effect",this._dryWet=new wo({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new W({context:this.context}),this.effectReturn=new W({context:this.context}),this.input=new W({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],V(this,"wet")}static getDefaults(){return Object.assign(D.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}};var an=class e extends D{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;let t=d(e.getDefaults(),arguments,["pan"]);this.pan=new Q({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",V(this,"pan")}static getDefaults(){return Object.assign(D.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}};var cn=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["smoothing"])),this.name="Follower";let t=d(e.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new cs({context:this.context}),this._lowpass=this.output=new nn({context:this.context,frequency:1/this.toSeconds(t.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=t.smoothing}static getDefaults(){return Object.assign(D.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}};var np="bit-crusher",Hg=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;ds(np,Hg);var kr=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["channels"])),this.name="Split";let t=d(e.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(D.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}};var lr=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["channels"])),this.name="Merge";let t=d(e.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(D.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}};var bo=class extends Jt{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new W({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,V(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Jt.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}};var xs=class e extends bo{constructor(){super(d(e.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";let t=d(e.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new ar({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),V(this,"delayTime")}static getDefaults(){return Object.assign(bo.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}};var BH=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100];var ZH=[1687/25e3,1601/25e3,2053/25e3,2251/25e3];var ln=class e extends D{constructor(){super(d(e.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new kr({channels:2,context:this.context}),this._midAdd=new cr({context:this.context}),this.mid=new lt({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new $e({context:this.context}),this.side=new lt({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}};var un=class e extends D{constructor(){super(d(e.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new W({context:this.context}),this.side=new W({context:this.context}),this._left=new cr({context:this.context}),this._leftMult=new lt({context:this.context,value:Math.SQRT1_2}),this._right=new $e({context:this.context}),this._rightMult=new lt({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new lr({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}};var So=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["solo"])),this.name="Solo";let t=d(e.getDefaults(),arguments,["solo"]);this.input=this.output=new W({context:this.context}),e._allSolos.has(this.context)||e._allSolos.set(this.context,new Set),e._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(D.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),e._allSolos.get(this.context).forEach(r=>r._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){e._soloed.has(this.context)||e._soloed.set(this.context,new Set),e._soloed.get(this.context).add(this)}_removeSolo(){e._soloed.has(this.context)&&e._soloed.get(this.context).delete(this)}_isSoloed(){return e._soloed.has(this.context)&&e._soloed.get(this.context).has(this)}_noSolos(){return!e._soloed.has(this.context)||e._soloed.has(this.context)&&e._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),e._allSolos.get(this.context).delete(this),this._removeSolo(),this}};So._allSolos=new Map;So._soloed=new Map;var ys=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";let t=d(e.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new an({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new me({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,V(this,["pan","volume"])}static getDefaults(){return Object.assign(D.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}};var Vi=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["volume","pan"])),this.name="Channel";let t=d(e.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new So({solo:t.solo,context:this.context}),this._panVol=this.output=new ys({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),V(this,["pan","volume"])}static getDefaults(){return Object.assign(D.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return e.buses.has(t)||e.buses.set(t,new W({context:this.context})),e.buses.get(t)}send(t,r=0){let o=this._getBus(t),n=new W({context:this.context,units:"decibels",gain:r});return this.connect(n),n.connect(o),n}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}};Vi.buses=new Map;var Li=class extends D{constructor(){super(...arguments),this.name="Listener",this.positionX=new Q({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Q({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Q({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Q({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Q({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Q({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Q({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Q({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Q({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(D.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}};or(e=>{e.listener=new Li({context:e})});nr(e=>{e.listener.dispose()});var Or=class e extends D{constructor(){super(d(e.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;let t=d(e.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new Q({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new Q({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new Q({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new Q({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new Q({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),V(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(D.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}};var vs=class e extends D{constructor(){super(Object.assign(d(e.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";let t=d(e.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new cn({context:this.context,smoothing:t.smoothing}),this._gt=new hs({context:this.context,value:ir(t.threshold)}),this.input=new W({context:this.context}),this._gate=this.output=new W({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(D.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return wr(this._gt.value)}set threshold(t){this._gt.value=ir(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}};var ws=class e extends D{constructor(){super(Object.assign(d(e.getDefaults(),arguments))),this.name="MidSideCompressor";let t=d(e.getDefaults(),arguments);this._midSideSplit=this.input=new ln({context:this.context}),this._midSideMerge=this.output=new un({context:this.context}),this.mid=new Or(Object.assign(t.mid,{context:this.context})),this.side=new Or(Object.assign(t.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),V(this,["mid","side"])}static getDefaults(){return Object.assign(D.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}};var sp=At().transport;var ip=At().destination,IK=At().destination;var qK=At().listener;var PK=At().draw;var VK=At();function ap(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Dr(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,o=e.slice(0,r);return[o.length>1?o[0]+o.slice(2):o,+e.slice(r+1)]}function Pe(e){return e=Dr(Math.abs(e)),e?e[1]:NaN}function cp(e,t){return function(r,o){for(var n=r.length,s=[],i=0,a=e[0],c=0;n>0&&a>0&&(c+a+1>o&&(a=Math.max(1,o-c)),s.push(r.substring(n-=a,n+a)),!((c+=a+1)>o));)a=e[i=(i+1)%e.length];return s.reverse().join(t)}}function lp(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var Yg=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ur(e){if(!(t=Yg.exec(e)))throw new Error("invalid format: "+e);var t;return new bs({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ur.prototype=bs.prototype;function bs(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}bs.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function up(e){t:for(var t=e.length,r=1,o=-1,n;r<t;++r)switch(e[r]){case".":o=n=r;break;case"0":o===0&&(o=r),n=r;break;default:if(!+e[r])break t;o>0&&(o=0);break}return o>0?e.slice(0,o)+e.slice(n+1):e}var Bi;function hp(e,t){var r=Dr(e,t);if(!r)return e+"";var o=r[0],n=r[1],s=n-(Bi=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,i=o.length;return s===i?o:s>i?o+new Array(s-i+1).join("0"):s>0?o.slice(0,s)+"."+o.slice(s):"0."+new Array(1-s).join("0")+Dr(e,Math.max(0,t+s-1))[0]}function Wi(e,t){var r=Dr(e,t);if(!r)return e+"";var o=r[0],n=r[1];return n<0?"0."+new Array(-n).join("0")+o:o.length>n+1?o.slice(0,n+1)+"."+o.slice(n+1):o+new Array(n-o.length+2).join("0")}var ji={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:ap,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Wi(e*100,t),r:Wi,s:hp,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Gi(e){return e}var pp=Array.prototype.map,fp=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function mp(e){var t=e.grouping===void 0||e.thousands===void 0?Gi:cp(pp.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",o=e.currency===void 0?"":e.currency[1]+"",n=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?Gi:lp(pp.call(e.numerals,String)),i=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"\u2212":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function l(h){h=ur(h);var p=h.fill,m=h.align,f=h.sign,g=h.symbol,_=h.zero,y=h.width,S=h.comma,N=h.precision,M=h.trim,x=h.type;x==="n"?(S=!0,x="g"):ji[x]||(N===void 0&&(N=12),M=!0,x="g"),(_||p==="0"&&m==="=")&&(_=!0,p="0",m="=");var w=g==="$"?r:g==="#"&&/[boxX]/.test(x)?"0"+x.toLowerCase():"",b=g==="$"?o:/[%p]/.test(x)?i:"",v=ji[x],q=/[defgprs%]/.test(x);N=N===void 0?6:/[gprs]/.test(x)?Math.max(1,Math.min(21,N)):Math.max(0,Math.min(20,N));function I(T){var O=w,L=b,F,k,C;if(x==="c")L=v(T)+L,T="";else{T=+T;var A=T<0||1/T<0;if(T=isNaN(T)?c:v(Math.abs(T),N),M&&(T=up(T)),A&&+T==0&&f!=="+"&&(A=!1),O=(A?f==="("?f:a:f==="-"||f==="("?"":f)+O,L=(x==="s"?fp[8+Bi/3]:"")+L+(A&&f==="("?")":""),q){for(F=-1,k=T.length;++F<k;)if(C=T.charCodeAt(F),48>C||C>57){L=(C===46?n+T.slice(F+1):T.slice(F))+L,T=T.slice(0,F);break}}}S&&!_&&(T=t(T,1/0));var P=O.length+T.length+L.length,R=P<y?new Array(y-P+1).join(p):"";switch(S&&_&&(T=t(R+T,R.length?y-L.length:1/0),R=""),m){case"<":T=O+T+L+R;break;case"=":T=O+R+T+L;break;case"^":T=R.slice(0,P=R.length>>1)+O+T+L+R.slice(P);break;default:T=R+O+T+L;break}return s(T)}return I.toString=function(){return h+""},I}function u(h,p){var m=l((h=ur(h),h.type="f",h)),f=Math.max(-8,Math.min(8,Math.floor(Pe(p)/3)))*3,g=Math.pow(10,-f),_=fp[8+f/3];return function(y){return m(g*y)+_}}return{format:l,formatPrefix:u}}var Ss,Ao,As;zi({thousands:",",grouping:[3],currency:["$",""]});function zi(e){return Ss=mp(e),Ao=Ss.format,As=Ss.formatPrefix,Ss}function Ui(e){return Math.max(0,-Pe(Math.abs(e)))}function $i(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Pe(t)/3)))*3-Pe(Math.abs(e)))}function Hi(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Pe(t)-Pe(e))+1}function Kg(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function Zi(e,t){return fetch(e,t).then(Kg)}var Ts="http://www.w3.org/1999/xhtml",Qi={svg:"http://www.w3.org/2000/svg",xhtml:Ts,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Cs(e){var t=e+="",r=t.indexOf(":");return r>=0&&(t=e.slice(0,r))!=="xmlns"&&(e=e.slice(r+1)),Qi.hasOwnProperty(t)?{space:Qi[t],local:e}:e}function Jg(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===Ts&&t.documentElement.namespaceURI===Ts?t.createElement(e):t.createElementNS(r,e)}}function t_(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Ns(e){var t=Cs(e);return(t.local?t_:Jg)(t)}function e_(){}function ks(e){return e==null?e_:function(){return this.querySelector(e)}}function dp(e){typeof e!="function"&&(e=ks(e));for(var t=this._groups,r=t.length,o=new Array(r),n=0;n<r;++n)for(var s=t[n],i=s.length,a=o[n]=new Array(i),c,l,u=0;u<i;++u)(c=s[u])&&(l=e.call(c,c.__data__,u,s))&&("__data__"in c&&(l.__data__=c.__data__),a[u]=l);return new ut(o,this._parents)}function hn(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function r_(){return[]}function gp(e){return e==null?r_:function(){return this.querySelectorAll(e)}}function o_(e){return function(){return hn(e.apply(this,arguments))}}function _p(e){typeof e=="function"?e=o_(e):e=gp(e);for(var t=this._groups,r=t.length,o=[],n=[],s=0;s<r;++s)for(var i=t[s],a=i.length,c,l=0;l<a;++l)(c=i[l])&&(o.push(e.call(c,c.__data__,l,i)),n.push(c));return new ut(o,n)}function xp(e){return function(){return this.matches(e)}}function Os(e){return function(t){return t.matches(e)}}var n_=Array.prototype.find;function s_(e){return function(){return n_.call(this.children,e)}}function i_(){return this.firstElementChild}function yp(e){return this.select(e==null?i_:s_(typeof e=="function"?e:Os(e)))}var a_=Array.prototype.filter;function c_(){return Array.from(this.children)}function l_(e){return function(){return a_.call(this.children,e)}}function vp(e){return this.selectAll(e==null?c_:l_(typeof e=="function"?e:Os(e)))}function wp(e){typeof e!="function"&&(e=xp(e));for(var t=this._groups,r=t.length,o=new Array(r),n=0;n<r;++n)for(var s=t[n],i=s.length,a=o[n]=[],c,l=0;l<i;++l)(c=s[l])&&e.call(c,c.__data__,l,s)&&a.push(c);return new ut(o,this._parents)}function Ds(e){return new Array(e.length)}function bp(){return new ut(this._enter||this._groups.map(Ds),this._parents)}function pn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}pn.prototype={constructor:pn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Sp(e){return function(){return e}}function u_(e,t,r,o,n,s){for(var i=0,a,c=t.length,l=s.length;i<l;++i)(a=t[i])?(a.__data__=s[i],o[i]=a):r[i]=new pn(e,s[i]);for(;i<c;++i)(a=t[i])&&(n[i]=a)}function h_(e,t,r,o,n,s,i){var a,c,l=new Map,u=t.length,h=s.length,p=new Array(u),m;for(a=0;a<u;++a)(c=t[a])&&(p[a]=m=i.call(c,c.__data__,a,t)+"",l.has(m)?n[a]=c:l.set(m,c));for(a=0;a<h;++a)m=i.call(e,s[a],a,s)+"",(c=l.get(m))?(o[a]=c,c.__data__=s[a],l.delete(m)):r[a]=new pn(e,s[a]);for(a=0;a<u;++a)(c=t[a])&&l.get(p[a])===c&&(n[a]=c)}function p_(e){return e.__data__}function Ap(e,t){if(!arguments.length)return Array.from(this,p_);var r=t?h_:u_,o=this._parents,n=this._groups;typeof e!="function"&&(e=Sp(e));for(var s=n.length,i=new Array(s),a=new Array(s),c=new Array(s),l=0;l<s;++l){var u=o[l],h=n[l],p=h.length,m=f_(e.call(u,u&&u.__data__,l,o)),f=m.length,g=a[l]=new Array(f),_=i[l]=new Array(f),y=c[l]=new Array(p);r(u,h,g,_,y,m,t);for(var S=0,N=0,M,x;S<f;++S)if(M=g[S]){for(S>=N&&(N=S+1);!(x=_[N])&&++N<f;);M._next=x||null}}return i=new ut(i,o),i._enter=a,i._exit=c,i}function f_(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Tp(){return new ut(this._exit||this._groups.map(Ds),this._parents)}function Cp(e,t,r){var o=this.enter(),n=this,s=this.exit();return typeof e=="function"?(o=e(o),o&&(o=o.selection())):o=o.append(e+""),t!=null&&(n=t(n),n&&(n=n.selection())),r==null?s.remove():r(s),o&&n?o.merge(n).order():n}function Np(e){for(var t=e.selection?e.selection():e,r=this._groups,o=t._groups,n=r.length,s=o.length,i=Math.min(n,s),a=new Array(n),c=0;c<i;++c)for(var l=r[c],u=o[c],h=l.length,p=a[c]=new Array(h),m,f=0;f<h;++f)(m=l[f]||u[f])&&(p[f]=m);for(;c<n;++c)a[c]=r[c];return new ut(a,this._parents)}function kp(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var o=e[t],n=o.length-1,s=o[n],i;--n>=0;)(i=o[n])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function Op(e){e||(e=m_);function t(h,p){return h&&p?e(h.__data__,p.__data__):!h-!p}for(var r=this._groups,o=r.length,n=new Array(o),s=0;s<o;++s){for(var i=r[s],a=i.length,c=n[s]=new Array(a),l,u=0;u<a;++u)(l=i[u])&&(c[u]=l);c.sort(t)}return new ut(n,this._parents).order()}function m_(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Dp(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Ep(){return Array.from(this)}function Mp(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var o=e[t],n=0,s=o.length;n<s;++n){var i=o[n];if(i)return i}return null}function Fp(){let e=0;for(let t of this)++e;return e}function Rp(){return!this.node()}function Ip(e){for(var t=this._groups,r=0,o=t.length;r<o;++r)for(var n=t[r],s=0,i=n.length,a;s<i;++s)(a=n[s])&&e.call(a,a.__data__,s,n);return this}function d_(e){return function(){this.removeAttribute(e)}}function g_(e){return function(){this.removeAttributeNS(e.space,e.local)}}function __(e,t){return function(){this.setAttribute(e,t)}}function x_(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function y_(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttribute(e):this.setAttribute(e,r)}}function v_(e,t){return function(){var r=t.apply(this,arguments);r==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function qp(e,t){var r=Cs(e);if(arguments.length<2){var o=this.node();return r.local?o.getAttributeNS(r.space,r.local):o.getAttribute(r)}return this.each((t==null?r.local?g_:d_:typeof t=="function"?r.local?v_:y_:r.local?x_:__)(r,t))}function Es(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function w_(e){return function(){this.style.removeProperty(e)}}function b_(e,t,r){return function(){this.style.setProperty(e,t,r)}}function S_(e,t,r){return function(){var o=t.apply(this,arguments);o==null?this.style.removeProperty(e):this.style.setProperty(e,o,r)}}function Pp(e,t,r){return arguments.length>1?this.each((t==null?w_:typeof t=="function"?S_:b_)(e,t,r??"")):A_(this.node(),e)}function A_(e,t){return e.style.getPropertyValue(t)||Es(e).getComputedStyle(e,null).getPropertyValue(t)}function T_(e){return function(){delete this[e]}}function C_(e,t){return function(){this[e]=t}}function N_(e,t){return function(){var r=t.apply(this,arguments);r==null?delete this[e]:this[e]=r}}function Vp(e,t){return arguments.length>1?this.each((t==null?T_:typeof t=="function"?N_:C_)(e,t)):this.node()[e]}function Lp(e){return e.trim().split(/^|\s+/)}function Xi(e){return e.classList||new Bp(e)}function Bp(e){this._node=e,this._names=Lp(e.getAttribute("class")||"")}Bp.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Wp(e,t){for(var r=Xi(e),o=-1,n=t.length;++o<n;)r.add(t[o])}function jp(e,t){for(var r=Xi(e),o=-1,n=t.length;++o<n;)r.remove(t[o])}function k_(e){return function(){Wp(this,e)}}function O_(e){return function(){jp(this,e)}}function D_(e,t){return function(){(t.apply(this,arguments)?Wp:jp)(this,e)}}function Gp(e,t){var r=Lp(e+"");if(arguments.length<2){for(var o=Xi(this.node()),n=-1,s=r.length;++n<s;)if(!o.contains(r[n]))return!1;return!0}return this.each((typeof t=="function"?D_:t?k_:O_)(r,t))}function E_(){this.textContent=""}function M_(e){return function(){this.textContent=e}}function F_(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function zp(e){return arguments.length?this.each(e==null?E_:(typeof e=="function"?F_:M_)(e)):this.node().textContent}function R_(){this.innerHTML=""}function I_(e){return function(){this.innerHTML=e}}function q_(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Up(e){return arguments.length?this.each(e==null?R_:(typeof e=="function"?q_:I_)(e)):this.node().innerHTML}function P_(){this.nextSibling&&this.parentNode.appendChild(this)}function $p(){return this.each(P_)}function V_(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Hp(){return this.each(V_)}function Zp(e){var t=typeof e=="function"?e:Ns(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function L_(){return null}function Qp(e,t){var r=typeof e=="function"?e:Ns(e),o=t==null?L_:typeof t=="function"?t:ks(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),o.apply(this,arguments)||null)})}function B_(){var e=this.parentNode;e&&e.removeChild(this)}function Xp(){return this.each(B_)}function W_(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function j_(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Yp(e){return this.select(e?j_:W_)}function Kp(e){return arguments.length?this.property("__data__",e):this.node().__data__}function G_(e){return function(t){e.call(this,t,this.__data__)}}function z_(e){return e.trim().split(/^|\s+/).map(function(t){var r="",o=t.indexOf(".");return o>=0&&(r=t.slice(o+1),t=t.slice(0,o)),{type:t,name:r}})}function U_(e){return function(){var t=this.__on;if(t){for(var r=0,o=-1,n=t.length,s;r<n;++r)s=t[r],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++o]=s;++o?t.length=o:delete this.__on}}}function $_(e,t,r){return function(){var o=this.__on,n,s=G_(t);if(o){for(var i=0,a=o.length;i<a;++i)if((n=o[i]).type===e.type&&n.name===e.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=r),n.value=t;return}}this.addEventListener(e.type,s,r),n={type:e.type,name:e.name,value:t,listener:s,options:r},o?o.push(n):this.__on=[n]}}function Jp(e,t,r){var o=z_(e+""),n,s=o.length,i;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,u;c<l;++c)for(n=0,u=a[c];n<s;++n)if((i=o[n]).type===u.type&&i.name===u.name)return u.value}return}for(a=t?$_:U_,n=0;n<s;++n)this.each(a(o[n],t,r));return this}function tf(e,t,r){var o=Es(e),n=o.CustomEvent;typeof n=="function"?n=new n(t,r):(n=o.document.createEvent("Event"),r?(n.initEvent(t,r.bubbles,r.cancelable),n.detail=r.detail):n.initEvent(t,!1,!1)),e.dispatchEvent(n)}function H_(e,t){return function(){return tf(this,e,t)}}function Z_(e,t){return function(){return tf(this,e,t.apply(this,arguments))}}function ef(e,t){return this.each((typeof t=="function"?Z_:H_)(e,t))}function*rf(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var o=e[t],n=0,s=o.length,i;n<s;++n)(i=o[n])&&(yield i)}var fn=[null];function ut(e,t){this._groups=e,this._parents=t}function Q_(){return new ut([[document.documentElement]],fn)}function X_(){return this}ut.prototype=Q_.prototype={constructor:ut,select:dp,selectAll:_p,selectChild:yp,selectChildren:vp,filter:wp,data:Ap,enter:bp,exit:Tp,join:Cp,merge:Np,selection:X_,order:kp,sort:Op,call:Dp,nodes:Ep,node:Mp,size:Fp,empty:Rp,each:Ip,attr:qp,style:Pp,property:Vp,classed:Gp,text:zp,html:Up,raise:$p,lower:Hp,append:Zp,insert:Qp,remove:Xp,clone:Yp,datum:Kp,on:Jp,dispatch:ef,[Symbol.iterator]:rf};function Yi(e){return typeof e=="string"?new ut([[document.querySelector(e)]],[document.documentElement]):new ut([[e]],fn)}function Ki(e){return typeof e=="string"?new ut([document.querySelectorAll(e)],[document.documentElement]):new ut([hn(e)],fn)}function Er(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ji(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ms(e){let t,r,o;e.length!==2?(t=Er,r=(a,c)=>Er(e(a),c),o=(a,c)=>e(a)-c):(t=e===Er||e===Ji?e:Y_,r=e,o=e);function n(a,c,l=0,u=a.length){if(l<u){if(t(c,c)!==0)return u;do{let h=l+u>>>1;r(a[h],c)<0?l=h+1:u=h}while(l<u)}return l}function s(a,c,l=0,u=a.length){if(l<u){if(t(c,c)!==0)return u;do{let h=l+u>>>1;r(a[h],c)<=0?l=h+1:u=h}while(l<u)}return l}function i(a,c,l=0,u=a.length){let h=n(a,c,l,u-1);return h>l&&o(a[h-1],c)>-o(a[h],c)?h-1:h}return{left:n,center:i,right:s}}function Y_(){return 0}function ta(e){return e===null?NaN:+e}var of=Ms(Er),nf=of.right,K_=of.left,J_=Ms(ta).center,ea=nf;var tx=Math.sqrt(50),ex=Math.sqrt(10),rx=Math.sqrt(2);function Fs(e,t,r){let o=(t-e)/Math.max(0,r),n=Math.floor(Math.log10(o)),s=o/Math.pow(10,n),i=s>=tx?10:s>=ex?5:s>=rx?2:1,a,c,l;return n<0?(l=Math.pow(10,-n)/i,a=Math.round(e*l),c=Math.round(t*l),a/l<e&&++a,c/l>t&&--c,l=-l):(l=Math.pow(10,n)*i,a=Math.round(e/l),c=Math.round(t/l),a*l<e&&++a,c*l>t&&--c),c<a&&.5<=r&&r<2?Fs(e,t,r*2):[a,c,l]}function Rs(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];let o=t<e,[n,s,i]=o?Fs(t,e,r):Fs(e,t,r);if(!(s>=n))return[];let a=s-n+1,c=new Array(a);if(o)if(i<0)for(let l=0;l<a;++l)c[l]=(s-l)/-i;else for(let l=0;l<a;++l)c[l]=(s-l)*i;else if(i<0)for(let l=0;l<a;++l)c[l]=(n+l)/-i;else for(let l=0;l<a;++l)c[l]=(n+l)*i;return c}function mn(e,t,r){return t=+t,e=+e,r=+r,Fs(e,t,r)[2]}function ra(e,t,r){t=+t,e=+e,r=+r;let o=t<e,n=o?mn(t,e,r):mn(e,t,r);return(o?-1:1)*(n<0?1/-n:n)}function sf(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Is(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function oa(e,t){var r=Object.create(e.prototype);for(var o in t)r[o]=t[o];return r}function _n(){}var dn=.7,Vs=1/dn,To="\\s*([+-]?\\d+)\\s*",gn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ve="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ox=/^#([0-9a-f]{3,8})$/,nx=new RegExp(`^rgb\\(${To},${To},${To}\\)$`),sx=new RegExp(`^rgb\\(${Ve},${Ve},${Ve}\\)$`),ix=new RegExp(`^rgba\\(${To},${To},${To},${gn}\\)$`),ax=new RegExp(`^rgba\\(${Ve},${Ve},${Ve},${gn}\\)$`),cx=new RegExp(`^hsl\\(${gn},${Ve},${Ve}\\)$`),lx=new RegExp(`^hsla\\(${gn},${Ve},${Ve},${gn}\\)$`),af={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Is(_n,hr,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:cf,formatHex:cf,formatHex8:ux,formatHsl:hx,formatRgb:lf,toString:lf});function cf(){return this.rgb().formatHex()}function ux(){return this.rgb().formatHex8()}function hx(){return df(this).formatHsl()}function lf(){return this.rgb().formatRgb()}function hr(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=ox.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?uf(t):r===3?new te(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?qs(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?qs(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=nx.exec(e))?new te(t[1],t[2],t[3],1):(t=sx.exec(e))?new te(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=ix.exec(e))?qs(t[1],t[2],t[3],t[4]):(t=ax.exec(e))?qs(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=cx.exec(e))?ff(t[1],t[2]/100,t[3]/100,1):(t=lx.exec(e))?ff(t[1],t[2]/100,t[3]/100,t[4]):af.hasOwnProperty(e)?uf(af[e]):e==="transparent"?new te(NaN,NaN,NaN,0):null}function uf(e){return new te(e>>16&255,e>>8&255,e&255,1)}function qs(e,t,r,o){return o<=0&&(e=t=r=NaN),new te(e,t,r,o)}function px(e){return e instanceof _n||(e=hr(e)),e?(e=e.rgb(),new te(e.r,e.g,e.b,e.opacity)):new te}function Co(e,t,r,o){return arguments.length===1?px(e):new te(e,t,r,o??1)}function te(e,t,r,o){this.r=+e,this.g=+t,this.b=+r,this.opacity=+o}Is(te,Co,oa(_n,{brighter(e){return e=e==null?Vs:Math.pow(Vs,e),new te(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?dn:Math.pow(dn,e),new te(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new te(Fr(this.r),Fr(this.g),Fr(this.b),Ls(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:hf,formatHex:hf,formatHex8:fx,formatRgb:pf,toString:pf}));function hf(){return`#${Mr(this.r)}${Mr(this.g)}${Mr(this.b)}`}function fx(){return`#${Mr(this.r)}${Mr(this.g)}${Mr(this.b)}${Mr((isNaN(this.opacity)?1:this.opacity)*255)}`}function pf(){let e=Ls(this.opacity);return`${e===1?"rgb(":"rgba("}${Fr(this.r)}, ${Fr(this.g)}, ${Fr(this.b)}${e===1?")":`, ${e})`}`}function Ls(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Fr(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Mr(e){return e=Fr(e),(e<16?"0":"")+e.toString(16)}function ff(e,t,r,o){return o<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Ce(e,t,r,o)}function df(e){if(e instanceof Ce)return new Ce(e.h,e.s,e.l,e.opacity);if(e instanceof _n||(e=hr(e)),!e)return new Ce;if(e instanceof Ce)return e;e=e.rgb();var t=e.r/255,r=e.g/255,o=e.b/255,n=Math.min(t,r,o),s=Math.max(t,r,o),i=NaN,a=s-n,c=(s+n)/2;return a?(t===s?i=(r-o)/a+(r<o)*6:r===s?i=(o-t)/a+2:i=(t-r)/a+4,a/=c<.5?s+n:2-s-n,i*=60):a=c>0&&c<1?0:i,new Ce(i,a,c,e.opacity)}function gf(e,t,r,o){return arguments.length===1?df(e):new Ce(e,t,r,o??1)}function Ce(e,t,r,o){this.h=+e,this.s=+t,this.l=+r,this.opacity=+o}Is(Ce,gf,oa(_n,{brighter(e){return e=e==null?Vs:Math.pow(Vs,e),new Ce(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?dn:Math.pow(dn,e),new Ce(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,o=r+(r<.5?r:1-r)*t,n=2*r-o;return new te(na(e>=240?e-240:e+120,n,o),na(e,n,o),na(e<120?e+240:e-120,n,o),this.opacity)},clamp(){return new Ce(mf(this.h),Ps(this.s),Ps(this.l),Ls(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let e=Ls(this.opacity);return`${e===1?"hsl(":"hsla("}${mf(this.h)}, ${Ps(this.s)*100}%, ${Ps(this.l)*100}%${e===1?")":`, ${e})`}`}}));function mf(e){return e=(e||0)%360,e<0?e+360:e}function Ps(e){return Math.max(0,Math.min(1,e||0))}function na(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function sa(e,t,r,o,n){var s=e*e,i=s*e;return((1-3*e+3*s-i)*t+(4-6*s+3*i)*r+(1+3*e+3*s-3*i)*o+i*n)/6}function _f(e){var t=e.length-1;return function(r){var o=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),n=e[o],s=e[o+1],i=o>0?e[o-1]:2*n-s,a=o<t-1?e[o+2]:2*s-n;return sa((r-o/t)*t,i,n,s,a)}}function xf(e){var t=e.length;return function(r){var o=Math.floor(((r%=1)<0?++r:r)*t),n=e[(o+t-1)%t],s=e[o%t],i=e[(o+1)%t],a=e[(o+2)%t];return sa((r-o/t)*t,n,s,i,a)}}var xn=e=>()=>e;function mx(e,t){return function(r){return e+r*t}}function dx(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(o){return Math.pow(e+o*t,r)}}function yf(e){return(e=+e)==1?Bs:function(t,r){return r-t?dx(t,r,e):xn(isNaN(t)?r:t)}}function Bs(e,t){var r=t-e;return r?mx(e,r):xn(isNaN(e)?t:e)}var ia=function e(t){var r=yf(t);function o(n,s){var i=r((n=Co(n)).r,(s=Co(s)).r),a=r(n.g,s.g),c=r(n.b,s.b),l=Bs(n.opacity,s.opacity);return function(u){return n.r=i(u),n.g=a(u),n.b=c(u),n.opacity=l(u),n+""}}return o.gamma=e,o}(1);function vf(e){return function(t){var r=t.length,o=new Array(r),n=new Array(r),s=new Array(r),i,a;for(i=0;i<r;++i)a=Co(t[i]),o[i]=a.r||0,n[i]=a.g||0,s[i]=a.b||0;return o=e(o),n=e(n),s=e(s),a.opacity=1,function(c){return a.r=o(c),a.g=n(c),a.b=s(c),a+""}}}var yrt=vf(_f),vrt=vf(xf);function wf(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,o=t.slice(),n;return function(s){for(n=0;n<r;++n)o[n]=e[n]*(1-s)+t[n]*s;return o}}function bf(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Sf(e,t){var r=t?t.length:0,o=e?Math.min(r,e.length):0,n=new Array(o),s=new Array(r),i;for(i=0;i<o;++i)n[i]=Rr(e[i],t[i]);for(;i<r;++i)s[i]=t[i];return function(a){for(i=0;i<o;++i)s[i]=n[i](a);return s}}function Af(e,t){var r=new Date;return e=+e,t=+t,function(o){return r.setTime(e*(1-o)+t*o),r}}function pr(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Tf(e,t){var r={},o={},n;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in e?r[n]=Rr(e[n],t[n]):o[n]=t[n];return function(s){for(n in r)o[n]=r[n](s);return o}}var ca=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,aa=new RegExp(ca.source,"g");function gx(e){return function(){return e}}function _x(e){return function(t){return e(t)+""}}function Cf(e,t){var r=ca.lastIndex=aa.lastIndex=0,o,n,s,i=-1,a=[],c=[];for(e=e+"",t=t+"";(o=ca.exec(e))&&(n=aa.exec(t));)(s=n.index)>r&&(s=t.slice(r,s),a[i]?a[i]+=s:a[++i]=s),(o=o[0])===(n=n[0])?a[i]?a[i]+=n:a[++i]=n:(a[++i]=null,c.push({i,x:pr(o,n)})),r=aa.lastIndex;return r<t.length&&(s=t.slice(r),a[i]?a[i]+=s:a[++i]=s),a.length<2?c[0]?_x(c[0].x):gx(t):(t=c.length,function(l){for(var u=0,h;u<t;++u)a[(h=c[u]).i]=h.x(l);return a.join("")})}function Rr(e,t){var r=typeof t,o;return t==null||r==="boolean"?xn(t):(r==="number"?pr:r==="string"?(o=hr(t))?(t=o,ia):Cf:t instanceof hr?ia:t instanceof Date?Af:bf(t)?wf:Array.isArray(t)?Sf:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Tf:pr)(e,t)}function la(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function ua(e){return function(){return e}}function ha(e){return+e}var Nf=[0,1];function No(e){return e}function pa(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:ua(isNaN(t)?NaN:.5)}function xx(e,t){var r;return e>t&&(r=e,e=t,t=r),function(o){return Math.max(e,Math.min(t,o))}}function yx(e,t,r){var o=e[0],n=e[1],s=t[0],i=t[1];return n<o?(o=pa(n,o),s=r(i,s)):(o=pa(o,n),s=r(s,i)),function(a){return s(o(a))}}function vx(e,t,r){var o=Math.min(e.length,t.length)-1,n=new Array(o),s=new Array(o),i=-1;for(e[o]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<o;)n[i]=pa(e[i],e[i+1]),s[i]=r(t[i],t[i+1]);return function(a){var c=ea(e,a,1,o)-1;return s[c](n[c](a))}}function kf(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function wx(){var e=Nf,t=Nf,r=Rr,o,n,s,i=No,a,c,l;function u(){var p=Math.min(e.length,t.length);return i!==No&&(i=xx(e[0],e[p-1])),a=p>2?vx:yx,c=l=null,h}function h(p){return p==null||isNaN(p=+p)?s:(c||(c=a(e.map(o),t,r)))(o(i(p)))}return h.invert=function(p){return i(n((l||(l=a(t,e.map(o),pr)))(p)))},h.domain=function(p){return arguments.length?(e=Array.from(p,ha),u()):e.slice()},h.range=function(p){return arguments.length?(t=Array.from(p),u()):t.slice()},h.rangeRound=function(p){return t=Array.from(p),r=la,u()},h.clamp=function(p){return arguments.length?(i=p?!0:No,u()):i!==No},h.interpolate=function(p){return arguments.length?(r=p,u()):r},h.unknown=function(p){return arguments.length?(s=p,h):s},function(p,m){return o=p,n=m,u()}}function fa(){return wx()(No,No)}function ma(e,t,r,o){var n=ra(e,t,r),s;switch(o=ur(o??",f"),o.type){case"s":{var i=Math.max(Math.abs(e),Math.abs(t));return o.precision==null&&!isNaN(s=$i(n,i))&&(o.precision=s),As(o,i)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(s=Hi(n,Math.max(Math.abs(e),Math.abs(t))))&&(o.precision=s-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(s=Ui(n))&&(o.precision=s-(o.type==="%")*2);break}}return Ao(o)}function bx(e){var t=e.domain;return e.ticks=function(r){var o=t();return Rs(o[0],o[o.length-1],r??10)},e.tickFormat=function(r,o){var n=t();return ma(n[0],n[n.length-1],r??10,o)},e.nice=function(r){r==null&&(r=10);var o=t(),n=0,s=o.length-1,i=o[n],a=o[s],c,l,u=10;for(a<i&&(l=i,i=a,a=l,l=n,n=s,s=l);u-- >0;){if(l=mn(i,a,r),l===c)return o[n]=i,o[s]=a,t(o);if(l>0)i=Math.floor(i/l)*l,a=Math.ceil(a/l)*l;else if(l<0)i=Math.ceil(i*l)/l,a=Math.floor(a*l)/l;else break;c=l}return e},e}function yn(){var e=fa();return e.copy=function(){return kf(e,yn())},sf.apply(e,arguments),bx(e)}var Vr=Xs(zf()),Bt={Synth:He,Loop:sn,Transport:sp,start:Ei,NoiseSynth:ms,FeedbackDelay:xs,Gate:vs,MidSideCompressor:ws,Gain:W,Destination:ip,MembraneSynth:xo},ee={format:Ao,text:Zi,select:Yi,selectAll:Ki,scaleLinear:yn},um={MarkovChain:Vr.MarkovChain,Melody:Vr.Melody,MelodyType:Vr.MelodyType},jx=Hf(),Gx=Qf(),hm=Ws(),zx=Kf(),Ux=tm(),$x=rm(),Hx=sm(),Zx=am(),ge=Sn(),Qx=lm(),Xx=new zx(Bt),Yx=new Ux(Bt),Kx=new $x(Bt),gm=new Bt.Synth().toDestination(),Us=new Bt.Loop(e=>{if(Le=Le==15?0:Le+=1,ee.selectAll(".drum-step .transport").style("background-color","#999"),ee.select(`#drum-transport-${Le%16}`).style("background-color","yellow"),zs[Le][0]==1&&Xx.hit(e),zs[Le][1]==1&&Yx.hit(e),zs[Le][2]==1&&Kx.hit(e),Le%Ma==0&&(Hs+=1,Gs=Hs%Pr.noteSequence.length,Oa=Pr.noteSequence[Gs],Oa!="REST"&&gm.triggerAttackRelease(Oa,"16n",e),ee.selectAll(`${Zs} .transport .step`).attr("fill","#999"),ee.select(`${Zs} .transport .step-${Gs}`).attr("fill","yellow"),ym&&Gs==Pr.noteSequence.length-1)){let t=parseInt(document.getElementById("rhythm-step-count").value),r=parseInt(document.getElementById("rhythm-cycle").value),o=t>=r?2:t+1;document.getElementById("rhythm-step-count").value=o,document.querySelectorAll(".rhythm-steps button").forEach((n,s)=>n.disabled=s>=o),Fa(),Oo()}},"16n"),_m={"4N":4,"8N":2,"16N":1},Jx={Kick:0,Snare:1,Hat:2},ty=ee.format(".1%"),xm="svg.piano-roll",$s=!1,ym=!1,Le=-1,Hs=-1,Ma=2,ka,ey,pm,Oa,Gs,Ze,Ea,Pr,mr,fm,mm,An,ko,Zs=xm,zs=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],ry=()=>{$s||(Bt.start(),$s=!0),Zs=xm,Pr=Ze,Bt.Transport.state!=="started"?(Bt.Transport.bpm.value=document.getElementById("bpm").value,Us.start(0),Bt.Transport.start()):(Bt.Transport.stop(),Us.stop(),Le=-1,Hs=-1)},oy=e=>{gm.triggerAttackRelease(ge[e].note_full,"16n")},Fa=()=>{if(document.getElementById("infinity-series")!==null)An=document.getElementById("tonic").value,fm=parseInt(document.getElementById("seed-distance").value),mm=parseInt(document.getElementById("series-length").value),ko=Da(),Ze=new Hx(mm,fm,An,ko),document.querySelector("#infinity-series .sequence").textContent=Ze.sequence.join(" "),document.getElementById("current-sequence").style.visibility="visible",Oo();else if(document.getElementById("self-similarity")!==null){let e=Array.from(document.querySelectorAll(".input-note")).map(t=>ge.findIndex(r=>r.note_full==t.value));An=ge[e.slice(0).sort()[0]].note_full,ko=Da(),Ze=new Zx(e,ko),Ze.generate("xv"),Oo()}else if(document.getElementById("scales-as-vectors")!==null){ko=Da(!0),An=document.getElementById("tonic").value;let e=document.getElementById("seq-length").value,t=document.getElementById("scale").value,r=ge.findIndex(u=>u.note_full==An),o=Array.from(document.querySelectorAll("#motif select")).filter(u=>u.disabled==!1).map(u=>u.value==0?null:parseInt(u.value)),n=Array.from(document.querySelectorAll("#shifts select")).filter(u=>u.disabled==!1).map(u=>parseInt(u.value)),s=new hm(o).rhythm(ko),i=new hm(s).shift(n),a;i.length<e?a=i.concat(new Array(e-i.length).fill(null)):a=i.slice(0,e);let c=a.map(u=>u==null?null:Qx.degree2HalfSteps(t,u)+r),l=c.map(u=>u==null?"REST":ge[u].note_full);ey=[0,24],Ze={sequence:a,midiSequence:c,noteSequence:l},Oo()}else document.getElementById("markov-chain-melodies")!==null&&ee.text("data/cs-prld-note-list.txt").then(e=>{let t=e.split(`
`).map(n=>parseInt(n)).filter(n=>!isNaN(n)),r=t.map(n=>n==null?"REST":ge[n].note_full),o=new um.Melody(t,-1,Vr.MelodyType.MIDI);mr=new um.MarkovChain(o),Ze={sequence:[],midiSequence:t,noteSequence:r},Oo(),ny(),vm()});Pr=Ze},vm=()=>{let e=[...Array(32).keys()].reduce((r,o)=>(o==0?r.push(mr.get(mr.input.steps[0],mr.input.steps[0])):o==1?r.push(mr.get(mr.input.steps[0],r[0])):r.push(mr.get(r[o-2],r[o-1])),r),[]),t=e.map(r=>r==null?"REST":ge[r].note_full);Ea={sequence:[],midiSequence:e,noteSequence:t},Pr=Ea,Oo("svg.markov-piano-roll","svg.markov-note-ruler",e,oy)},ny=()=>{let e=ee.select("#markov-chain-stm").append("table");e.append("thead").append("tr").selectAll("th").data(["2 Notes Earlier","Previous Note","Values"]).join("th").text(r=>r),e.append("tbody").selectAll("tr").data(mr.stateTransitionMatrix.entries()).join("tr").selectAll("td").data(r=>[ge[r[0].split(":")[0]].note_full,ge[r[0].split(":")[1]].note_full,iy(r[1])]).join("td").text(r=>r)},sy=()=>{$s||(Bt.start(),$s=!0),Zs="svg.markov-piano-roll",Pr=Ea,Bt.Transport.state!=="started"?(Bt.Transport.bpm.value=document.getElementById("bpm").value,Us.start(0),Bt.Transport.start()):(Bt.Transport.stop(),Us.stop(),Le=-1,Hs=-1)},iy=e=>{let t=e.reduce((n,s)=>(n[s]=n.hasOwnProperty(s)?n[s]+=1:1,n),{}),r=Object.values(t).reduce((n,s)=>n+=s);return Object.keys(t).sort().map(n=>`${ge[n].note_full}: ${ty(t[n]/r)}`).join(" ")},Da=e=>e!=null||document.getElementById("apply-rhythm").checked?Array.from(document.querySelectorAll("#rhythm button:enabled")).map(t=>t.classList.contains("active")?1:0):[],ay=e=>{e.target.classList.toggle("active")},cy=(e,t,r)=>{e.target.classList.toggle("active"),zs[t][Jx[r]]=e.target.classList.contains("active")?1:0},dm=e=>{let t=document.getElementById("apply-rhythm").checked;document.getElementById("rhythm").classList.toggle("active"),document.querySelectorAll("#rhythm button").forEach(r=>r.disabled=!t),document.querySelectorAll("#rhythm input[type=number]").forEach(r=>r.disabled=!t)},ly=e=>{document.getElementById("bpm-value").textContent=e.target.value,Bt.Transport.bpm.rampTo(e.target.value,2)},uy=e=>{Ma=_m[e.target.value]},hy=e=>{document.querySelectorAll("#rhythm button").forEach((t,r)=>{r>=e.target.value?t.disabled=!0:t.disabled=!1})},py=()=>{let e;document.getElementById("scales-as-vectors")!=null?(my(),e=[48]):document.getElementById("self-similarity")!=null?(document.getElementById("apply-rhythm").addEventListener("change",dm),document.getElementById("ratio-index").addEventListener("change",fy),e=[60,72,63,67,67]):document.getElementById("infinity-series")!=null&&(document.getElementById("apply-rhythm").addEventListener("change",dm),e=[60]),ee.selectAll("#tonic, .input-note").selectAll(".tonic-note").data(ge).enter().append("option").attr("class",t=>`note-${t.note_full}`).attr("value",t=>t.note_full).text(t=>t.note_full),document.querySelectorAll("#tonic, .input-note").forEach((t,r)=>{let o=ge[e[r]].note_full;t.querySelector(`option[value="${o}"]`).setAttribute("selected","selected")}),Fa(),pm=new Gx("#drum-machine",ee),pm.render(cy),Bt.Transport.bpm.value=document.getElementById("bpm").value,Ma=_m[document.getElementById("step-rate").value]},Oo=(e,t,r,o)=>{e=e??"svg.piano-roll",t=t??"svg.note-ruler",r=r??Ze.midiSequence,o=(o==null,o),ka=new jx([e,t],r,ee),ka.render(),ka.setNotes(o)},fy=e=>{let t="#self-replicating-melody td",r=new Array;document.querySelectorAll(t).forEach((s,i)=>{s.textContent==e.target.value?(s.classList.add("active"),r.push(i)):s.classList.remove("active")});let o=r.map(s=>s%15);document.querySelectorAll("#self-replicating-melody thead th:not(.first)").forEach((s,i)=>{o.includes(i)?s.classList.add("active"):s.classList.remove("active")})},my=()=>{let e=[1,2,3,4,5,6,7,0],t=[0,1,2,3,4,5,6,7],r=[1,5,0,5,3,0,7,0,0,4,1,0],o=[7,7,0,0,7,0,0,0,0,0,7,0];["#scale-degrees","#shift-degrees"].forEach(n=>{ee.selectAll(n).selectAll("select").data(new Array(12).fill(1)).enter().append("select").selectAll(".scale-degree").data(n=="#scale-degrees"?e:t).enter().append("option").attr("class","scale-degree").attr("value",s=>s).text(s=>n=="#scale-degrees"&&s==0?"R":s)}),document.querySelectorAll("#scale-degrees select").forEach((n,s)=>{let i=r[s];n.querySelector(`option[value="${i}"]`).selected="selected"}),document.querySelectorAll("#shift-degrees select").forEach((n,s)=>{let i=o[s];n.querySelector(`option[value="${i}"]`).selected="selected"}),ee.select("#motif-length").on("change",n=>{document.querySelectorAll("#scale-degrees select").forEach((s,i)=>{s.disabled=i>=n.target.value})}),ee.select("#shift-seq-length").on("change",n=>{document.querySelectorAll("#shift-degrees select").forEach((s,i)=>{s.disabled=i>=n.target.value})}),document.getElementById("rhythm-step-count").addEventListener("change",n=>{document.querySelectorAll(".rhythm-steps button").forEach((s,i)=>{s.disabled=i>=n.target.value})}),ee.select("#apply-cycle").on("change",n=>ym=n.target.checked)},dy=()=>{py(),document.querySelector("button#generate")!=null&&document.querySelector("button#generate").addEventListener("click",Fa),document.querySelector("button#markov-generate")!=null&&document.querySelector("button#markov-generate").addEventListener("click",vm),document.querySelector("button#play-pause").addEventListener("click",ry),document.querySelectorAll("#rhythm button").forEach(e=>e.addEventListener("click",ay)),document.getElementById("bpm").addEventListener("input",ly),document.getElementById("step-rate").addEventListener("input",uy),document.getElementById("rhythm-step-count")!=null&&document.getElementById("rhythm-step-count").addEventListener("change",hy),document.getElementById("markov-play-pause")!=null&&document.getElementById("markov-play-pause").addEventListener("click",sy)};document.addEventListener("DOMContentLoaded",dy);})();
/*! Bundled license information:

tone/build/esm/core/Tone.js:
  (**
   * Tone.js
   * @author Yotam Mann
   * @license http://opensource.org/licenses/MIT MIT License
   * @copyright 2014-2019 Yotam Mann
   *)
*/
